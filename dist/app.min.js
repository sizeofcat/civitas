/*!
 * Civitas empire-building game.
 *
 * @author sizeof(cat) <sizeofcat AT riseup.net>
 * @copyright 2012 - 2021 sizeof(cat)
 * @version 0.3.0.1232021
 * @license GPL-3.0-or-later
 */
 "use strict";Array.prototype.findIndexByHandle=function(e){for(let t=0;t<this.length;t++)if(this[t].handle===e)return t;return!1},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};
/**
 * Main Game core object, responsible with the game events.
 * 
 * @license GPL-3.0-or-later
 * @class game
 * @returns {game}
 */
class game{constructor(){let e=this;return this.settlements=[],this._queue=[],this._achievements=[],this._research=[],this._achievement_points=0,this._auctioneer={},this._black_market={},this._date={day:1,month:1,year:1,day_of_month:1},this.settings={worldmap_beautify:game.WORLD_BEAUTIFY,worldmap_grid:game.WORLD_GRID,music:!1},this.encryption={key:null,key_size:256,iv_size:128,iterations:100,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Pkcs7},this.properties={difficulty:game.DIFFICULTY_EASY,mode:game.MODE_SINGLEPLAYER,paused:!1},this._ui=new ui(this),this._ui.build_main(),this._setup_audio(),$(window).bind("resize",(function(){e._ui.resize()})),$(".ui").on("click",".cityavatar",(function(){return e._ui.open_panel("council"),!1})).on("click","a[data-action=panel]",(function(){let t=$(this).data("panel").toLowerCase();return e._ui.open_panel(t),!1})).on("click","a[data-action=window]",(function(){let t=$(this).data("window").toLowerCase();return e._ui.open_window(t),!1})),this._ui.resize(),this.has_storage_data()?!0===game.ENCRYPTION?this._ui.open_window("signin"):this.load_game_data():this._ui.open_window("signup"),this}reset_storage_data(e){return void 0===e&&(e="live"),localStorage.removeItem(game.STORAGE_KEY+"."+e),this}encrypt(e){const t=CryptoJS.lib.WordArray.random(16),a=CryptoJS.PBKDF2(this.encryption.key,t,{keySize:this.encryption.key_size/32,iterations:this.encryption.iterations}),s=CryptoJS.lib.WordArray.random(16),i=CryptoJS.AES.encrypt(e,a,{iv:s,padding:this.encryption.padding,mode:this.encryption.mode});return t.toString()+s.toString()+i.toString()}decrypt(e){const t=CryptoJS.enc.Hex.parse(e.substr(0,32)),a=CryptoJS.enc.Hex.parse(e.substr(32,32)),s=e.substring(64),i=CryptoJS.PBKDF2(this.encryption.key,t,{keySize:this.encryption.key_size/32,iterations:this.encryption.iterations});let r=CryptoJS.AES.decrypt(s,i,{iv:a,padding:this.encryption.padding,mode:this.encryption.mode});try{r=r.toString(CryptoJS.enc.Utf8)}catch(e){return!1}return r}set_storage_data(e,t,a){let s;return s=!0===a?JSON.stringify(t):t,!0===game.ENCRYPTION?localStorage.setItem(game.STORAGE_KEY+"."+e,this.encrypt(s)):localStorage.setItem(game.STORAGE_KEY+"."+e,s),this}get_storage_data(e,t){let a;return void 0===e&&(e="live"),!(!this.has_storage_data(e)||(a=!0===game.ENCRYPTION?this.decrypt(localStorage.getItem(game.STORAGE_KEY+"."+e)):localStorage.getItem(game.STORAGE_KEY+"."+e),!1===a))&&(!0===t?a:JSON.parse(a))}has_storage_data(e){return void 0===e&&(e="live"),null!==localStorage.getItem(game.STORAGE_KEY+"."+e)}import(e){return!1!==e&&(this.difficulty(e.difficulty),this.queue(e.queue),this.research(e.research),this.achievements(e.achievements),this.world().seeds=e.seeds,this.achievement_points(e.achievement_points),this.date(e.date),this.black_market(e.black_market),this.auctioneer(e.auctioneer),this.set_settings(e.settings),e)}export(e){const t=[];for(let e=0;e<this.settlements.length;e++)void 0!==this.settlements[e]&&t.push(this.settlements[e].export());const a={settlements:t,difficulty:this.difficulty(),seeds:this.world().seeds,achievements:this.achievements(),research:this.research(),achievement_points:this.achievement_points(),black_market:this.black_market(),auctioneer:this.auctioneer(),date:this.date(),queue:this.queue(),settings:this.get_settings(),info:{version:game.VERSION}},s=CryptoJS.SHA512(JSON.stringify(a));if(!0===e){const e={date:Number(new Date),data:a,hash:s.toString(CryptoJS.enc.Hex)};return this.set_storage_data("live",e,!0),e}return a}save(){return this.export(!0),this}_do_daily(){return this._date.day++,this.ui().log("world",this.format_date()),this._process_settlements(),this._check_for_events(),this._queue_advance(),this.auctioneer_process(),this._date.day_of_month++,this._date.day_of_month>30&&this._do_monthly(),this._date.day>=361&&(this._do_yearly(),this._date.day=1,this._date.month=1),this.ui().check_storage(),this.save_and_refresh(),this}_do_monthly(){return this._date.day_of_month=1,this._date.month++,3!==this._date.month&&6!==this._date.month&&9!==this._date.month&&12!==this._date.month||this._do_quarterly(),6!==this._date.month&&12!==this._date.month||this._do_biannually(),this.black_market_reset(),this}_do_biannually(){return this.refresh_trades(),this}_do_quarterly(){return this}_do_yearly(){return this.get_settlement().release_mercenaries(),this.ui().notify("At the end of the year, mercenaries from your city have been released."),this._refresh_influence(),this._date.year++,this.ui().log("game","New year!"),this}format_date(){return"day "+this._date.day_of_month+", month "+this._date.month+", year "+this._date.year}is_spring(){return this._date.month>=3&&this._date.month<6}is_summer(){return this._date.month>=6&&this._date.month<9}date(e){return void 0!==e&&(this._date=e),this._date}is_autumn(){return this._date.month>=9&&this._date.month<12}is_winter(){return this._date.month>=12||this._date.month<3}season(){let e={};return this.is_spring()?(e.id=game.SEASON_SPRING,e.name=game.SEASONS[game.SEASON_SPRING].capitalize()):this.is_summer()?(e.id=game.SEASON_SUMMER,e.name=game.SEASONS[game.SEASON_SUMMER].capitalize()):this.is_autumn()?(e.id=game.SEASON_AUTUMN,e.name=game.SEASONS[game.SEASON_AUTUMN].capitalize()):this.is_winter()&&(e.id=game.SEASON_WINTER,e.name=game.SEASONS[game.SEASON_WINTER].capitalize()),e}auctioneer_reset(){return this._auctioneer={},this.ui().refresh(),this}auctioneer_delete(e){return delete this.auctioneer()[e],this}auctioneer_process(){let e,t,a=this.get_settlements(),s=this.get_settlement(),i=this.auctioneer();if(!s.can_trade())return this._auctioneer={},!1;for(let r in i)if(i[r].amount>0){for(let n=0;n<a.length;n++)if(!a[n].is_player()&&a[n].is_urban()){if(e=a[n].get_trades(),null===e)break;if(void 0===e.exports)break;for(let o in e.exports)e.exports[o]>0&&o===r&&(t=i[r].amount>=e.exports[o]?e.exports[o]:i[r].amount<e.exports[o]?i[r].amount:0,console.log(a[n].name()+" is selling "+e.exports[r]+" "+r+" and we need "+t),i[r].amount-t>=0&&(s.buy_from_settlement(a[n],r,t,!0),i[r].amount=i[r].amount-t,i[r].amount<=0&&this.auctioneer_delete(r)))}}else this.auctioneer_delete(r);return!0}auctioneer(e){return void 0!==e&&(this._auctioneer=e),this._auctioneer}auctioneer_add(e,t){let a=this.get_settlement();if(a.can_trade()){let s=Math.ceil(Math.ceil(game.RESOURCES[e].price*game.TRADES_ADDITION/100)+Math.ceil(game.RESOURCES[e].price*game.AUCTIONEER_DISCOUNT/100));const i=game.calc_price_plus_discount(t,e,s);if(void 0!==this._auctioneer[e]){const a=this._auctioneer[e];this._auctioneer[e]={resource:e,amount:a.amount+t,price:a.price+i}}else this._auctioneer[e]={resource:e,amount:t,price:i};return this.ui().refresh(),this.ui().notify(a.name()+" placed an order for "+t+" "+game.get_resource_name(e)+" on the Auctioneer.","Auctioneer"),{buyer:a.name(),amount:t,goods:game.get_resource_name(e),price:i,discount:s}}return!1}black_market_delete(e){return delete this.black_market()[e],this}black_market_add(e,t){let a=this.get_settlement();if(!game.resource_exists(e))return!1;if(!a.has_resource(e,t))return this.ui().error(this.name()+" doesn`t have enough resources of this type."),!1;if(a.remove_resource(e,t)){const s=Math.ceil(game.RESOURCES[e].price*game.BLACK_MARKET_DISCOUNT/100),i=game.calc_price_minus_discount(t,e,s);if(void 0!==this._black_market[e]){const a=this._black_market[e];this._black_market[e]={resource:e,amount:a.amount+t,price:a.price+i}}else this._black_market[e]={resource:e,amount:t,price:i};return this.ui().refresh(),this.ui().notify(a.name()+" placed "+t+" "+game.get_resource_name(e)+" on the Black Market and will receive "+i+" "+game.get_resource_name("coins")+" next month.","Black Market"),{seller:a.name(),amount:t,goods:game.get_resource_name(e),price:i,discount:s}}return!1}black_market_reset(){let e=0;for(let t in this._black_market)this.get_settlement().inc_coins(this._black_market[t].price),e+=this._black_market[t].price;return this._black_market={},this.ui().refresh(),$("#tab-blackmarket > .contents > table > tbody").empty(),e>0&&this.ui().notify(this.get_settlement().name()+" received <strong>"+e+"</strong> "+game.get_resource_name("coins")+" from the Black Market for selling goods.","Black Market"),e}black_market(e){return void 0!==e&&(this._black_market=e),this._black_market}get_achievement_config_data(e){return"string"==typeof e&&game.ACHIEVEMENTS[game.ACHIEVEMENTS.findIndexByHandle(e)]}achievements(e){return void 0!==e&&(this._achievements=e),this._achievements}achievement_points(e){return void 0!==e&&(this._achievement_points=e),this._achievement_points}achievements_process(){let e,t,a,s=!1;const i=this.get_settlement();if(i.is_player())for(let r=0;r<game.ACHIEVEMENTS.length;r++)if(t=game.ACHIEVEMENTS[r],a=t.handle,!this.has_achievement(a))for(let r in t.conditions){if(e=t.conditions[r],"settlement_level"===r&&i.level()===e&&this.do_achievement(a),"soldiers"===r){i.num_soldiers()>=e&&this.do_achievement(a)}if("ships"===r){i.num_ships()>=e&&this.do_achievement(a)}if("population"===r&&i.population()>=e&&this.do_achievement(a),"buildings"===r){for(let t in e)if(s=!0,!i.is_building_built(t,e[t])){s=!1;break}!0===s&&this.do_achievement(a)}if("resources"===r){s=!0;for(let t in e){if(i.resources[t]<e[t]){s=!1;break}}!0===s&&this.do_achievement(a)}if("storage"===r&&0===e){let e=i.storage();e.occupied>=e.all&&this.do_achievement(a)}if("achievements"===r&&e===this._achievements.length&&this.do_achievement(a),"mercenary"===r){i.mercenary().length>=e&&this.do_achievement(a)}if("religion"===r){i.religion().name===e.capitalize()&&this.do_achievement(a)}}return this}do_achievement(e){if(!this.has_achievement(e)){const t=this.get_achievement_config_data(e);t&&(this._achievements.push({handle:e,date:+new Date}),this._achievement_points+=t.points,this.ui().notify(t.description,"Achievement Completed",!1,game.NOTIFY_ACHIEVEMENT),this.save_and_refresh())}return this}has_achievement(e){for(let t=0;t<this._achievements.length;t++)if(void 0!==this._achievements[t]&&this._achievements[t].handle===e)return this._achievements[t];return!1}get_research_config_data(e){return"string"==typeof e&&game.TECHNOLOGIES[game.TECHNOLOGIES.findIndexByHandle(e)]}do_research(e){if(!this.has_research(e)){const t=this.get_research_config_data(e);!1!==t&&(this._research.push({handle:e}),this.ui().notify(t.description,"Research: "+t.name,!1,game.NOTIFY_RESEARCH),this.save_and_refresh())}return this}has_research_in_queue(){for(let e=0;e<this._queue.length;e++)if(this._queue[e].mode===game.ACTION_RESEARCH)return this._queue[e];return!1}has_research(e){for(let t=0;t<this._research.length;t++)if(void 0!==this._research[t]&&this._research[t].handle===e)return this._research[t];return!1}research(e){return void 0!==e&&(this._research=e),this._research}queue(e){return void 0!==e&&(this._queue=e),this._queue}in_queue(e){for(let t=0;t<this._queue.length;t++)if(this._queue[t].data.handle===e)return this._queue[t];return!1}_queue_advance(){for(let e=0;e<this._queue.length;e++)this._queue[e].passed===this._queue[e].duration-1?this.queue_process_action(e):this._queue[e].passed++;return this}queue_process_action(e){let t,a=this._queue[e],s=!0,i=this.get_settlement(a.source.id);if(a.type===game.CAMPAIGN_SCOUT){if(t=this.get_settlement(a.destination.id),!t)return this.queue_remove_action(e),!1}else if(void 0!==a.destination&&(t=this.get_settlement(a.destination.id),!t))return this.queue_remove_action(e),!1;if(a.mode===game.ACTION_CAMPAIGN){let r=Math.ceil(100*Math.random()),n=Math.floor(a.data.espionage/100);if(i.is_player()){if(a.type===game.CAMPAIGN_ARMY&&!i.can_recruit_soldiers())return this.queue_remove_action(e),!1;if(a.type===game.CAMPAIGN_SPY&&!i.can_diplomacy())return this.queue_remove_action(e),!1;if(a.type===game.CAMPAIGN_SCOUT&&!i.can_diplomacy())return this.queue_remove_action(e),!1;if(a.type===game.CAMPAIGN_CARAVAN&&!i.can_trade())return this.queue_remove_action(e),!1}switch(a.type){case game.CAMPAIGN_ARMY:this.ui().notify("The army sent from "+i.name()+" to "+t.name()+" "+a.duration+" days ago reached its destination."),this.ui().get_panel("battle")||this.ui().open_window("battle",{source:a,destination:t});break;case game.CAMPAIGN_ARMY_RETURN:this.ui().notify("The army sent from "+t.name()+" to "+i.name()+" "+2*a.duration+" days ago reached its home town."),t.merge_army(a.data.army),t.merge_navy(a.data.navy),t.merge_resources(a.data.resources);break;case game.CAMPAIGN_SPY:if(void 0!==a.data.espionage)switch(a.data.mission){case game.SPY_MISSION_RELIGION:if(r<=Math.ceil(a.data.espionage/game.MAX_ESPIONAGE_SUCESS_RATE)){if(a.source.id===i.id()){t.religion(a.data.religion);let e=t.religion();this.ui().notify("The spy you sent "+a.duration+" days ago to "+t.name()+" reached its destination and managed to convince the settlement council to change the religion to "+e.name+".")}else if(a.destination.id===i.id()){t=this.get_settlement(a.source.id),i.religion(a.data.religio);let e=i.religion();this.ui().notify("The spy sent from "+t.name()+" "+a.duration+" days ago to our city reached its destination and managed to convince your city council to change the religion to "+e.name+".")}s=!1}break;case game.SPY_MISSION_INFLUENCE:r<=Math.ceil(a.data.espionage/game.MAX_ESPIONAGE_SUCESS_RATE)&&(a.source.id===i.id()?(i.raise_influence(a.destination.id,n),this.ui().notify("The spy you sent "+a.duration+" days ago to "+t.name()+" reached its destination and increased your influence over this settlement.")):a.destination.id===i.id()&&(t=this.get_settlement(a.source.id),this.ui().notify("The spy sent from "+t.name()+" "+a.duration+" days ago to our city reached its destination and lowered your influence over this settlement.")),s=!1);break;case game.SPY_MISSION_STEAL_RESOURCES:r<=Math.ceil(a.data.espionage/game.MAX_ESPIONAGE_SUCESS_RATE)&&(s=!1);break;case game.SPY_MISSION_INSTIGATE:r<=Math.ceil(a.data.espionage/game.MAX_ESPIONAGE_SUCESS_RATE)&&(a.source.id===i.id()?(t.lower_prestige(n),this.ui().notify("The spy you sent "+a.duration+" days ago to "+t.name()+" reached its destination and incited the population to revolt, therefore lowering the prestige of the city.")):a.destination.id===i.id()&&(t=this.get_settlement(a.source.id),i.lower_prestige(n),this.ui().notify("The spy sent from "+t.name()+" "+a.duration+" days ago to our city reached its destination and incited our population to revolt, therefore lowering the prestige of our city.")),s=!1)}break;case game.CAMPAIGN_SCOUT:this.ui().notify("The spy you sent "+a.duration+" days ago to a specific place in the world reached its destination and scouted the area. You can now claim the place."),t.scout();break;case game.CAMPAIGN_CARAVAN:let e=0;if(void 0!==a.data.resources){for(let s in a.data.resources)game.is_virtual_resource(s)?"coins"===s&&(e+=a.data.resources[s]):e+=game.calc_price(a.data.resources[s],s),t.add_to_storage(s,a.data.resources[s]);t.is_ruins()||i.raise_influence(a.destination.id,game.CARAVAN_INFLUENCE),this.ui().notify("The caravan sent from "+i.name()+" to "+t.name()+" "+a.duration+" days ago reached its destination.")}}}else if(a.mode===game.ACTION_DIPLOMACY){if(i.is_player()&&!i.can_diplomacy())return this.queue_remove_action(e),!1;switch(a.type){case game.DIPLOMACY_PROPOSE_PACT:i.diplomacy(t,game.DIPLOMACY_PACT);break;case game.DIPLOMACY_PROPOSE_ALLIANCE:i.diplomacy(t,game.DIPLOMACY_ALLIANCE);break;case game.DIPLOMACY_PROPOSE_CEASE_FIRE:i.diplomacy(t,game.DIPLOMACY_CEASE_FIRE);break;case game.DIPLOMACY_PROPOSE_JOIN:i.diplomacy(t,game.DIPLOMACY_VASSAL)}!0===s&&a.source.id===i.id()&&this.ui().notify("The proposal you sent "+a.duration+" days ago to "+t.name()+" was accepted.")}else if(a.mode===game.ACTION_RESEARCH){if(i.is_player()&&!i.can_research())return this.queue_remove_action(e),!1;this.do_research(a.data.handle)}return this.queue_remove_action(e),this}queue_add(e,t,a,s,i){let r,n,o,l,d=e.location();if(null!==t?(n=t.location(),r=this.world().get_distance_in_days(d,n)):(n=null,r=i.duration),a===game.ACTION_CAMPAIGN){if(s===game.CAMPAIGN_ARMY){if(e.id()===this.get_settlement().id()){if(!e.can_recruit_soldiers())return!1;if(o=e.adjust_campaign_cost(game.ARMY_COSTS,r),!e.has_resources(o))return!1;if(!e.remove_resources(o))return!1;if(!e.split_army(i))return!1;if(!e.split_navy(i))return!1;void 0===i.resources&&(i.resources={}),e.diplomacy(t.id(),game.DIPLOMACY_WAR)}this.ui().notify("An army was sent from "+e.name()+" to "+t.name()+" and will reach its destination in "+r+" days.")}else if(s===game.CAMPAIGN_ARMY_RETURN)this.ui().notify("The army sent from "+t.name()+" to "+e.name()+" "+r+" days ago finished its campaign and will be returning home with the spoils of war.");else if(s===game.CAMPAIGN_SPY){if(e.id()===this.get_settlement().id()){if(!e.can_diplomacy())return!1;if(i.espionage>e.espionage())return!1;if(o=e.adjust_campaign_cost(game.SPY_COSTS,r),!e.has_resources(o))return!1;if(!e.remove_resources(o))return!1;e.lower_espionage(i.espionage),i.mission===game.SPY_MISSION_RELIGION&&e.reset_faith()}this.ui().notify("A spy was dispatched from "+e.name()+" to "+t.name()+" and will reach its destination in "+r+" days.")}else if(s===game.CAMPAIGN_SCOUT){if(e.id()===this.get_settlement().id()){if(!e.can_diplomacy())return!1;if(o=e.adjust_campaign_cost(game.SCOUT_COSTS,r),!e.has_resources(o))return!1;if(!e.remove_resources(o))return!1}this.ui().notify("A scout was dispatched from "+e.name()+" to a specific place in the world and will reach its destination in "+r+" days.")}else if(s===game.CAMPAIGN_CARAVAN){if(e.id()===this.get_settlement().id()){if(!e.can_trade())return!1;if(o=e.adjust_campaign_cost(game.CARAVAN_COSTS,r,i.resources),!e.has_resources(o))return!1;if(!e.remove_resources(o))return!1}this.ui().notify("A caravan was dispatched from "+e.name()+" to "+t.name()+" and will reach its destination in "+r+" days.")}}else a===game.ACTION_DIPLOMACY?(r=Math.ceil(r/2),e.id()===this.get_settlement().id()&&this.ui().notify("A diplomacy proposal was dispatched from "+e.name()+" to "+t.name()+" and will reach its destination in "+r+" days.")):a===game.ACTION_RESEARCH&&this.ui().notify("Your city`s Academy started researching "+i.name+" and will finish it in "+r+" days.");return l={mode:a,source:{x:d.x,y:d.y,id:e.id()},duration:r,passed:0,type:s,data:i},null!==t&&(l.destination={x:n.x,y:n.y,id:t.id()}),this._queue.push(l),this.save_and_refresh(),l}queue_remove_action(e){const t=this.ui().get_panel("campaign");return t&&t.destroy(),this._queue.splice(e,1),this}_process_settlements(){const e=this.get_settlements();let t;for(let a=0;a<e.length;a++)if(void 0!==e[a]&&(e[a].is_player()||null!==e[a].ai&&e[a].ai.process()&&this.ui().log("ai","Processed AI with id `"+a+"` for the "+e[a].nice_name()),e[a].is_player())){t=e[a].get_buildings();for(let e=0;e<t.length;e++)void 0!==t[e]&&t[e].process()}}get_settlement(e){const t=this.get_settlements();if(void 0===e)return t[0];if("string"==typeof e){for(let a=0;a<t.length;a++)if(void 0!==t[a]&&t[a].name()===e)return t[a]}else if("number"==typeof e)for(let a=0;a<t.length;a++)if(void 0!==t[a]&&t[a].id()===e)return t[a];return!1}_load_player_settlement(e){const t=e.settlements[0];if(t){t.core=this;const a=new settlement(t);return this.settlements.push(a),a.setup_initial_buildings(t.buildings),e}return!1}get_num_settlements(){return this.settlements.length}get_settlements(){return this.settlements}generate_random_army(e){const t={};for(let a in game.SOLDIERS)e===game.CITY?t[a]="cannon"===a||"catapult"===a?game.get_random(1,2):game.get_random(5,10):e===game.METROPOLIS?t[a]="cannon"===a||"catapult"===a?game.get_random(3,5):game.get_random(20,30):e===game.VILLAGE?"cannon"===a||"catapult"===a||(t[a]=game.get_random(0,2)):e===game.CAMP&&("cannon"===a||"catapult"===a||(t[a]=game.get_random(3,5)));return t}generate_random_navy(e){const t={};for(let a in game.SHIPS)e===game.CITY?t[a]=game.get_random(3,5):e===game.METROPOLIS?t[a]=game.get_random(10,20):e===game.VILLAGE?t[a]=game.get_random(0,2):e===game.CAMP&&(t[a]=0);return t}generate_random_resources(e,t){const a={};let s,i,r={imports:{},exports:{}};!0===e&&(t===game.CITY?(a.coins=game.get_random(1e4,1e6),a.fame=game.get_random(5e4,1e5),a.prestige=game.get_random(game.MIN_PRESTIGE_VALUE,game.MAX_PRESTIGE_VALUE),a.espionage=game.get_random(game.MIN_ESPIONAGE_VALUE,game.MAX_ESPIONAGE_VALUE),a.research=game.get_random(game.MIN_RESEARCH_VALUE,game.MAX_RESEARCH_VALUE),a.faith=game.get_random(game.MIN_FAITH_VALUE,game.MAX_FAITH_VALUE)):t===game.METROPOLIS?(a.coins=game.get_random(1e5,1e7),a.fame=game.get_random(5e5,1e6),a.prestige=game.get_random(5e3,game.MAX_PRESTIGE_VALUE),a.espionage=game.get_random(500,game.MAX_ESPIONAGE_VALUE),a.research=game.get_random(500,game.MAX_RESEARCH_VALUE),a.faith=game.get_random(500,game.MAX_FAITH_VALUE)):t===game.VILLAGE?(a.coins=game.get_random(1e4,3e4),a.fame=game.get_random(1,5e4),a.prestige=game.get_random(game.MIN_PRESTIGE_VALUE,100),a.espionage=game.get_random(game.MIN_ESPIONAGE_VALUE,2),a.research=game.get_random(game.MIN_RESEARCH_VALUE,2),a.faith=game.get_random(game.MIN_FAITH_VALUE,game.MAX_FAITH_VALUE)):t===game.CAMP&&(a.coins=game.get_random(1e3,1e4),a.fame=game.MIN_FAME_VALUE,a.prestige=game.MIN_PRESTIGE_VALUE,a.espionage=game.MIN_ESPIONAGE_VALUE,a.research=game.MIN_RESEARCH_VALUE,a.faith=game.MIN_FAITH_VALUE)),t===game.CITY?s=game.get_random(5,30):t===game.METROPOLIS?s=game.get_random(15,80):t===game.VILLAGE?s=game.get_random(2,10):t===game.CAMP&&(s=game.get_random(2,5));for(let e=0;e<s;e++)i=this.get_random_resource(),a[i]=game.get_random(10,500),t!==game.CITY&&t!==game.METROPOLIS||(a[i]>450?r.exports[i]=game.IMPORTANCE_VITAL:a[i]>300&&a[i]<=450?r.exports[i]=game.IMPORTANCE_HIGH:a[i]>150&&a[i]<=250&&(r.exports[i]=game.IMPORTANCE_MEDIUM));if(t===game.CITY||t===game.METROPOLIS)for(let e=0;e<s;e++)i=this.get_random_resource(),r.imports[i]=game.get_random(game.IMPORTANCE_LOW,game.IMPORTANCE_VITAL);return{resources:a,trades:r}}get_random_resource(){const e=Object.keys(game.RESOURCES),t=e[e.length*Math.random()<<0];return game.is_virtual_resource(t)?this.get_random_resource():t}generate_random_settlement_data(e){let t;void 0===e&&(e=game.get_random(0,game.SETTLEMENTS.length-1));const a=this.generate_random_resources(!0,e);t=e===game.CITY?game.get_random(10,30):e===game.METROPOLIS?game.get_random(30,game.MAX_SETTLEMENT_LEVEL):e===game.VILLAGE?game.get_random(1,5):1;const s={icon:game.get_random(1,game.MAX_SETTLEMENT_ICONS),type:e,player:!1,name:game.get_random_unique(game.SETTLEMENT_NAMES),religion:e===game.CAMP?game.RELIGION_NONE:this.get_random_religion(),nationality:this.get_random_nationality(),level:t,resources:a.resources,army:this.generate_random_army(e),navy:this.generate_random_navy(e),ruins:{}};return e!==game.CITY&&e!==game.METROPOLIS||(s.trades=a.trades),e===game.RUINS&&(s.ruins.resources=this.generate_random_ruins_resources()),s}get_random_nationality(){return game.get_random(1,game.NATIONS.length-1)}get_random_religion(){return game.get_random(1,game.RELIGIONS.length-1)}get_random_personality(){return game.get_random(1,game.PERSONALITIES.length-1)}_create_player_settlement(e,t,a,s,i){const r=this.difficulty();return this.add_settlement({name:t,climate:s,avatar:i,religion:game.RELIGION_NONE,nationality:a,army:game.INITIAL_SEED[r-1].military.army,navy:game.INITIAL_SEED[r-1].military.navy,resources:game.INITIAL_SEED[r-1].resources,core:this},0,{name:e,avatar:i}).setup_initial_buildings(game.INITIAL_SEED[r-1].buildings),this}add_settlement(e,t,a){if(this.get_num_settlements()<=game.MAX_SETTLEMENTS){let s,i,r,n,o=!1;return void 0===t&&(t=this.get_num_settlements()),void 0!==a&&(o=!0),s=void 0!==e.climate?e.climate:game.CLIMATE_TEMPERATE,!1===o?(n=this.world().get_random_location(this.world().get_terrain_from_climate()),r={title:e.type===game.CAMP?"Warlord":"Mayor",avatar:game.get_random(1,game.AVATARS),personality:e.type===game.CAMP?game.PERSONALITY_WARLORD:this.get_random_personality(),name:game.get_random_unique(game.NAMES)}):(n=this.world().get_random_location(this.world().get_terrain_from_climate(s)),t=0,r={name:a.name,title:"",avatar:a.avatar,personality:game.PERSONALITY_BALANCED}),i=new settlement({core:this,properties:{id:t,type:void 0!==e.type?e.type:game.CITY,name:void 0!==e.name?e.name:game.get_random_unique(game.SETTLEMENT_NAMES),player:o,level:void 0!==e.level?e.level:1,climate:s,religion:void 0!==e.religion?e.religion:game.RELIGION_CHRISTIANITY,ruler:r,nationality:e.nationality,icon:void 0!==e.icon?e.icon:1},resources:void 0!==e.resources?e.resources:{},army:void 0!==e.army?e.army:{},navy:void 0!==e.navy?e.navy:{},trades:void 0!==e.trades?e.trades:{},ruins:e.ruins,location:n}),!1===o&&this.get_settlement().status(t,{influence:e.type===game.CAMP?game.MIN_INFLUENCE_VALUE:Math.floor(game.MAX_INFLUENCE_VALUE/2),status:e.type===game.CAMP?game.DIPLOMACY_WAR:game.DIPLOMACY_TRUCE}),this.settlements.push(i),i}return!1}disband_city(e){return!(e<=0)&&(void 0!==this.settlements[e]&&(this.world().remove_city(this.settlements[e]),this.settlements.splice(e,1),!0))}_setup_neighbours(e){let t,a;const s=this.difficulty();let i;if(null!==e)for(let s=1;s<e.settlements.length;s++)a=e.settlements[s],a.core=this,t=new settlement(a),this.settlements.push(t);else for(let e=0;e<game.SETTLEMENTS.length;e++){i=game.INITIAL_SEED[s-1].settlements[e];for(let t=0;t<i;t++)this.add_random_settlement(e)}return this}add_random_settlement(e){const t=this.generate_random_settlement_data(e);return this.add_settlement(t),this}generate_random_ruins_resources(){let e,t={};for(let a in game.RUINS_RESOURCES_REQ)game.is_virtual_resource(a)?t[a]=game.RUINS_RESOURCES_REQ[a]:(e=10*game.RUINS_RESOURCES_REQ[a]/100,t[a]=game.get_random(game.RUINS_RESOURCES_REQ[a]-e,game.RUINS_RESOURCES_REQ[a]+e));return t}level_up(){const e=this.get_settlement();e.level_up(),this.ui().refresh().notify("Your settlement is now level "+e.level()+".")}ui(){return this._ui}advice(){const e=[],t=this.get_settlement();if(t.is_player()){const a=t.get_resources(),s=t.storage(),i=t.num_soldiers(),r=t.num_ships(),n=this.queue(),o=t.get_buildings(),l=[];0===i&&e.push("You have no army, this is an open invitation for attack."),i<10&&i>0&&e.push("You have a small army, try to recruit some more soldiers."),0===r&&e.push("You have no navy, this is an open invitation for attack."),r<3&&r>0&&e.push("You have a small navy, try to construct some more ships."),s.occupied>=s.all?e.push("You have no storage space to store your new goods and they will be lost. Sell some goods or build a warehouse."):s.all-s.occupied<100&&e.push("You will soon run out of storage space and all goods produced will be lost. Sell some goods or build a warehouse."),a.coins<1e3&&e.push("You seem to be losing coins fast, sell some goods or upgrade your houses to get better taxes."),(a.wood<100||a.stones<100||a.woodplanks<50)&&e.push("You are lacking construction materials, buy some stones, wood planks and/or wood off the World Trade Market."),a.prestige<100&&e.push("Your settlement`s prestige is too low, start doing trades with the other settlements to improve it."),a.faith<100&&e.push("Your settlement`s faith is too low, build a Church or upgrade it to be able to gather faith and choose/switch religions."),a.faith===game.MAX_FAITH_VALUE&&e.push("You are at maximum faith, start using it from your settlement`s Church."),a.research<100&&e.push("Your settlement`s research is too low, build an Academy or upgrade it to be able to gather research and use it."),a.research===game.MAX_RESEARCH_VALUE&&e.push("You are at maximum research, start using it for settlement researches, from your Academy."),a.espionage<100&&e.push("Your settlement`s espionage is too low, build an Embassy or upgrade it to be able to gather espionage."),a.espionage===game.MAX_ESPIONAGE_VALUE&&e.push("You are at maximum espionage, start using it for espionage missiong from your Embassy."),a.coins>1e5&&e.push("You have lots of coins, why not invest some in goods?");for(let t in a)game.is_virtual_resource(t)||a[t]>1e3&&e.push("You seem to have a surplus of "+game.get_resource_name(t)+". You can sell some or place it on the Black Market and get coins instead.");for(let a=0;a<n.length;a++)n[a].mode===game.ACTION_CAMPAIGN&&(n[a].destination.id===t.id()&&e.push("There is an army from "+this.get_settlement(n[a].source.id).name()+" marching towards your city!"),n[a].source.id===t.id()&&e.push("Your have an army marching towards "+this.get_settlement(n[a].destination.id).name()+"!"));for(let e=0;e<o.length;e++)void 0!==o[e]&&o[e].has_problems()&&l.push(o[e].name);l.length>0&&e.push((1===l.length?"One":"Several")+" of your buildings ("+l.join(", ")+") "+(1===l.length?"is":"are")+" not working due to a shortage of materials. Buy more goods.")}return e}set_settings(e,t){return void 0===t?this.settings=e:this.settings[e]=t,this}get_settings(e){return void 0===e?this.settings:this.settings[e]}_setup_game(e){let t=this;const a=this.ui();let s=1;return this._setup_neighbours(e),$(".cityname").html(this.get_settlement().name()),$(".cityavatar").css({"background-image":"url("+game.ASSETS_URL+"images/assets/avatars/avatar"+this.get_settlement().ruler().avatar+".png)"}),a.refresh(),setInterval((function(){t.is_paused()||s!==game.SECONDS_TO_DAY?t.is_paused()||s++:(t._do_daily(),s=1)}),1e3),$(document).keyup((function(e){27!==e.keyCode||a.window_exists("#window-options")||(a.show_loader(),a.open_window("options"))})),a.hide_loader(),this.save_and_refresh(),this.ui().citymap_scrollto_building(this.get_settlement().get_building("marketplace")),this}new_game(e,t,a,s,i,r,n){return this.ui().show_loader(),!0===game.ENCRYPTION&&(this.encryption.key=n),this.properties.difficulty=parseInt(r,10),this._world=new world({core:this}),this._create_player_settlement(e,t,a,s,i),this._setup_game(null),!0}load_game_data(e){const t=this.ui();let a,s,i=null;if(!0===game.ENCRYPTION&&(this.encryption.key=e),a=this.get_storage_data(),s=CryptoJS.SHA512(JSON.stringify(a.data)),void 0===a.hash)return t.open_window("error",{error:"Missing game signature.",code:"0x01"}),!1;if(s.toString(CryptoJS.enc.Hex)!==a.hash)return t.open_window("error",{error:"Invalid game signature.",code:"0x02"}),!1;if(a){t.show_loader(),this._world=new world({core:this,elevation:a.data.seeds.elevation,moisture:a.data.seeds.moisture});let e=this.import(a.data);return!1!==e?(i=this._load_player_settlement(e),!1!==i?(this._setup_game(i),!0):(t.open_window("error",{error:"Unable to process game data.",code:"0x05"}),!1)):(t.open_window("error",{error:"Invalid game data.",code:"0x03"}),!1)}return!1}pause(){return!1===this.is_paused()&&(this.properties.paused=!0,this.ui().log("game","Game is paused.")),this}unpause(){return!0===this.is_paused()&&(this.properties.paused=!1,this.ui().log("game","Game is resumed.")),this}is_paused(){return this.properties.paused}_setup_audio(){return this.music=$("#music").get(0),this.music.volume=.2,!0===game.AUTOSTART_MUSIC&&this.music.play(),this}get_building_config_data(e){return"string"==typeof e?game.BUILDINGS[game.BUILDINGS.findIndexByHandle(e)]:"number"==typeof e&&game.BUILDINGS[e]}_check_for_events(){const e=Math.random().toFixed(5);let t,a;for(let s=0;s<game.EVENTS.length;s++)if(a=game.EVENTS[s],e<=a.chance)return t=a,t.core=this,new event(t),this;return this}save_and_refresh(){return this.achievements_process(),this.save(),this.ui().refresh(),this}refresh_trades(){const e=this.get_settlements();for(let t=0;t<e.length;t++)void 0!==e[t]&&e[t].is_urban()&&!e[t].is_player()&&e[t].reset_trades();return this.ui().notify("World Market trades have been refreshed, settlements are looking to make new purchases and sales.","World Market"),this}_refresh_influence(){const e=this.get_settlements();for(let t=1;t<e.length;t++)void 0!==e[t]&&(e[t].is_urban()?this.get_settlement().religion().id===e[t].religion().id?this.get_settlement().raise_influence(e[t].id(),game.YEARLY_INFLUENCE_GAIN):this.get_settlement().get_diplomacy_status(e[t].id())===game.DIPLOMACY_VASSAL||this.get_settlement().get_diplomacy_status(e[t].id())===game.DIPLOMACY_ALLIANCE?this.get_settlement().raise_influence(e[t].id()):this.get_settlement().lower_influence(e[t].id(),game.YEARLY_INFLUENCE_LOSS):this.get_settlement().religion().id===e[t].religion().id?this.get_settlement().raise_influence(e[t].id(),game.YEARLY_INFLUENCE_GAIN):this.get_settlement().get_diplomacy_status(e[t].id())!==game.DIPLOMACY_VASSAL&&this.get_settlement().get_diplomacy_status(e[t].id())!==game.DIPLOMACY_ALLIANCE||this.get_settlement().raise_influence(e[t].id()));return this}get_tax_modifier(e){let t=0;for(let e=0;e<this._research.length;e++)if(void 0!==this._research[e]){let a=this.get_research_config_data(this._research[e].handle);if(void 0!==a.effect)for(let e in a.effect)void 0!==a.effect[e]&&"tax"===e&&(t+=a.effect[e])}return t}get_prod_modifier(e){let t=0;for(let a=0;a<this._research.length;a++)if(void 0!==this._research[a]){let s=this.get_research_config_data(this._research[a].handle);if(void 0!==s.effect)for(let a in s.effect)if(void 0!==s.effect[a]&&"buildings"===a)for(let i in s.effect[a])e.handle===i&&(t+=s.effect[a][i])}return t}version(){return game.VERSION}difficulty(e){return void 0!==e&&(this.properties.difficulty=e),this.properties.difficulty}mode(e){return void 0!==e&&(this.properties.mode=e),this.properties.mode}get_hero_config_data(e){return"string"==typeof e&&game.HEROES[game.HEROES.findIndexByHandle(e)]}world(){return this._world}level_to_fame(e){let t=.2;if(e<=5?t=1.2:e>5&&e<=10?t=.6:e>10&&e<=15?t=.5:e>15&&e<=20||e>20&&e<=25?t=.3:e>25&&e<=30?t=.2:e>30&&e<=35?t=.24:e>35&&e<=40?t=.4:e>40&&e<=45?t=.5:e>45&&e<=50&&(t=.6),1===e)return 100;{let a=this.level_to_fame(e-1);return Math.floor(a+a*t)}}get_buildings_for_settlement(e){let t,a=[];for(let s=0;s<game.BUILDINGS.length&&(t=game.BUILDINGS[s],!(void 0!==t.requires.settlement_level&&e.level()<t.requires.settlement_level))&&(void 0===t.requires.climate||-1!==$.inArray(e.climate().id,t.requires.climate));s++)a.push(t.handle);return a}static is_virtual_resource(e){return void 0!==game.RESOURCES[e]&&"virtual"===game.RESOURCES[e].category}static get_damage_points(e){let t=2*e.stats.strength+e.stats.agility,a=0,s=0;for(let a=0;a<e.items.length;a++)e.items[a]&&(e.items[a].stats.strength&&(t+=2*e.items[a].stats.strength),e.items[a].stats.agility&&(t+=e.items[a].stats.agility));for(let i=0;i<e.items.length;i++)e.items[i].type===game.ITEM_TYPE_WEAPON&&(a+=e.items[i].stats.damageMin+t,s+=e.items[i].stats.damageMax+t);return{value:t,min:0!==a?a:1,max:0!==s?s:t}}static get_mana_points(e){let t=50*e.stats.intellect+10*e.stats.spirit;for(let a=0;a<e.items.length;a++)e.items[a]&&(e.items[a].stats.intellect&&(t+=50*e.items[a].stats.intellect),e.items[a].stats.spirit&&(t+=10*e.items[a].stats.spirit));return t}static get_health_points(e){let t=30*e.stats.stamina+5*e.stats.strength;for(let a=0;a<e.items.length;a++)e.items[a]&&(e.items[a].stats.stamina&&(t+=30*e.items[a].stats.stamina),e.items[a].stats.strength&&(t+=5*e.items[a].stats.strength));return t}static resource_exists(e){for(let t in game.RESOURCES)if(t===e)return!0;return!1}static time_since(e){let t=[[2,"One second","1 second from now"],[60,"seconds",1],[120,"One minute","1 minute from now"],[3600,"minutes",60],[7200,"One hour","1 hour from now"],[86400,"hours",3600],[172800,"One day","tomorrow"],[604800,"days",86400],[1209600,"One week","next week"],[2419200,"weeks",604800],[4838400,"One month","next month"],[29030400,"months",2419200],[58060800,"One year","next year"],[290304e4,"years",29030400],[580608e4,"One century","next century"],[580608e5,"centuries",290304e4]],a=(new Date-e)/1e3,s=1;a<0&&(a=Math.abs(a),s=1);let i,r=0;for(;i=t[r++];)if(a<i[0])return"string"==typeof i[2]?i[s]:Math.floor(a/i[2])+" "+i[1];return e}static get_up_number(e){return 10*Math.floor(e/10)}static get_random(e,t){return Math.floor(Math.random()*(t-e+1))+e}static get_random_by_importance(e){return game.get_up_number(game.get_random(10*Math.floor(Math.random()*e)+10,10*Math.floor(Math.random()*e)+20))}static get_resource_name(e){return game.RESOURCES[e].name}static calc_price_minus_discount(e,t,a){return Math.ceil(Math.ceil(game.RESOURCES[t].price-a)*e)}static calc_price(e,t){return Math.ceil(e*game.RESOURCES[t].price)}static calc_price_plus_discount(e,t,a){return Math.ceil(Math.ceil(game.RESOURCES[t].price+a)*e)}static get_now(){let e=new Date;return e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}static nice_numbers(e){return e>=1e9?(e/1e9).toFixed(1).replace(/\.0$/,"")+"G":e>=1e6?(e/1e6).toFixed(1).replace(/\.0$/,"")+"M":e>=1e3?(e/1e3).toFixed(1).replace(/\.0$/,"")+"K":e}static get_random_unique(e){let t=game.get_random(0,e.length-1),a=e[t];return e.splice(t,1),a}static sanitize_string(e){return e.replace(/[^a-z0-9+]-/gi,"-")}}$(document).ready((function(){new game})),game.AUTOSTART_MUSIC=!1,game.ENCRYPTION=!1,game.ASSETS_URL="./",game.SECONDS_TO_DAY=10,game.AVATARS=99,game.VERSION="0.3.0."+((new Date).getMonth()+1)+(new Date).getDate()+(new Date).getFullYear(),game.DEBUG=!0,game.STORAGE_KEY="civitas",game.DIFFICULTY_EASY=1,game.DIFFICULTY_MEDIUM=2,game.DIFFICULTY_HARD=3,game.DIFFICULTY_HARDCORE=4,game.NOTIFICATION_MISSING_RES=1,game.NOTIFICATION_PAUSED=2,game.NOTIFICATION_MISSING_REQ=3,game.NOTIFICATION_SETTLEMENT_LOW_LEVEL=4,game.MODE_SINGLEPLAYER=1,game.MODE_MULTIPLAYER=2,game.NOTIFY_ERROR=0,game.NOTIFY_ACHIEVEMENT=1,game.NOTIFY_NORMAL=2,game.NOTIFY_EVENT=3,game.NOTIFY_RESEARCH=4,game.NOTIFY_RELIGION=5,game.NOTIFY_WAR=6,game.MAX_CONSOLE_LINES=5e3,game.API_VERSION="0.3",game.API_ENTRY_POINT="https://civitas-api.test/api/",game.API_URL=game.API_ENTRY_POINT+game.API_VERSION+"/",game.SEASONS=["spring","summer","autumn","winter"],game.SEASON_SPRING=0,game.SEASON_SUMMER=1,game.SEASON_AUTUMN=2,game.SEASON_WINTER=3,game.RELIGIONS=["none","christianity","islam","judaism","buddhism","hinduism","confucianism","taoism"],game.RELIGION_NONE=0,game.RELIGION_CHRISTIANITY=1,game.RELIGION_ISLAM=2,game.RELIGION_JUDAISM=3,game.RELIGION_BUDDHISM=4,game.RELIGION_HINDUISM=5,game.RELIGION_CONFUCIANISM=6,game.RELIGION_TAOISM=7,game.MIN_FAITH_VALUE=1,game.MAX_FAITH_VALUE=1e3,game.DIPLOMACIES=["truce","war","pact","alliance","cease fire","pact proposed","alliance proposed","cease fire proposed","proposed to join you","vassal"],game.CAMPAIGN_ARMY=1,game.CAMPAIGN_CARAVAN=2,game.CAMPAIGN_SPY=3,game.CAMPAIGN_ARMY_RETURN=4,game.DIPLOMACY_TRUCE=0,game.DIPLOMACY_WAR=1,game.DIPLOMACY_PACT=2,game.DIPLOMACY_ALLIANCE=3,game.DIPLOMACY_CEASE_FIRE=4,game.DIPLOMACY_PROPOSE_PACT=5,game.DIPLOMACY_PROPOSE_ALLIANCE=6,game.DIPLOMACY_PROPOSE_CEASE_FIRE=7,game.DIPLOMACY_PROPOSE_JOIN=8,game.DIPLOMACY_VASSAL=9,game.EXPORT_INFLUENCE=2,game.IMPORT_INFLUENCE=1,game.EXPORT_PRESTIGE=2,game.IMPORT_PRESTIGE=1,game.MIN_PRESTIGE_VALUE=1,game.MAX_PRESTIGE_VALUE=1e4,game.MIN_ESPIONAGE_VALUE=1,game.MAX_ESPIONAGE_VALUE=1e3,game.MAX_ESPIONAGE_SUCESS_RATE=100,game.MIN_INFLUENCE_VALUE=1,game.MAX_INFLUENCE_VALUE=100,game.YEARLY_INFLUENCE_LOSS=2,game.YEARLY_INFLUENCE_GAIN=2,game.SPY_MISSIONS=["none","adopt religion","influence settlement","steal resources","instigate turmoil"],game.SPY_MISSION_NONE=0,game.SPY_MISSION_RELIGION=1,game.SPY_MISSION_INFLUENCE=2,game.SPY_MISSION_STEAL_RESOURCES=3,game.SPY_MISSION_INSTIGATE=4,game.CARAVAN_COSTS={coins:100,donkeys:10,wood:10,ropes:2,provisions:1},game.SPY_COSTS={coins:50,spyglasses:1,weapons:1,provisions:1},game.SCOUT_COSTS={coins:50,spyglasses:1,provisions:1},game.SCOUT_MISSION_INFO=1,game.ARMY_COSTS={coins:200,provisions:1},game.CARAVAN_INFLUENCE=5,game.ACTION_DIPLOMACY=0,game.ACTION_CAMPAIGN=1,game.ACTION_RESEARCH=2,game.ACTION_BUILD_PLACE=2,game.NATIONS=["none","phoenician","carthaginian","greek","egyptian","assyrian","roman","thracian","sudanese","spanish","sumerian","chinese","indian","franks","russian","nigerian","malinese","mongolian","tibetan","persan","khmer","japanese","french"],game.NATION_PHOENICIAN=1,game.NATION_CARTHAGINIAN=2,game.NATION_GREEK=3,game.NATION_EGYPTIAN=4,game.NATION_ASSYRIAN=5,game.NATION_ROMAN=6,game.NATION_THRACIAN=7,game.NATION_SUDANESE=8,game.NATION_SPANISH=9,game.NATION_SUMERIAN=10,game.NATION_CHINESE=11,game.NATION_INDIAN=12,game.NATION_FRANKS=13,game.NATION_RUSSIAN=14,game.NATION_NIGERIAN=15,game.NATION_MALINESE=16,game.NATION_MONGOLIAN=17,game.NATION_TIBETAN=18,game.NATION_PERSAN=19,game.NATION_KHMER=20,game.NATION_JAPANESE=21,game.NATION_FRENCH=22,game.CLIMATES=["none","temperate","tropical","arid","polar"],game.CLIMATE_TEMPERATE=1,game.CLIMATE_TROPICAL=2,game.CLIMATE_ARID=3,game.CLIMATE_POLAR=4,game.PERSONALITIES=["none","balanced","diplomat","warlord"],game.PERSONALITY_BALANCED=1,game.PERSONALITY_DIPLOMAT=2,game.PERSONALITY_WARLORD=3,game.BATTLEGROUND_ATTACK=1,game.BATTLEGROUND_DEFENSE=2,game.SOLDIERS={militia:{name:"Militia",attack:1,defense:1,moves:1,cost:{coins:100,bread:1,weapons:1}},swordsman:{name:"Swordsman",attack:2,defense:2,moves:2,cost:{coins:300,bread:1,meat:1,weapons:2}},axeman:{name:"Axeman",attack:3,defense:1,moves:2,cost:{coins:400,bread:1,meat:3,weapons:2}},bowman:{name:"Bowman",attack:3,defense:1,ranged:5,moves:3,cost:{coins:500,bread:1,meat:3,weapons:4}},pikeman:{name:"Pikeman",attack:2,defense:4,moves:2,cost:{coins:700,provisions:1,iron:1,weapons:5,armor:1}},crossbowman:{name:"Crossbowman",attack:5,defense:2,moves:3,ranged:8,cost:{coins:1e3,provisions:2,iron:1,weapons:7,armor:1}},knight:{name:"Knight",attack:6,defense:6,moves:4,cost:{coins:1500,provisions:3,iron:1,weapons:9,armor:4}},legionnaire:{name:"Legionnaire",attack:7,defense:7,moves:2,cost:{coins:2500,provisions:6,iron:2,weapons:12,armor:12}},crusader:{name:"Crusader",attack:9,defense:9,moves:4,cost:{coins:3e3,provisions:8,iron:4,weapons:15,armor:15}},cannon:{name:"Cannon",attack:15,defense:1,moves:0,siege:!0,ranged:20,cost:{coins:25e3,provisions:30,gunpowder:30,iron:40,steel:20,cannons:1}},catapult:{name:"Catapult",attack:50,defense:1,ranged:20,siege:!0,moves:0,cost:{coins:1e5,provisions:100,gunpowder:150,iron:140,catapults:1}}},game.MERCENARIES=[{name:"Legio I Adiutrix",description:"Legio prima Adiutrix is a Roman legion.",handle:"legio1",icon:1,army:{axeman:300,knight:100,crossbowman:220,pikeman:200,legionnaire:100},cost:12e4},{name:"Legio II Augusta",description:"Legio secunda Augusta is a Roman legion.",handle:"legio2",icon:8,army:{axeman:220,knight:100,crossbowman:300,pikeman:100,legionnaire:100},cost:13e4},{name:"Legio III Cyrenaica",description:"Legio tertia Cyrenaica is a Roman legion.",handle:"legio3",icon:15,army:{axeman:280,crossbowman:500,pikeman:180,legionnaire:100},cost:1e5},{name:"Legio IV Flavia Felix",description:"Legio quarta Flavia Felix is a Roman legion.",handle:"legio4",icon:9,army:{militia:140,axeman:190,knight:90,bowman:20,crossbowman:100,pikeman:180,legionnaire:100},cost:19e4},{name:"Legio V Alaudae",description:"Legio quinta Alaudae is a Roman legion.",handle:"legio5",icon:16,army:{militia:100,axeman:200,bowman:190,legionnaire:130},cost:11e4},{name:"Legio VI Victrix",description:"Legio sexta Victrix is a Roman legion.",handle:"legio6",icon:22,army:{militia:330,axeman:230,knight:100,bowman:100,legionnaire:100},cost:14e4},{name:"Varangian Guard",description:"The Varangian Guard is an elite unit of the Byzantine Army.",handle:"varangian",icon:18,army:{militia:410,axeman:210,bowman:190,crossbowman:100,pikeman:220},cost:12e4},{name:"Magna Societas Catalanorum",description:"The Catalan Company of the East, officially the Magna Societas Catalanorum is a company of mercenaries founded by Roger de Flor.",handle:"catalan",icon:23,army:{axeman:310,knight:120,bowman:210,pikeman:310},cost:1e5},{name:"Army of the Western Garden",description:"The Army of the Western Garden is an army established during the reign of Emperor Ling in the Eastern Han Dynasty.",handle:"western",icon:27,army:{axeman:290,knight:40,bowman:170,pikeman:300},cost:9e4},{name:"Scholae Palatinae",description:"The Scholae Palatinae are an elite military guard unit, usually ascribed to the Roman Emperor Constantine the Great as a replacement for the equites singulares Augusti, the cavalry arm of the Praetorian Guard.",handle:"scholae",icon:26,army:{axeman:10,knight:200,bowman:100,pikeman:210},cost:29e4},{name:"Imperial Guards",description:"The Imperial Guards of the Tang Dynasty, also known as the Forbidden Troops were initially honor guards of the emperor and garrisons of the imperial capitals during the Tang`s dinasty formation in early 7th century.",handle:"forbidden",icon:25,army:{axeman:290,knight:80,bowman:100,pikeman:210},cost:13e4},{name:"Navy of the Order of Saint John",description:"The navy of the Order of Saint John, also known as the Maltese Navy, was the first navy of a chivalric order, established in the Middle Ages, around the late 12th century.",handle:"maltesenavy",icon:28,navy:{corsair:19,caravel:14,warship:12,shipoftheline:10},cost:15e5}],game.SHIPS={corsair:{name:"Corsair",attack:5,defense:5,cost:{coins:1e3,wood:200,iron:50,provisions:50,ropes:10,cottonfabric:5,cannons:5,gunpowder:2}},caravel:{name:"Caravel",attack:10,defense:10,cost:{coins:3e3,wood:400,iron:80,provisions:60,ropes:30,cottonfabric:10,cannons:20,gunpowder:5,weapons:10}},frigatte:{name:"Frigatte",attack:17,defense:8,cost:{coins:3e3,wood:400,iron:80,provisions:60,ropes:30,cottonfabric:20,cannons:30,gunpowder:10,weapons:10}},galleon:{name:"Galleon",attack:15,defense:15,cost:{coins:5e3,wood:300,woodplanks:600,iron:150,provisions:100,ropes:80,cottonfabric:30,cannons:20,gunpowder:15,weapons:15}},warship:{name:"Warship",attack:35,defense:30,cost:{coins:1e4,wood:400,woodplanks:800,iron:500,steel:100,provisions:200,ropes:100,cottonfabric:40,cannons:50,weapons:20,gunpowder:20,carpets:10}},shipoftheline:{name:"Ship of the Line",attack:55,defense:50,cost:{coins:15e3,wood:500,woodplanks:1e3,coal:500,iron:1500,steel:400,provisions:200,barrels:100,ropes:100,cottonfabric:50,cannons:100,gunpowder:30,weapons:50}}},game.MIN_RESEARCH_VALUE=1,game.MAX_RESEARCH_VALUE=1e3,game.TECHNOLOGIES=[{name:"Agriculture",handle:"agriculture",description:"The development of agriculture enables the human population to grow many times larger than could be sustained by hunting and gathering.",duration:80,cost:{research:500,coins:2e5,woodplanks:200,wheat:100,tools:10},effect:{buildings:{cottonfarm:1,grainfarm:1,grapesfarm:1,rosenursery:1,tobaccofarm:1,almondsfarm:1,coffeefarm:1,datesfarm:1,indigofarm:1,sugarfarm:1}}},{name:"Animal Enclosures",handle:"animalenclosure",description:"Animal enclosures will allow your animal farms to raise more livestock.",duration:70,cost:{research:400,coins:3e5,woodplanks:100,iron:100},effect:{buildings:{cattlefarm:1,pigfarm:1,goatfarm:1,apiary:1}}},{name:"Archeology",handle:"archeology",description:"Researching Archeology enables settlement ruins to show up on the world map.",duration:96,cost:{research:game.MAX_RESEARCH_VALUE,coins:2e5,prestige:100},effect:{ruins:!0}},{name:"Canned Food",handle:"cannedfood",description:"Canning is a method of preserving food in which the food contents are processed and sealed in an airtight container (jars like Mason jars, and steel and tin cans).",duration:50,cost:{research:500,coins:2e5,meals:100,bread:50,meat:50,iron:20},effect:{buildings:{cookhouse:1,butcher:1,bakery:1}}},{name:"Circular Saw",handle:"circularsaw",description:"The circular saw was invented around the end of the 18th century as a rip-saw to convert logs into lumber in sawmills and various claims have been made as to who invented the circular saw.",duration:120,cost:{research:300,coins:2e5,wood:200,woodplanks:100},effect:{buildings:{carpenter:2,lumberjack:2}}},{name:"Diplomacy",handle:"diplomacy",description:"Researching diplomacy will give a boost to your Embassy`s production of fame and espionage.",duration:320,cost:{research:game.MAX_RESEARCH_VALUE,coins:5e5,soap:100,jewelery:100,alcohol:10,perfume:10,donkeys:50},effect:{buildings:{embassy:10}}},{name:"Distillery",handle:"distillery",description:"If you need more beer or wine in your settlement, research this technology.",duration:120,cost:{research:500,coins:5e5,alcohol:200,barrels:100,bottles:100,wine:100,coal:400,copper:100},effect:{buildings:{winery:1,brewery:1}}},{name:"Militia",handle:"militia",description:"Allows you to freely recruit 10 militia men each year.",duration:30,cost:{research:500,coins:1e5,provisions:100,weapons:20},effect:{buildings:{tavern:10}}},{name:"Minerals",handle:"minerals",description:"Digging deeper into the mountains, your settlers will find more minerals if you research this technology.",duration:120,cost:{research:700,coins:5e5,steel:200,glass:1e3,iron:100},effect:{buildings:{ironmine:1,coppermine:1,goldmine:1}}},{name:"Projectiles",handle:"projectiles",description:"Researching heavy projectiles will give a production boost to your Cannon Foundry and Catapult Workshop.",duration:200,cost:{research:game.MAX_RESEARCH_VALUE,coins:8e5,steel:200,gunpowder:100,coal:300,copper:50,sulphur:100,glass:1e3},effect:{buildings:{cannonfoundry:1,catapultworkshop:1}}},{name:"Railway",handle:"railway",description:"Researching the railway will break in half the time required to travel from one city to another.",duration:300,cost:{research:game.MAX_RESEARCH_VALUE,coins:1e6,steel:1e3,glass:1e3,gunpowder:500,iron:1e3,woodplanks:100},effect:{distance:2}},{name:"Sewing machine",handle:"sewingmachine",description:"Sewing machine technology will give a boost to your buildings responsible with manufacturing clothes and textile goods.",duration:36,cost:{research:500,coins:1e5,cottonfabric:100,cotton:100,leather:100,steel:100,copper:20,glass:100},effect:{buildings:{clothingfactory:2,weaver:2,furrier:2}}},{name:"Taxation",handle:"taxation",description:"Researching taxation will provide an extra 100 coins from each of your houses, regardless of their level.",duration:260,cost:{research:game.MAX_RESEARCH_VALUE,coins:1e6,gold:1e3,silver:1e3},effect:{tax:100}},{name:"Trawlers",handle:"trawlers",description:"Researching this technology will provide your ships with better trawl nets, therefore giving a boost to your settlement`s Shipyard.",duration:36,cost:{research:200,coins:1e5,cottonfabric:100,cotton:100},effect:{buildings:{shipyard:1,fisherman:1}}}],game.BUILDINGS_ALL=["marketplace","lumberjack","barracks","warehouse","mill","castle","stonequarry","claymine","ironmine","trapper","almondsfarm","almondsfield","tavern","shipyard","pigfarm","cattlefarm","pigfield","cattlefield","house1","house2","house3","house4","house5","house6","house7","datesfarm","datesfield","house8","house9","house10","house11","church","bakery","butcher","grainfarm","grainfield","ironsmelter","tannery","furrier","coppermine","goldmine","goldsmelter","coppersmelter","armory","coffeefarm","coffeefield","cottonfarm","cottonfield","sugarfarm","spicefarm","spicefield","sugarfield","silkfarm","silkfield","coffeeroaster","quartzmine","grapesfarm","grapesfield","winery","carpenter","pottery","jeweler","toolmaker","saltprocessor","charcoalburnerhut","opticiansworkshop","papermill","printingpress","redsmithsworkshop","ropeyard","glassworks","provisions","silkweaver","gunpowdermill","goatfarm","goatfield","coalmine","carpetmanufacturer","apiary","beehive","barrelcooperage","brewery","candlemakersworkshop","indigofarm","indigofield","sugarmill","rosenursery","rosefield","fisherman","catapultworkshop","cannonfoundry","cosmetics","tradingpost","clothingfactory","weaver","embassy","academy","marzipanworkshop","brickworks","tobaccofarm","tobaccofield","cookhouse"],game.BUILDINGS_CATEGORIES={Municipal:["academy","church","embassy","marketplace","shipyard","tavern","tradingpost","warehouse"],Housing:["house1","house2","house3","house4","house5","house6","house7","house8","house9","house10","house11"],Food:["bakery","butcher","cookhouse","fisherman","mill"],Mines:["claymine","coalmine","coppermine","goldmine","ironmine","quartzmine","stonequarry"],Farms:["almondsfarm","almondsfield","apiary","beehive","cattlefarm","cattlefield","coffeefarm","coffeefield","cottonfarm","cottonfield","datesfarm","datesfield","goatfarm","goatfield","grainfarm","grainfield","grapesfarm","grapesfield","indigofarm","indigofield","pigfarm","pigfield","rosenursery","rosefield","silkfarm","silkfield","spicefarm","spicefield","sugarfarm","sugarfield","tobaccofarm","tobaccofield"],Industry:["barrelcooperage","brewery","brickworks","candlemakersworkshop","carpenter","charcoalburnerhut","clothingfactory","coppersmelter","furrier","glassworks","goldsmelter","gunpowdermill","ironsmelter","lumberjack","pottery","ropeyard","saltprocessor","trapper","tannery","toolmaker","weaver"],Luxury:["carpetmanufacturer","coffeeroaster","jeweler","marzipanworkshop","opticiansworkshop","papermill","cosmetics","printingpress","redsmithsworkshop","silkweaver","sugarmill","winery"],Military:["armory","cannonfoundry","castle","catapultworkshop","barracks","provisions"]},game.BUILDINGS=[{name:"Marketplace",handle:"marketplace",description:"The Marketplace is the main building of your settlement and provides a place for the settlers to gather. It cannot be demolished.",storage:5e4,is_municipal:!0,levels:5,large:!0,visible_upgrades:!0,position:{x:1600,y:500},production:{fame:3},cost:{coins:1e5},requires:{settlement_level:1}},{name:"Warehouse",handle:"warehouse",description:"The Warehouse is a trade building that provides market carts that pick up goods from production buildings. A Warehouse also adds extra storage space for the materials in your city.",storage:1e5,levels:10,visible_upgrades:!0,position:{x:670,y:970},cost:{coins:15e4,wood:500,bricks:30,woodplanks:200,stones:500,tools:50},requires:{settlement_level:16}},{name:"Church",handle:"church",description:"A Church provides a massive fame boost to your settlement by using coins and converting them to fame, as well as providing faith for free. Faith allows you to choose a religion for your settlement.",is_municipal:!0,levels:3,large:!0,position:{x:1600,y:820},production:{fame:5,faith:1},materials:{coins:50},cost:{coins:1e4,wood:20,woodplanks:20,stones:20,tools:10},requires:{settlement_level:3}},{name:"Trading Post",handle:"tradingpost",description:"The Trading Post is a merchant building that allows you to trade resources with the other settlements in the world. Also allows you to use the powerful Auctioneer.",is_municipal:!0,storage:1e4,visible_upgrades:!0,levels:5,position:{x:2300,y:1370},cost:{coins:15e3,wood:40,woodplanks:40,stones:40},requires:{settlement_level:4}},{name:"Academy",handle:"academy",description:"The Academy provides a minor amount of fame each day as well as research for this settlement at the expense of coins. All technologies will be researched here by your settlement`s scholars.",is_municipal:!0,visible_upgrades:!0,large:!0,levels:5,position:{x:1320,y:640},production:{fame:5,research:1},materials:{coins:100},cost:{coins:1e5,woodplanks:500,stones:500,tools:20},requires:{settlement_level:10}},{name:"Embassy",handle:"embassy",description:"An Embassy is required to propose pacts, declare war, send spies to other settlements, basically any diplomacy.",is_municipal:!0,large:!0,levels:3,position:{x:1840,y:740},production:{fame:5,espionage:1},materials:{coins:50},cost:{coins:1e5,woodplanks:100,stones:100,tools:10},requires:{settlement_level:10}},{name:"Provision House",handle:"provisions",description:"The Provision House requires various goods to produce provisions for military units and expeditions.",levels:3,position:{x:290,y:780},production:{provisions:2},materials:{meals:1,clothes:1,leather:1,pottery:1,ropes:1},cost:{coins:1e5,wood:200,stones:200,woodplanks:100},requires:{settlement_level:8}},{name:"Tavern",handle:"tavern",description:"The Tavern is the place where heroes of the known (and unknown) world hang around. If you are looking to recruit Achilles, build a Tavern and he might show up.",is_municipal:!0,levels:3,position:{x:1920,y:550},materials:{coins:20,meals:1},cost:{coins:1e5,woodplanks:200,stones:200,wood:200,wine:100,bricks:10,meat:100,tools:50},requires:{settlement_level:16,buildings:{academy:2}}},{name:"Shipyard",handle:"shipyard",description:"The Shipyard helps you expand your settlement overseas by housing your ships and providing you with fish, oil and an ultra-small chance to gather pearls.",large:!0,levels:5,position:{x:2430,y:900},chance:{pearls:.005},cost:{coins:2e5,wood:200,woodplanks:200,stones:100,ropes:10,barrels:10,tools:20},production:{fish:3,oil:1},requires:{settlement_level:10}},{name:"Barracks",handle:"barracks",description:"The Barracks is your main base of defense and attack. If you plan on going to war, you will need one. It also raises your settlement`s prestige.",levels:5,visible_upgrades:!0,large:!0,position:{x:1970,y:950},production:{prestige:1},cost:{coins:5e4,wood:200,woodplanks:200,stones:160,tools:10},requires:{settlement_level:8,buildings:{provisions:1}}},{name:"Castle",handle:"castle",description:"The Castle is your main base of operations. It houses your settlement`s soldiers and provides you with prestige and some extra fame.",is_municipal:!0,large:!0,levels:2,position:{x:700,y:1200},production:{fame:100,prestige:1},materials:{coins:200},cost:{coins:1e6,wood:500,iron:500,woodplanks:500,stones:500,bricks:500,steel:50,tools:100},requires:{settlement_level:20,buildings:{barracks:1,provisions:2}}},{name:"Lumberjack",handle:"lumberjack",description:"A Lumberjack provides you with wood which you can use for creating additional buildings, resources or sell to other settlements.",levels:5,position:{x:1840,y:340},production:{wood:4},cost:{coins:2e3,stones:20},requires:{settlement_level:1}},{name:"Carpenter",handle:"carpenter",description:"The Carpenter processes the wood from the Lumberjack into wood planks that are required for more advanced buildings.",visible_upgrades:!0,levels:5,position:{x:2060,y:460},materials:{wood:2},production:{woodplanks:2},cost:{coins:5e3,wood:10,stones:10},requires:{settlement_level:3}},{name:"Stone Quarry",handle:"stonequarry",description:"A Stone Quarry produces stone blocks that are essential for the construction of any settlement`s buildings.",visible_upgrades:!0,levels:6,position:{x:930,y:290},production:{stones:1},cost:{coins:2e3,wood:20},chance:{mosaic:.001,limestone:.01,sand:.05},requires:{settlement_level:1}},{name:"Gold Mine",handle:"goldmine",description:"The Gold Mine extracts gold ore, that can be smelted later into gold bars.",visible_upgrades:!0,levels:5,position:{x:1010,y:200},production:{goldore:3},chance:{gems:4e-4,diamonds:4e-4},cost:{coins:1e4,woodplanks:20,stones:20},requires:{settlement_level:6}},{name:"Coal Mine",handle:"coalmine",description:"The Coal Mine extracts coal from the mountains you own (provided you own some).",visible_upgrades:!0,levels:5,position:{x:1180,y:240},production:{coal:4},chance:{gems:1e-4,diamonds:1e-4},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:7}},{name:"Iron Mine",handle:"ironmine",description:"The Iron Mine extracts iron ore, that can be smelted later into iron bars.",visible_upgrades:!0,levels:5,position:{x:380,y:620},production:{ironore:3},chance:{gems:2e-4,diamonds:2e-4},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:3}},{name:"Salt Processor",handle:"saltprocessor",description:"A Salt Processor processes seawater and retrieves salt.",visible_upgrades:!0,levels:5,position:{x:500,y:540},production:{salt:3},cost:{coins:8e3,wood:20,stones:20},requires:{settlement_level:5}},{name:"Clay Mine",handle:"claymine",description:"The Clay Mine produces clay which is required later for bricks and pottery.",levels:5,position:{x:2900,y:800},production:{clay:2},cost:{coins:5e3,wood:20,stones:20},chance:{limestone:.01,sand:.1},requires:{settlement_level:2}},{name:"Copper Mine",handle:"coppermine",description:"The copper mine extracts copper ore, that can be smelted later into copper bars.",visible_upgrades:!0,levels:5,position:{x:1310,y:110},production:{copperore:3},chance:{gems:1e-4,diamonds:2e-4},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:5}},{name:"Flour Mill",handle:"mill",description:"The Flour Mill produces flour from the wheat cultivated by your Grain Farm.",visible_upgrades:!0,levels:5,position:{x:1360,y:1180},production:{flour:2},materials:{wheat:2},cost:{coins:1e4,woodplanks:20,stones:20},requires:{settlement_level:3}},{name:"Bakery",handle:"bakery",description:"The Bakery creates bread from flour, therefore providing your settlers with basic food.",visible_upgrades:!0,levels:5,position:{x:550,y:910},production:{bread:3},materials:{flour:2},cost:{coins:15e3,woodplanks:30,stones:30},requires:{settlement_level:4}},{name:"Pottery Workshop",handle:"pottery",description:"The Pottery Workshop uses a high-temperature kiln and clay to create pottery for the inhabitants of your settlement.",levels:3,position:{x:1740,y:1240},production:{pottery:4},materials:{clay:3},cost:{coins:2e4,woodplanks:30,stones:30,clay:100},requires:{settlement_level:8}},{name:"Gunpowder Mill",handle:"gunpowdermill",description:"A Gunpowder Mill is creating highly useful (and unstable) gunpowder from the sulphur found in your Charcoal Burner`s Hut.",levels:3,position:{x:500,y:1370},production:{gunpowder:1},materials:{sulphur:10},cost:{coins:3e4,woodplanks:30,stones:30,bricks:50,clay:50,tools:20},requires:{settlement_level:26}},{name:"Armory",handle:"armory",description:"The Armory is a major building that produces weapons and armor for your soldiers. If you want to conquer other settlements, you will need to build one and keep it stocked with materials.",visible_upgrades:!0,levels:5,position:{x:1820,y:180},production:{weapons:1,armor:1},materials:{iron:10,wood:2,leather:8,copper:4},cost:{coins:5e4,woodplanks:100,stones:100,tools:20},requires:{settlement_level:9}},{name:"Butcher",handle:"butcher",description:"The Butcher slaughters cattle, pigs or goats for meat, providing meat, a food type that is more nutritious. Hides will be processed further at the Tannery.",visible_upgrades:!0,levels:5,position:{x:420,y:850},production:{meat:3,hides:2,tallow:1},materials:[{pig:1,cattle:1,goat:1},{salt:1}],cost:{coins:2e4,woodplanks:40,stones:40},requires:{settlement_level:5}},{name:"Iron smelter",handle:"ironsmelter",description:"The Iron Smelter (or foundry) smelts iron ore into iron bars using coal.",visible_upgrades:!0,levels:5,position:{x:1140,y:100},production:{iron:4},materials:{ironore:4,coal:2},chance:{steel:.05},cost:{coins:3e4,woodplanks:40,stones:50},requires:{settlement_level:7}},{name:"Copper smelter",handle:"coppersmelter",description:"The Copper Smelter smelts copper ore into copper bars using coal.",visible_upgrades:!0,levels:5,position:{x:1480,y:150},production:{copper:2},materials:{copperore:4,coal:1},cost:{coins:4e4,woodplanks:50,stones:50},requires:{settlement_level:8}},{name:"Gold smelter",handle:"goldsmelter",description:"The Gold Smelter smelts gold ore into gold bars using coal.",visible_upgrades:!0,levels:5,position:{x:1680,y:230},production:{gold:1},materials:{goldore:4,coal:1},cost:{coins:4e4,woodplanks:55,bricks:5,stones:55},requires:{settlement_level:12}},{name:"Trapper`s Lodge",handle:"trapper",description:"The trapper captures wild animals and slaughters them, gathering their furs and some meat.",visible_upgrades:!0,levels:5,position:{x:790,y:410},production:{furs:2,meat:1},cost:{coins:15e3,wood:40,stones:40},requires:{settlement_level:6}},{name:"Furrier`s Workshop",handle:"furrier",description:"The furrier uses furs from the Trapper`s Lodge mixed with salt and processes them into fur coats that will help your settlers during the cold winters.",levels:3,position:{x:2510,y:1560},production:{furcoats:1},materials:{furs:2,salt:2},cost:{coins:15e3,woodplanks:30,stones:40},requires:{settlement_level:9}},{name:"Clothing Factory",handle:"clothingfactory",description:"The Clothing Factory produces clothes for your settlement. You don`t want naked citizens, do you?",levels:3,position:{x:1580,y:1280},production:{clothes:1},materials:{cottonfabric:2},cost:{coins:15e3,wood:40,bricks:10,stones:40},requires:{settlement_level:15}},{name:"Weaver`s Hut",handle:"weaver",description:"The weaver uses a hefty amount of cotton to produce cotton fabric for your settlers` clothes.",visible_upgrades:!0,levels:5,position:{x:1230,y:1250},production:{cottonfabric:2},materials:{cotton:4},cost:{coins:1e4,wood:30,stones:30},requires:{settlement_level:12}},{name:"Tannery",handle:"tannery",description:"The Tannery produces leather from processed animal hides.",visible_upgrades:!0,levels:5,position:{x:930,y:1110},production:{leather:2},materials:{hides:4,salt:1},cost:{coins:2e4,wood:35,stones:40},requires:{settlement_level:8}},{name:"Coffee roaster",handle:"coffeeroaster",description:"The Coffee Roaster uses the coffee beans from your Coffee Farm and processes them into coffee.",levels:3,position:{x:2150,y:1430},production:{coffee:1},materials:{coffeebeans:4},cost:{coins:7e4,woodplanks:80,stones:60,bricks:30,tools:20},requires:{settlement_level:28,buildings:{tradingpost:1}}},{name:"Sugar Mill",handle:"sugarmill",description:"The Sugar Mill processes any sugar cane you have in storage into sugar.",visible_upgrades:!0,levels:5,position:{x:2700,y:880},production:{sugar:1},materials:{sugarcane:4},cost:{coins:7e4,woodplanks:80,stones:60,bricks:30,tools:10},requires:{settlement_level:26,buildings:{tradingpost:1}}},{name:"Winery",handle:"winery",description:"The Winery uses the grapes from your Grapes Farm and processes them into wine. It uses either barrels or bottles, depending on what you have in storage.",levels:5,position:{x:2520,y:510},production:{wine:2},materials:[{barrels:1,bottles:1},{grapes:4}],chance:{alcohol:.01},cost:{coins:5e4,wood:50,bricks:10,stones:40,tools:10},requires:{settlement_level:14}},{name:"Optician`s Shop",handle:"opticiansworkshop",description:"The optician uses copper and glass to create glasses for your settlers.",levels:3,position:{x:1280,y:330},production:{glasses:1},materials:{copper:2,glass:2},cost:{coins:81e3,woodplanks:70,stones:70,bricks:30,tools:10},requires:{settlement_level:24}},{name:"Paper Mill",handle:"papermill",description:"The Paper Mill uses wood to produce paper, which is used together with indigo to produce books at the Printing House.",visible_upgrades:!0,levels:5,position:{x:1080,y:340},production:{paper:2},materials:{wood:1},cost:{coins:83e3,woodplanks:60,stones:50,bricks:30,tools:10},requires:{settlement_level:22}},{name:"Printing Press",handle:"printingpress",description:"The Printing Press produces books from paper using indigo ink.",visible_upgrades:!0,levels:5,position:{x:1540,y:430},production:{books:1},materials:{paper:4,indigo:1},cost:{coins:84e3,woodplanks:100,stones:100,bricks:30,tools:10},requires:{settlement_level:28}},{name:"Cosmetics",handle:"cosmetics",description:"The Cosmetics manufacturer produces soap and perfume.",levels:3,position:{x:2720,y:1360},production:{perfume:1,soap:1},materials:{roses:8,tallow:8,honey:1,cocoa:1,alcohol:1},cost:{coins:9e4,woodplanks:80,stones:40,bricks:20,tools:10},requires:{settlement_level:30,buildings:{tradingpost:1}}},{name:"Redsmith`s Workshop",handle:"redsmithsworkshop",description:"The Redsmith`s Workshop processes copper and candles into candlesticks.",visible_upgrades:!0,levels:5,position:{x:520,y:720},production:{candlesticks:1},materials:{copper:3,candles:2},cost:{coins:75e3,wood:70,bricks:30,stones:50,tools:10},requires:{settlement_level:22}},{name:"Ropeyard",handle:"ropeyard",description:"The Ropeyard produces ropes that are needed for your city`s ships.",levels:3,position:{x:3e3,y:1030},production:{ropes:1},materials:{cotton:2},cost:{coins:15e3,wood:70,stones:60,tools:10},requires:{settlement_level:10}},{name:"Glassworks",handle:"glassworks",description:"The Glassworks processes quartz, sand and coal into glass.",levels:3,position:{x:1400,y:1320},production:{glass:1},materials:{quartz:2,sand:3,coal:1},chance:{bottles:.2},cost:{coins:5e4,wood:50,bricks:10,stones:80},requires:{settlement_level:22}},{name:"Carpet Mill",handle:"carpetmanufacturer",description:"The Carpet Mill produces carpets.",levels:3,position:{x:2020,y:1370},production:{carpets:1},materials:{cottonfabric:4,indigo:2},cost:{coins:5e4,wood:50,bricks:30,stones:80,tools:10},requires:{settlement_level:26,buildings:{tradingpost:1}}},{name:"Marzipan Workshop",handle:"marzipanworkshop",description:"The Marzipan Workshop uses milk, almonds and sugar from city storage to create delicious marzipan. Your settlers will definitely appreciate it.",levels:3,position:{x:1090,y:850},production:{marzipan:1},materials:{almonds:2,sugar:2,milk:4},cost:{coins:5e4,wood:50,bricks:40,stones:80,tools:10},requires:{settlement_level:26,buildings:{tradingpost:1}}},{name:"Silk Weaver",handle:"silkweaver",description:"The Silk Weaver requires cotton, gold and silk and produces brocade robes.",levels:3,position:{x:1220,y:970},production:{robes:1},materials:{silk:2,cotton:1,gold:2},cost:{coins:5e4,wood:50,bricks:30,stones:80,tools:10},requires:{settlement_level:23,buildings:{tradingpost:1}}},{name:"Quartz Mine",handle:"quartzmine",description:"The Quartz Mine provides your city with quartz.",levels:3,position:{x:700,y:710},production:{quartz:2},cost:{coins:4e4,wood:50,bricks:30,stones:90},requires:{settlement_level:16,climate:[game.CLIMATE_ARID]}},{name:"Apiary",handle:"apiary",description:"The Apiary produces honey and bees wax for use in candles.",levels:3,position:{x:1140,y:1150},production:{wax:2,honey:1},cost:{coins:4e4,wood:50,bricks:30,stones:40},requires:{settlement_level:16,buildings:{beehive:1},climate:[game.CLIMATE_TROPICAL,game.CLIMATE_TEMPERATE]}},{name:"Bee Hive",handle:"beehive",description:"The Bee Hive is required for an Apiary to produce bees wax and honey.",position:{x:1260,y:1100},cost:{coins:2e3,wood:10,clay:20},requires:{settlement_level:16,climate:[game.CLIMATE_TROPICAL,game.CLIMATE_TEMPERATE]}},{name:"Barrel Cooperage",handle:"barrelcooperage",description:"The Barrel Cooperage creates barrels from wood and iron.",levels:3,position:{x:910,y:430},production:{barrels:2},materials:{wood:3,iron:1},cost:{coins:25e3,wood:80,stones:70,tools:10},requires:{settlement_level:9}},{name:"Brewery",handle:"brewery",description:"The Brewery brews beer from wheat. Beer is needed for higher-level houses or your city`s navy.",visible_upgrades:!0,levels:5,position:{x:650,y:1120},production:{beer:2},materials:{barrels:1,wheat:2},chance:{alcohol:.01},cost:{coins:25e3,wood:60,stones:70},requires:{settlement_level:9}},{name:"Candlemaker`s Hut",handle:"candlemakersworkshop",description:"The Candlemaker Hut produces candles for your settlers` houses.",visible_upgrades:!0,levels:5,position:{x:640,y:480},production:{candles:1},materials:{wax:2,cotton:1},cost:{coins:45e3,woodplanks:80,stones:60,bricks:20,tools:10},requires:{settlement_level:20}},{name:"Catapult Workshop",handle:"catapultworkshop",description:"The Catapult Workshop builds catapults, the ultimate siege weapon.",levels:3,position:{x:2800,y:1450},production:{catapults:1},materials:{wood:100,steel:12,iron:20,stones:30,coal:5,woodplanks:40,ropes:10},cost:{coins:25e4,woodplanks:200,stones:300,bricks:30,tools:20},requires:{settlement_level:20}},{name:"Cannon Foundry",handle:"cannonfoundry",description:"The Cannon Foundry is responsable with the manufacture of the city cannons.",visible_upgrades:!0,levels:5,position:{x:760,y:560},production:{cannons:1},materials:{wood:70,copper:30,iron:10,coal:20,steel:15,woodplanks:10,ropes:2,gunpowder:6},cost:{coins:2e5,woodplanks:200,stones:300,bricks:30,tools:20},requires:{settlement_level:18}},{name:"Charcoal Burner`s Hut",handle:"charcoalburnerhut",description:"The Charcoal Burner`s Hut burns wood into coal and sulphur, which is needed by all your smelters.",levels:3,position:{x:1370,y:230},production:{coal:4,sulphur:1},materials:{wood:2},cost:{coins:25e3,wood:50,stones:50,bricks:50},requires:{settlement_level:15}},{name:"House",handle:"house1",description:"Houses provide coins through taxes and space for your settlers.",tax:5,levels:6,visible_upgrades:!0,position:{x:1200,y:770},cost:{wood:10,coins:1e3},materials:{bread:1},requires:{settlement_level:1}},{name:"House",handle:"house2",description:"Houses provide coins through taxes and space for your settlers.",tax:10,levels:6,visible_upgrades:!0,position:{x:1080,y:680},cost:{wood:10,coins:2e3},materials:{bread:1},requires:{settlement_level:1}},{name:"House",handle:"house3",description:"Houses provide coins through taxes and space for your settlers.",tax:15,levels:6,visible_upgrades:!0,position:{x:960,y:590},cost:{woodplanks:10,stones:20,coins:3e3},materials:{bread:1,meat:1},requires:{settlement_level:3}},{name:"House",handle:"house4",description:"Houses provide coins through taxes and space for your settlers.",tax:20,levels:6,visible_upgrades:!0,position:{x:1200,y:580},cost:{woodplanks:10,stones:20,coins:4e3},materials:{bread:1,meat:1,pottery:1},requires:{settlement_level:6,buildings:{church:1}}},{name:"House",handle:"house5",description:"Houses provide coins through taxes and space for your settlers.",tax:25,levels:6,visible_upgrades:!0,position:{x:1080,y:500},cost:{woodplanks:25,stones:35,coins:5e3},materials:{fish:1,meat:2,pottery:1,beer:1},requires:{settlement_level:10,buildings:{church:1}}},{name:"House",handle:"house6",description:"Houses provide coins through taxes and space for your settlers.",tax:30,levels:6,visible_upgrades:!0,position:{x:1300,y:840},cost:{woodplanks:30,stones:45,bricks:10,coins:6e3},materials:{meals:1,pottery:1},requires:{settlement_level:16,buildings:{church:2}}},{name:"House",handle:"house7",description:"Houses provide coins through taxes and space for your settlers.",tax:35,levels:6,visible_upgrades:!0,position:{x:1470,y:780},cost:{woodplanks:40,stones:80,bricks:15,coins:7e3},materials:{meals:1,pottery:1,candlesticks:1},requires:{settlement_level:20,buildings:{academy:1}}},{name:"House",handle:"house8",description:"Houses provide coins through taxes and space for your settlers.",tax:40,levels:6,visible_upgrades:!0,position:{x:1700,y:390},cost:{woodplanks:50,stones:100,bricks:20,coins:8e3},materials:{meals:1,milk:1,pottery:1,candlesticks:1,furcoats:1},requires:{settlement_level:25,buildings:{academy:2}}},{name:"House",handle:"house9",description:"Houses provide coins through taxes and space for your settlers.",tax:50,levels:6,visible_upgrades:!0,position:{x:1840,y:480},cost:{woodplanks:100,stones:200,bricks:25,coins:1e4},materials:{meals:1,milk:1,pottery:1,candlesticks:1,furcoats:1,perfume:1,soap:1},requires:{settlement_level:30,buildings:{academy:2}}},{name:"House",handle:"house10",description:"Houses provide coins through taxes and space for your settlers.",tax:60,cost:{woodplanks:100,stones:200,bricks:30,coins:1e4},materials:{meals:2,milk:1,pottery:1,candlesticks:1,furcoats:1,perfume:1,soap:1,robes:1},position:{x:1390,y:550},levels:6,visible_upgrades:!0,requires:{settlement_level:32,buildings:{church:2,academy:2}}},{name:"House",handle:"house11",description:"Houses provide coins through taxes and space for your settlers.",tax:80,cost:{woodplanks:100,stones:200,bricks:35,coins:1e4},materials:{meals:2,milk:1,pottery:1,candlesticks:1,furcoats:1,perfume:1,robes:1,soap:1,marzipan:1},position:{x:1400,y:910},levels:6,visible_upgrades:!0,requires:{settlement_level:36,buildings:{church:2,academy:2}}},{name:"Dates farm",handle:"datesfarm",description:"The Dates Farm cultivates dates.",production:{dates:1},levels:3,position:{x:2480,y:770},cost:{coins:4e4,wood:30,stones:30},requires:{settlement_level:36,buildings:{datesfield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Dates field",handle:"datesfield",description:"An Dates Field is required for the Dates Farm to operate.",position:{x:2380,y:660},cost:{coins:5e3,wood:10,clay:20},requires:{settlement_level:36,climate:[game.CLIMATE_TROPICAL]}},{name:"Almonds farm",handle:"almondsfarm",description:"The Almonds Farm cultivates almonds for marzipan manufacture or export.",production:{almonds:1},levels:3,position:{x:2050,y:1610},cost:{coins:4e4,wood:30,stones:30},requires:{settlement_level:36,buildings:{almondsfield:1},climate:[game.CLIMATE_ARID,game.CLIMATE_TROPICAL]}},{name:"Almonds field",handle:"almondsfield",description:"An Almonds Field is required for the Almonds Farm to operate.",position:{x:2190,y:1570},cost:{coins:5e3,wood:10,clay:20},requires:{settlement_level:36,climate:[game.CLIMATE_ARID,game.CLIMATE_TROPICAL]}},{name:"Cattle Farm",handle:"cattlefarm",description:"A Cattle Farm grows cattle so your settlers can eat food that is more nutritious than bread. Also produces milk and has a low chance for producing cheese.",visible_upgrades:!0,levels:5,position:{x:1510,y:1470},production:{cattle:1,milk:1},chance:{cheese:.01},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:3,buildings:{cattlefield:1}}},{name:"Cattle field",handle:"cattlefield",description:"A Cattle Field is required for the Cattle Farm to operate.",position:{x:1630,y:1420},cost:{coins:1e3,wood:10,clay:20},requires:{settlement_level:3}},{name:"Pig Farm",handle:"pigfarm",description:"A Pig Farm grows pigs so your settlers can eat food that is more nutritious than bread.",visible_upgrades:!0,production:{pig:1},levels:5,position:{x:1900,y:1150},cost:{coins:15e3,wood:20,stones:20},requires:{settlement_level:3,buildings:{pigfield:1}}},{name:"Pig field",handle:"pigfield",description:"A Pig Field is required for the Pig Farm to operate.",position:{x:1900,y:1270},cost:{coins:1500,wood:10,clay:20},requires:{settlement_level:3}},{name:"Goat Farm",handle:"goatfarm",description:"A Goat Farm grows cattle so your settlers can eat food that is more nutritious than bread. Also produces milk and has a low chance for producing cheese.",visible_upgrades:!0,production:{goat:1,milk:1},chance:{cheese:.01},levels:5,position:{x:2300,y:900},cost:{coins:15e3,wood:20,stones:20},requires:{settlement_level:10,buildings:{goatfield:1}}},{name:"Goat field",handle:"goatfield",description:"A Goat Field is required for the Goat Farm to operate.",position:{x:2150,y:900},cost:{coins:1500,wood:10,clay:20},requires:{settlement_level:10}},{name:"Grain farm",handle:"grainfarm",description:"A Grain Farm cultivates wheat that will be later transformed into bread, and your settlers will live happily ever after.",visible_upgrades:!0,production:{wheat:2},levels:6,position:{x:2660,y:590},cost:{coins:1e4,wood:20,stones:20},requires:{settlement_level:2,buildings:{grainfield:1}}},{name:"Grain field",handle:"grainfield",description:"A Grain Field is required for the Grain Farm to operate.",position:{x:2550,y:670},cost:{coins:1e3,wood:10,clay:20},requires:{settlement_level:2}},{name:"Grapes farm",handle:"grapesfarm",description:"A Grapes Farm provides your city with grapes for wine processing.",levels:3,position:{x:2380,y:460},production:{grapes:2},cost:{coins:15e3,wood:20,stones:20},requires:{settlement_level:16,buildings:{grapesfield:1},climate:[game.CLIMATE_TEMPERATE]}},{name:"Grapes field",handle:"grapesfield",description:"A Grapes Field is required for the Grapes Farm to operate.",position:{x:2290,y:530},cost:{coins:1500,wood:10,clay:20},requires:{settlement_level:16,climate:[game.CLIMATE_TEMPERATE]}},{name:"Coffee farm",handle:"coffeefarm",description:"A Coffee Farm cultivates coffee beans in your city, ready to be processed into coffee.",levels:3,position:{x:1840,y:1e3},production:{coffeebeans:2},cost:{coins:6e4,wood:20,stones:20},requires:{settlement_level:36,buildings:{coffeefield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Coffee field",handle:"coffeefield",description:"A Coffee Field is required for the Coffee Farm to operate.",position:{x:1740,y:1080},cost:{coins:6e3,wood:10,clay:40},requires:{settlement_level:36,climate:[game.CLIMATE_TROPICAL]}},{name:"Cotton farm",handle:"cottonfarm",description:"A Cotton Farm provides your city with cotton.",levels:3,position:{x:1870,y:1590},production:{cotton:3},cost:{coins:2e4,wood:20,stones:20},requires:{research:"agriculture",settlement_level:10,buildings:{cottonfield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Cotton field",handle:"cottonfield",description:"A Cotton Field is required for the Cotton Farm to operate.",position:{x:1970,y:1530},cost:{coins:2e3,wood:10,clay:20},requires:{research:"agriculture",settlement_level:10,climate:[game.CLIMATE_TROPICAL]}},{name:"Silk farm",handle:"silkfarm",description:"A Silk Farm provides your city with silk.",levels:3,position:{x:1450,y:340},production:{silk:1},cost:{coins:8e4,wood:20,stones:20},requires:{research:"agriculture",settlement_level:28,buildings:{silkfield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Silk field",handle:"silkfield",description:"A Silk Field is required for the Silk Farm to operate.",position:{x:1600,y:320},cost:{coins:8e3,wood:10,clay:100},requires:{research:"agriculture",settlement_level:28,climate:[game.CLIMATE_TROPICAL]}},{name:"Sugar Cane Farm",handle:"sugarfarm",description:"A Sugar Cane Farm provides your city with sugar cane.",levels:3,position:{x:2280,y:780},production:{sugarcane:2},cost:{coins:1e5,wood:20,stones:20},requires:{settlement_level:24,buildings:{academy:1,sugarfield:1},climate:[game.CLIMATE_TEMPERATE]}},{name:"Sugar field",handle:"sugarfield",description:"A Sugar Field is required for the Sugar Farm to operate.",position:{x:2100,y:720},cost:{coins:1e4,wood:10,clay:100},requires:{settlement_level:24,climate:[game.CLIMATE_TEMPERATE]}},{name:"Indigo farm",handle:"indigofarm",description:"The Indigo Farm produces indigo that can be turned to ink and used to create books.",levels:5,visible_upgrades:!0,position:{x:2440,y:1440},production:{indigo:1},cost:{coins:2e5,wood:30,stones:30,clay:30},requires:{settlement_level:20,buildings:{indigofield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Indigo field",handle:"indigofield",description:"An Indigo Field is required for the Indigo Farm to operate.",position:{x:2320,y:1500},cost:{coins:1e4,wood:10,clay:100},requires:{settlement_level:20,climate:[game.CLIMATE_TROPICAL]}},{name:"Tobacco farm",handle:"tobaccofarm",description:"A Tobacco Farm produces cigars from tobacco.",levels:3,position:{x:1750,y:1500},production:{cigars:1},materials:{tobacco:2},cost:{coins:2e5,wood:30,stones:30,bricks:30},requires:{settlement_level:25,buildings:{tobaccofield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Tobacco field",handle:"tobaccofield",description:"The Tobacco Field produces tobacco that will be further processed by the Tobacco Farm",position:{x:1870,y:1460},production:{tobacco:1},cost:{coins:1e4,wood:10,clay:100},requires:{settlement_level:20,climate:[game.CLIMATE_TROPICAL]}},{name:"Rose Farm",handle:"rosenursery",description:"The Rose Farm produces roses which are needed to manufacture perfume.",levels:3,position:{x:2780,y:670},production:{roses:1},cost:{coins:2e4,wood:50,stones:50,clay:50},requires:{research:"agriculture",settlement_level:26,buildings:{academy:1,rosefield:1},climate:[game.CLIMATE_ARID,game.CLIMATE_TROPICAL]}},{name:"Roses field",handle:"rosefield",description:"A Roses Field is required for the Rose Farm to operate.",position:{x:2650,y:740},cost:{coins:1e4,wood:10,clay:100},requires:{research:"agriculture",settlement_level:26,climate:[game.CLIMATE_ARID,game.CLIMATE_TROPICAL]}},{name:"Spice Farm",handle:"spicefarm",description:"The Spice Farm is responsable for the production of spices.",levels:3,position:{x:1500,y:970},production:{spices:1},cost:{coins:2e5,wood:60,stones:60,clay:60},requires:{settlement_level:32,buildings:{academy:1,spicefield:1},climate:[game.CLIMATE_TROPICAL]}},{name:"Spice field",handle:"spicefield",description:"A Spice Field is required for the Spice Farm to operate.",position:{x:1600,y:1030},cost:{coins:2e4,wood:40,clay:300},requires:{settlement_level:32,climate:[game.CLIMATE_TROPICAL]}},{name:"Toolmaker Workshop",handle:"toolmaker",description:"Tools are needed to construct higher-level buildings, and a Toolmaker Workshop will create those for your settlement.",visible_upgrades:!0,levels:5,position:{x:1640,y:110},production:{tools:2},materials:{wood:1,iron:1,coal:1,copper:1},cost:{coins:3e4,wood:80,stones:80,clay:60},requires:{settlement_level:8}},{name:"Jeweler",handle:"jeweler",description:"The Jeweler processes pearls into jewelery for your settlers (and traders).",levels:3,position:{x:1780,y:1350},production:{jewelery:1},materials:{pearls:10},cost:{coins:55e3,wood:60,stones:60,bricks:60,tools:10},requires:{settlement_level:20}},{name:"Brickworks",handle:"brickworks",description:"The Brickworks uses coal and clay to manufacture bricks, needed for higher-level buildings in your settlement.",levels:5,position:{x:620,y:640},production:{bricks:2},materials:{clay:3,coal:1},cost:{coins:1e4,wood:20,stones:20,clay:20},requires:{settlement_level:12,buildings:{claymine:1}}},{name:"Cookhouse",handle:"cookhouse",description:"The Cookhouse makes meals for your houses, army, navy and expeditions.",levels:3,position:{x:1020,y:970},production:{meals:2},materials:{bread:2,meat:2,fish:2,wine:1},cost:{coins:2e4,wood:100,stones:20,bricks:20,woodplanks:10},requires:{settlement_level:10}},{name:"Fisherman",handle:"fisherman",description:"The fisherman reels in fish from the waters surrounding your settlement.",visible_upgrades:!0,levels:5,position:{x:2830,y:970},chance:{pearls:.003},production:{fish:1},cost:{coins:15e3,wood:100,stones:20,bricks:20,woodplanks:10},requires:{settlement_level:8}}],game.WORLD_SIZE_WIDTH=64,game.WORLD_SIZE_HEIGHT=64,game.WORLD_HEX_SIZE=24,game.WORLD_BEAUTIFY=!0,game.WORLD_GRID=!0,game.WORLD_EROSION=1.8,game.IMPORTANCE_VITAL=50,game.IMPORTANCE_HIGH=30,game.IMPORTANCE_MEDIUM=20,game.IMPORTANCE_LOW=10,game.TRADES_ADDITION=10,game.TRADES_DISCOUNT=20,game.FAME_PER_TRADE=50,game.BLACK_MARKET_DISCOUNT=80,game.AUCTIONEER_DISCOUNT=20,game.SETTLEMENTS=["city","village","metropolis","camp","ruins"],game.CITY=0,game.VILLAGE=1,game.METROPOLIS=2,game.CAMP=3,game.RUINS=4,game.MAX_SETTLEMENTS=100,game.MAX_SETTLEMENT_ICONS=3,game.MAX_SETTLEMENT_LEVEL=99,game.POPULATION_PER_LEVEL=2300,game.MIN_FAME_VALUE=1,game.RUINS_TIME_TO_BUILD=7200,game.RUINS_RESOURCES_REQ={coins:1e8,wood:1e4,woodplanks:5e4,stones:5e4,limestone:1e4,mosaic:1e3,meals:1e4,tools:1e3,bricks:5e4,sand:1e3,steel:1e4,gold:1e4,silver:1e4,clothes:1e4,furcoats:1e4,gems:1e3,diamonds:1e3,champagne:1e3,cigars:1e3,jewelery:1e3,robes:1e3,perfume:1e3,soap:1e3,silk:1e3},game.SETTLEMENT_NAMES=["Alexandria","Rome","Carthage","Constantinople","Karakorum","Niniveh","Damascus","Thebes","Men-nefer","Aria","Zeffari","Laenteglos","Eastborne","Larton","Nantgarw","Kingcardine","Swindlincote","Cewmann","Rochdale","Malrton","Falcon Haven","Rotherham","Ironforge","Halivaara","Ularee","Snake Canyon","Dornwich","Stawford","Eastborne","Dry Gulch","Tamworth","Ferncombe","Rutherglen","Dewhurst","Haedleigh","Chepstow","Peshawar","Uruk","Abydos","Actium","Tripolis","Troia","Chengdu","Mombasa","Apullum","Byblos","Abu","Pi-Ramesses","Djedu","Kyrene","Athens","Menat Khufu","Niani","Novgorod","Sarmizegetusa","Sigiriya","Selima Oasis","Tournai","Taruga","Amarna","Toledo","Mogadishu","Xinjiang","Yinxu","Bublidrus","Mylyra","Ialezus","Thebeia","Demaphos","Smyrnione","Dimonassa","Cyrarnassus","Posigeneia","Kasmigeneia","Khemdjumunein","Sakpi","Kersatennu","Farsou","Dehsa","Djasumar","Absaitunis","Avsi","Wasvarmeru","Behdju","Galamia","Pekies","VyVyrodari","Viasseto","Messibria","Molfeserta","Quanes","Braga","Seicer","Legara","Albadolid","Getastela","Drepanum","Canusium","Mogontiacum","Leucarum","Pautalia","Scallabis","Chernogan","Yelatrov","Novomoksary","Chistongelsk","Timaryevsk","Naberkuta","Koloyevka","Obnirodvinsk","Beloredimir","Kaspikarino","Troten","Neunsee","Weveltals","Oudenhout","Plailimar","Puciennes","Bernsloh","Geiselkau","Waterlina","Clonkenny","Terbommel","Drachnisse","Werdenthal","Erzell","Arrabona","Ugernum","Bulla Regia","Umbracum","Aquae Armenetiae","Isara","Regium Lepidum","Aquisgranium","Saint Petersburg","Gerasa","Besontio","Rhegium","Argentoratum","Apamea","Hadrianopolis","Byzantium","Ravenna","Carnotum","Podium Aniciense","Beroe Augusta Trajana","Dubris","Avenio","Luentinum","Castra Nicia","Crotona","Concordia Sagittaria","Vibo Valentia","Portus","Faventia","Tchidimbo","Concala","Berlowa","Bagangoua","Bangamo","Bossemlindao","Boti","Bonnamar","Dilobunda","Lupugani","Mimomo","Nkolabo","Mindo","Kindamno","Kanyesisi","Mwinirenje","Tbouleang","Kamphon","Jamya","Yogtar","Ambu","Kubak","Wainlet","Shwebyu","Gaguio","Cartangas","Surakham","Kratai","Sa Pha","My Tinh","Neurau","Hollatrenk","Woluten","Forwerpen","Sarsir","Pérission","Alsfeld","Goldburg","Thurway","Watertowel","Hengeloopen","Alkningen","Mornach","Gorpen","Novoupa","Ozyosinsk","Cheregansk","Sibanovsk","Vserodvinsk","Polelensk","Novokugadan","Belgovgrad","Chelyakala","Tovodsk","Kensato","Kurishiri","Aridakoshi","Pingguan","Zoajiang","Ulaanteeg","Nomsai","Tangye","Chuncheon","Ikju"],game.NAMES=["Caesar","Cronus","Dido","Genghis","Khufu","Musa I","Sennacherib","Pepi","Hatshepsut","Clovis","Gilgamesh","Dalai Lama","Ashoka","Charlemagne","Darius","Ivan III","Qin Shi Huang","Ozymandias","Timur","Pol Pot","Napoleon","Hirohito","Ivan Sirko","Peter the Great","Pan","Victor","Lekan","Sheamus","Itumeleng","Varya","Gervas","Stefanija","Meera","Sethunya","Soupi","Vestmar","Numi","Marteinn","Saithor","Haki","Ragnar","Qiao","Zeng","Zhan","Guo","Yan","Zarpiya","Hada","Kikarnahsu","Tarhuntapiya","Karnapaka","Dambi","Silalluhi","Zuwahallati","Sakkummilla","Hapu","Ammalli","Kawiya","Nisasar","Abba","Rishabha","Sena","Kalpana","Nupur","Anu","Parvati","Rani","Chandrama","Dhani","Gallus","Flavius","Decimus","Titus","Papia","Aburia","Volusia","Macrinia","Lucia","Lucretia","Dubov","Filimonov","Mikhail","Larissa","Zenaide","Lenora","Natasha","Muhammet","Haydar","Hizir","Orhan","Huriye","Fehime","Seher","Qadir","Lim","Yami","Veasna","Baadur","Sharar","Yuuta","Hallie","Anson","Davis","Ondina","Zan","Gibs","Soth","Naoki","Hachirou","Irmhild","Thiago","Stefano","Gerardo","Alonso","Mario","Consuela","Graciela","Alicia","Mariangel","Qimmiabruk","Qajak","Akrittok","Kuk`uq","Noahtakmiut","Kinaktok","Iluliaq","Taktuq","Aquutaq","Tulugaq","Uyarak","Onartok","Karpok","Husain","Farhan","Umar","Safiyya","Yanduza","Fatimah","Tasufin","Hammad"],game.EVENTS=[{name:"Great earthquake",description:"A great earthquake sweeps across your city destroying the settlement`s BUILDING in the process.",chance:1e-5,destroy:!0},{name:"Royal marriage",description:"A marriage was arranged between a member of your family and the royal family of SETTLEMENT. This raises your influence on SETTLEMENT by INFLUENCE. Good job!",chance:1e-4,raise:{influence:10}},{name:"Raiders attack",description:"A band of raiders attacked the outskirts of your settlement. Repairing the affected buildings costs your settlement COINS coins.",chance:2e-4,lower:{coins:1e3}},{name:"Discovery",description:"The engineers in your settlement made a great discovery which made you more famous, thus gaining FAME fame and RESEARCH research.",chance:4e-4,raise:{fame:100,research:10}},{name:"Foreign spy discovered",description:"A spy from SETTLEMENT was found hiding in your settlement, as a reward for finding him you gain ESPIONAGE espionage.",chance:.002,raise:{espionage:10}},{name:"Your spy uncovered",description:"One of your spies in SETTLEMENT was discovered, SETTLEMENT`s ruler is angry so you lose PRESTIGE prestige.",chance:.003,lower:{prestige:10}}],game.RESOURCE_CATEGORIES=["food","construction","animals","industry","military","luxury","exotic"],game.RESOURCES={coins:{name:"Coins",category:"virtual",toolbar:!0},fame:{name:"Fame",category:"virtual"},prestige:{name:"Prestige",category:"virtual",toolbar:!0},espionage:{name:"Espionage",category:"virtual"},research:{name:"Research",category:"virtual"},faith:{name:"Faith",category:"virtual"},alcohol:{name:"Alcohol",price:80,category:"industry"},almonds:{name:"Almonds",price:180,category:"exotic"},armor:{name:"Armor",price:220,category:"military"},barrels:{name:"Barrels",price:60,category:"industry"},beer:{name:"Beer",price:30,category:"industry"},books:{name:"Books",price:100,category:"luxury"},bottles:{name:"Bottles",price:10,category:"industry"},bread:{name:"Bread",price:30,category:"food",toolbar:!0},bricks:{name:"Bricks",price:40,category:"construction"},candles:{name:"Candles",price:100,category:"luxury"},candlesticks:{name:"Candlesticks",price:170,category:"luxury"},cannons:{name:"Cannons",price:700,category:"military"},carpets:{name:"Carpets",price:400,category:"luxury"},catapults:{name:"Catapults",price:1200,category:"military"},cattle:{name:"Cattle",price:43,category:"animals"},champagne:{name:"Champagne",price:300,imported:!0,category:"luxury"},cheese:{name:"Cheese",price:130,category:"food"},cigars:{name:"Cigars",price:290,category:"luxury"},clay:{name:"Clay",price:20,category:"construction",toolbar:!0},clothes:{name:"Clothes",price:104,category:"industry"},coal:{name:"Coal",price:36,category:"industry"},cocoa:{name:"Cocoa",price:210,category:"exotic"},coffee:{name:"Coffee",price:300,category:"exotic"},coffeebeans:{name:"Coffee Beans",price:220,category:"exotic"},copper:{name:"Copper",price:60,category:"industry",toolbar:!0},copperore:{name:"Copper Ore",price:43,category:"industry"},corn:{name:"Corn",price:50,category:"food"},cotton:{name:"Cotton",price:146,category:"industry"},cottonfabric:{name:"Fabric",price:246,category:"industry"},dates:{name:"Dates",price:160,category:"exotic"},diamonds:{name:"Diamonds",price:900,category:"luxury"},donkeys:{name:"Donkeys",price:90,imported:!0,category:"animals"},elephants:{name:"Elephants",price:150,imported:!0,category:"animals"},essentialoil:{name:"Essential Oil",price:370,imported:!0,category:"luxury"},fish:{name:"Fish",price:16,category:"food"},flour:{name:"Flour",price:40,category:"food"},furcoats:{name:"Fur coats",price:105,category:"industry"},furs:{name:"Furs",price:78,category:"industry"},gems:{name:"Gems",price:460,category:"luxury"},glass:{name:"Glass",price:86,category:"industry"},glasses:{name:"Glasses",price:140,category:"luxury"},goat:{name:"Goat",price:55,category:"animals"},gold:{name:"Gold",price:260,category:"industry",toolbar:!0},goldore:{name:"Gold Ore",price:80,category:"industry"},grapes:{name:"Grapes",price:35,category:"industry"},gunpowder:{name:"Gunpowder",price:420,category:"military"},hides:{name:"Hides",price:25,category:"industry"},honey:{name:"Honey",price:180,category:"luxury"},horses:{name:"Horses",price:100,imported:!0,category:"animals"},indigo:{name:"Indigo",price:80,category:"exotic"},iron:{name:"Iron",price:82,category:"industry",toolbar:!0},ironore:{name:"Iron Ore",price:42,category:"industry"},jewelery:{name:"Jewelery",price:900,category:"luxury"},leather:{name:"Leather",price:60,category:"industry"},limestone:{name:"Limestone",price:20,category:"construction"},lithium:{name:"Lithium",price:260,imported:!0,category:"exotic"},marzipan:{name:"Marzipan",price:150,category:"luxury"},meals:{name:"Meals",price:120,category:"food"},meat:{name:"Meat",price:30,category:"food",toolbar:!0},milk:{name:"Milk",price:30,category:"industry"},mosaic:{name:"Mosaic",price:200,category:"construction"},oil:{name:"Oil",price:200,category:"industry"},paper:{name:"Paper",price:70,category:"luxury"},pearls:{name:"Pearls",price:450,category:"luxury"},perfume:{name:"Perfume",price:305,category:"luxury"},pig:{name:"Pig",price:55,category:"animals"},pottery:{name:"Pottery",price:55,category:"industry"},provisions:{name:"Provisions",price:300,category:"military"},quartz:{name:"Quartz",price:18,category:"industry"},robes:{name:"Robes",price:400,category:"luxury"},ropes:{name:"Ropes",price:42,category:"industry"},roses:{name:"Roses",price:70,category:"luxury"},salt:{name:"Salt",price:20,category:"industry",toolbar:!0},sand:{name:"Sand",price:10,category:"construction"},silk:{name:"Silk",price:320,category:"exotic"},silverore:{name:"Silver Ore",price:120,imported:!0,category:"industry"},silver:{name:"Silver",price:300,imported:!0,category:"luxury"},spices:{name:"Spices",price:285,category:"exotic"},spyglasses:{name:"Spyglasses",price:280,imported:!0,category:"military"},soap:{name:"Soap",price:220,category:"luxury"},statues:{name:"Statues",price:1200,imported:!0,category:"industry"},steel:{name:"Steel",price:160,imported:!0,category:"industry"},stones:{name:"Stones",price:16,category:"construction",toolbar:!0},sugar:{name:"Sugar",price:145,category:"luxury"},sugarcane:{name:"Sugarcane",price:120,category:"luxury"},sulphur:{name:"Sulphur",price:180,category:"industry"},tallow:{name:"Tallow",price:10,category:"industry"},tobacco:{name:"Tobacco",price:190,category:"exotic"},tools:{name:"Tools",price:135,category:"construction"},wax:{name:"Wax",price:40,category:"luxury"},weapons:{name:"Weapons",price:220,category:"military"},wheat:{name:"Wheat",price:25,category:"food"},wine:{name:"Wine",price:95,category:"luxury"},wood:{name:"Wood",price:20,category:"construction",toolbar:!0},woodplanks:{name:"Wood Planks",price:30,category:"construction",toolbar:!0}},game.ACHIEVEMENTS=[{description:"Develop your settlement to level 10.",name:"Kiddo",handle:"kiddo",conditions:{settlement_level:10},points:100},{description:"Develop your settlement to level 20.",name:"Teen",handle:"teen",conditions:{settlement_level:20},points:200},{description:"Develop your settlement to level 30.",name:"On my own",handle:"onmyown",conditions:{settlement_level:30},points:500},{description:"Develop your settlement to level 40.",name:"Fear me",handle:"fearme",conditions:{settlement_level:40},points:1e3},{description:"Gather maximum espionage.",name:"Anna Chapman",handle:"chapman",conditions:{resources:{espionage:game.MAX_ESPIONAGE_VALUE}},points:100},{description:"Gather maximum faith.",name:"Jesus Christ",handle:"jesus",conditions:{resources:{faith:game.MAX_FAITH_VALUE}},points:100},{description:"Gather maximum prestige.",name:"Your highness",handle:"highness",conditions:{resources:{espionage:game.MAX_PRESTIGE_VALUE}},points:100},{description:"Gather maximum research.",name:"Albert Einstein",handle:"eistein",conditions:{resources:{research:game.MAX_RESEARCH_VALUE}},points:100},{description:"Gather 100k coins in your settlement.",name:"Gatherer",handle:"gatherer",conditions:{resources:{coins:1e5}},points:100},{description:"Gather 500k coins in your settlement.",name:"Ba dum tss",handle:"badumtss",conditions:{resources:{coins:5e5}},points:100},{description:"Gather 1M coins in your settlement.",name:"Milionaire",handle:"milionaire",conditions:{resources:{coins:1e6}},points:100},{description:"Gather 10M coins in your settlement.",name:"Rockefeller",handle:"rockefeller",conditions:{resources:{coins:1e7}},points:100},{description:"Gather 100M coins in your settlement.",name:"Rottschild",handle:"rottschild",conditions:{resources:{coins:1e8}},points:100},{description:"Gather 10k stones in your settlement.",name:"Stone Age",handle:"stoneage",conditions:{resources:{stones:1e4}},points:100},{description:"Gather 10k wood in your settlement.",name:"Woody the Woodpecker",handle:"woody",conditions:{resources:{wood:1e4}},points:100},{description:"Gather 10k meat in your settlement.",name:"Animal killer",handle:"animalkiller",conditions:{resources:{meat:1e4}},points:100},{description:"Recruit 100 soldiers in your settlement.",name:"Armed to the teeth",handle:"armedteeth",conditions:{soldiers:100},points:100},{description:"Recruit 500 soldiers in your settlement.",name:"Warfiend",handle:"warfiend",conditions:{soldiers:500},points:200},{description:"Recruit 1000 soldiers in your settlement",name:"Warlord",handle:"warlord",conditions:{soldiers:1e3},points:1e3},{description:"Recruit 10 ships in your settlement.",name:"Shipwrecked",handle:"shipwrecked",conditions:{ships:10},points:100},{description:"Recruit 50 ships in your settlement.",name:"Ship has sailed",handle:"shipsailed",conditions:{ships:50},points:100},{description:"Recruit 100 ships in your settlement.",name:"Captain Ahab",handle:"ahab",conditions:{ships:100},points:1e3},{description:"Gather 100 prestige.",name:"Prestigious",handle:"prestigious",conditions:{resources:{prestige:100}},points:100},{description:"Gather 500 prestige.",name:"The God King",handle:"godking",conditions:{resources:{prestige:500}},points:100},{description:"Gather 10 espionage.",name:"You got Mossad-ed!",handle:"mossad",conditions:{resources:{espionage:10}},points:10},{description:"Gather 100 espionage.",name:"You got Snowden-ed!",handle:"snowden",conditions:{resources:{espionage:100}},points:100},{description:"Gather 500 espionage.",name:"I spy with my own eye",handle:"ispy",conditions:{resources:{espionage:500}},points:100},{description:"Gather 10 research.",name:"Initiate",handle:"initiate",conditions:{resources:{research:10}},points:10},{description:"Gather 100 research.",name:"Researcher",handle:"researcher",conditions:{resources:{research:100}},points:100},{description:"Gather 500 research.",name:"Searching",handle:"searching",conditions:{resources:{research:500}},points:100},{description:"Gather 100 faith.",name:"Faithful",handle:"faithful",conditions:{resources:{faith:100}},points:100},{description:"Gather 500 faith.",name:"Disciple",handle:"disciple",conditions:{resources:{faith:500}},points:100},{description:"Build a Castle in your settlement.",name:"Castlevania",handle:"castlevania",conditions:{buildings:{castle:1}},points:400},{description:"Build a Church in your settlement.",name:"Winston Churchill",handle:"churchill",conditions:{buildings:{church:1}},points:100},{description:"Build an Academy in your settlement.",name:"Academician",handle:"academician",conditions:{buildings:{academy:1}},points:100},{description:"Build each of the mines (Iron, Gold, Copper and Salt).",name:"All mine!",handle:"allmine",conditions:{buildings:{ironmine:1,goldmine:1,coppermine:1,saltmine:1}},points:200},{description:"Fill out all your storage space.",name:"All filled up",handle:"allfilledup",conditions:{storage:0},points:500},{description:"Build 10 catapults in your settlement.",name:"Cat-a-pulter",handle:"catapulter",conditions:{resources:{catapults:10}},points:200},{description:"Build an Embassy in your settlement.",name:"Gandhi",handle:"gandhi",conditions:{buildings:{embassy:1}},points:100},{description:"Get 100 achievements.",name:"Sir Achievealot",handle:"achievelot",conditions:{achievements:100},points:100},{description:"Recruit a mercenary army.",name:"Merc",handle:"merc",conditions:{mercenary:1},points:100},{description:"Reach 10 milion people in your settlement.",name:"Megalopolis",handle:"megalopolis",conditions:{population:1e7},points:200},{description:"Upgrade your settlement`s Academy to level 3.",name:"Too much research",handle:"toomuchresearch",conditions:{buildings:{academy:3}},points:200},{description:"Upgrade your settlement`s Castle to level 3.",name:"Goldilocks",handle:"goldilocks",conditions:{buildings:{castle:3}},points:500},{description:"Upgrade your settlement`s Church to level 3.",name:"Cathedral",handle:"cathedral",conditions:{buildings:{church:3}},points:300},{description:"Build a Tournir Area in your settlement.",name:"Richard Lionheart",handle:"lionheart",conditions:{buildings:{tournir:1}},points:1e3},{description:"Send a caravan to another settlement.",name:"Donkey Lord",handle:"donkeylord",points:100},{description:"Send a spy to another settlement.",name:"Bond. James Bond.",handle:"jamesbond",points:100},{description:"Send an army to another settlement.",name:"Warrior",handle:"sendarmy",points:100},{description:"Declare war to another settlement.",name:"Warlord",handle:"declarewar",points:100},{description:"Propose to another settlement to join you.",name:"The One to Rule Them All",handle:"rulethemall",points:100},{description:"Propose a pact to another settlement.",name:"The Friendly",handle:"friendly",points:100},{description:"Propose an alliance to another settlement.",name:"The Pacifist",handle:"pacifist",points:100},{description:"Win a battleground.",name:"Conqueror",handle:"conqueror",points:20},{description:"Lose a battleground.",name:"Foolish!",handle:"foolish",points:10},{description:"Convince another settlement to accept an alliance.",name:"I got your back",handle:"gotyourback",points:200},{description:"Convince another settlement to accept a pact.",name:"Pactish",handle:"pactish",points:200},{description:"Convince another settlement to join your settlement.",name:"You are mine!",handle:"youaremine",points:500},{description:"Adopt Christianity as the religion of your settlement.",name:"Church of Nativity",handle:"nativity",conditions:{religion:"christianity"},points:100},{description:"Adopt Islam as the religion of your settlement.",name:"Kaaba",handle:"kaaba",conditions:{religion:"islam"},points:100},{description:"Adopt Judaism as the religion of your settlement.",name:"Hanukkah",handle:"hanukkah",conditions:{religion:"judaism"},points:100},{description:"Adopt Buddhism as the religion of your settlement.",name:"Bodhisattva",handle:"bodhisattva",conditions:{religion:"buddhism"},points:100},{description:"Adopt Hinduism as the religion of your settlement.",name:"Bhagavad Gita",handle:"gita",conditions:{religion:"hinduism"},points:100},{description:"Adopt Confucianism as the religion of your settlement.",name:"Tiān",handle:"tian",conditions:{religion:"confucianism"},points:100},{description:"Adopt Taoism as the religion of your settlement.",name:"Laozi",handle:"laozi",conditions:{religion:"taoism"},points:100}],game.ITEM_TYPE_ARMOR=1,game.ITEM_TYPE_WEAPON=2,game.ITEM_TYPE_OTHER=3,game.ARMOR_TYPE_CLOTH=1,game.ARMOR_TYPE_LEATHER=2,game.ARMOR_TYPE_MAIL=3,game.ARMOR_TYPE_PLATE=4,game.WEAPON_TYPE_MELEE=1,game.WEAPON_TYPE_RANGED=2,game.WEAPON_TYPE_RANGED_BOW=1,game.WEAPON_TYPE_RANGED_CROSSBOW=2,game.WEAPON_TYPE_RANGED_GUN=3,game.WEAPON_TYPE_RANGED_THROWN=4,game.WEAPON_TYPE_MELEE_DAGGER=1,game.WEAPON_TYPE_MELEE_AXE_ONE_HAND=2,game.WEAPON_TYPE_MELEE_AXE_TWO_HAND=3,game.WEAPON_TYPE_MELEE_FIST=4,game.WEAPON_TYPE_MELEE_MACE_ONE_HAND=5,game.WEAPON_TYPE_MELEE_MACE_TWO_HAND=6,game.WEAPON_TYPE_MELEE_POLEARM=7,game.WEAPON_TYPE_MELEE_STAFF=8,game.WEAPON_TYPE_MELEE_SWORD_ONE_HAND=9,game.WEAPON_TYPE_MELEE_SWORD_TWO_HAND=10,game.ITEM_QUALITY_COMMON=1,game.ITEM_QUALITY_RARE=2,game.ITEM_QUALITY_EPIC=3,game.ITEM_QUALITY_LEGENDARY=4,game.ITEM_QUALITY_LIST=["","Common","Rare","Epic","Legendary"],game.ITEM_QUALITY_COLORS=["","#00ff00","#0070ff","#a335ee","#ff8000"],game.ITEM_SLOT_NONE=0,game.ITEM_SLOT_NECK=1,game.ITEM_SLOT_HEAD=2,game.ITEM_SLOT_RING=3,game.ITEM_SLOT_SHOULDER=4,game.ITEM_SLOT_CHEST=5,game.ITEM_SLOT_LEGS=6,game.ITEM_SLOT_HANDS=7,game.ITEM_SLOT_WAIST=8,game.ITEM_SLOT_FEET=9,game.ITEM_SLOT_MAIN_HAND=10,game.ITEM_SLOT_OFF_HAND=11,game.ITEM_SLOT_ANY_HAND=12,game.ITEM_SLOTS_NUM=12,game.ITEM_BACKPACK_NUM=6,game.ITEM_SLOTS_LIST=["","Neck","Head","Ring","Shoulder","Chest","Legs","Hands","Waist","Feet","Main Hand","Off Hand",""],game.RANDOM_UNCOMMON=[{name:"ITEM of Spirit",stats:{spirit:0}},{name:"ITEM of Intellect",stats:{intellect:0}},{name:"ITEM of Strength",stats:{strength:0}},{name:"ITEM of Stamina",stats:{spirit:0}},{name:"ITEM of Agility",stats:{agility:0}},{name:"ITEM of the Tiger",stats:{strength:0,agility:0}},{name:"ITEM of the Bear",stats:{strength:0,stamina:0}},{name:"ITEM of the Gorilla",stats:{strength:0,intellect:0}},{name:"ITEM of the Boar",stats:{strength:0,spirit:0}},{name:"ITEM of the Monkey",stats:{agility:0,stamina:0}},{name:"ITEM of the Falcon",stats:{agility:0,intellect:0}},{name:"ITEM of the Wolf",stats:{agility:0,spirit:0}},{name:"ITEM of the Eagle",stats:{stamina:0,intellect:0}},{name:"ITEM of the Whale",stats:{stamina:0,spirit:0}},{name:"ITEM of the Owl",stats:{intellect:0,spirit:0}},{name:"ITEM of the Bandit",stats:{agility:0,stamina:0,attackPower:0}},{name:"ITEM of the Beast",stats:{agility:0,strength:0,stamina:0}}],game.ITEM_WEAPON_DAGGER_WICKED={name:"Wicked Dagger",id:1,stats:{damageMin:0,damageMax:2,speed:1.6},slot:game.ITEM_SLOT_ANY_HAND,type:game.ITEM_TYPE_WEAPON,quality:game.ITEM_QUALITY_COMMON,cost:1},game.ITEM_WEAPON_DAGGER_DIRK={name:"Wicked Dirk",id:2,stats:{damageMin:1,damageMax:3,speed:1.6},slot:game.ITEM_SLOT_ANY_HAND,type:game.ITEM_TYPE_WEAPON,quality:game.ITEM_QUALITY_COMMON,cost:1.2},game.ITEM_WEAPON_AXE_SMALL={name:"Small Axe",id:3,stats:{damageMin:3,damageMax:10,speed:1.6},slot:game.ITEM_SLOT_ANY_HAND,type:game.ITEM_TYPE_WEAPON,quality:game.ITEM_QUALITY_COMMON,cost:2.2},game.ITEM_WEAPON_SWORD_SMALL={name:"Small Sword",id:4,stats:{damageMin:2,damageMax:4,speed:1.6},slot:game.ITEM_SLOT_MAIN_HAND,type:game.ITEM_TYPE_WEAPON,quality:game.ITEM_QUALITY_COMMON,cost:2.2},game.ITEM_WEAPON_BUCKLER_SMALL={name:"Small Buckler",id:5,stats:{armor:10},slot:game.ITEM_SLOT_OFF_HAND,quality:game.ITEM_QUALITY_COMMON,cost:2.2},game.ITEM_EXCALIBUR={name:"Excalibur",id:6,stats:{damageMin:10,damageMax:50,speed:1,agility:20,stamina:10,strength:30},slot:game.ITEM_SLOT_MAIN_HAND,type:game.ITEM_TYPE_WEAPON,secondary_type:game.WEAPON_TYPE_MELEE,quality:game.ITEM_QUALITY_LEGENDARY,cost:1},game.ITEM_CROWN_OF_KINGS={name:"Crown of Kings",id:7,stats:{armor:10,stamina:10,strength:30},slot:game.ITEM_SLOT_HEAD,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_RARE,cost:1},game.ITEM_BULWARK_OF_GODS={name:"The Bulwark of Gods",id:8,stats:{armor:100,stamina:20,strength:50},slot:game.ITEM_SLOT_OFF_HAND,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_EPIC,cost:1},game.ITEM_CHESTPIECE_OF_ZEUS={name:"Chestpiece of Zeus",id:9,stats:{armor:200,stamina:30,agility:20,strength:20},slot:game.ITEM_SLOT_CHEST,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_EPIC,cost:1},game.ITEM_ARCHAIC_WAIST_BAND={name:"Archaic Waist Band",id:10,stats:{armor:5,stamina:3,strength:2,intellect:2},slot:game.ITEM_SLOT_WAIST,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_RARE,cost:1},game.ITEM_ALCMENE_BAND={name:"Alcmene Band",id:11,stats:{armor:2,stamina:2,strength:1,agility:2,intellect:1,spirit:10},slot:game.ITEM_SLOT_RING,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_EPIC,cost:1},game.ITEM_SUN_NECKLACE={name:"Sun Necklace",flavour:"From Amun Ra to his beloved son.",id:11,stats:{armor:4,stamina:2,strength:1,intellect:10,spirit:1},slot:game.ITEM_SLOT_NECK,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_LEGENDARY,cost:1},game.ITEM_TROJAN_BASTARD_SWORD={name:"Trojan Bastard Sword",flavour:"Hector`s sword, dropped by the fallen Trojan prince.",id:12,stats:{damageMin:8,damageMax:34,speed:1.3,stamina:15,strength:10},slot:game.ITEM_SLOT_MAIN_HAND,type:game.ITEM_TYPE_WEAPON,secondary_type:game.WEAPON_TYPE_MELEE,quality:game.ITEM_QUALITY_LEGENDARY,cost:1},game.ITEM_SPEAR_OF_DESTINY={name:"Spear of Destiny",flavour:"The spear that befell the Trojan prince, Hector.",id:13,stats:{damageMin:25,damageMax:90,speed:2,stamina:40,strength:3},slot:game.ITEM_SLOT_MAIN_HAND,type:game.ITEM_TYPE_WEAPON,secondary_type:game.WEAPON_TYPE_MELEE,quality:game.ITEM_QUALITY_LEGENDARY,cost:1},game.ITEM_GOLDEN_KATANA={name:"Golden Katana",id:14,stats:{damageMin:10,damageMax:20,speed:1.1,stamina:10,agility:20,strength:5},slot:game.ITEM_SLOT_OFF_HAND,type:game.ITEM_TYPE_WEAPON,secondary_type:game.WEAPON_TYPE_MELEE,quality:game.ITEM_QUALITY_RARE,cost:1},game.ITEM_ETHEREAL_BOOTS={name:"Ethereal Boots",id:15,stats:{armor:6,strength:10,agility:10},slot:game.ITEM_SLOT_FEET,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_RARE,cost:1},game.ITEM_SHOULDERPADS_OF_VALOR={name:"Shoulderpads of Valor",id:16,stats:{armor:15,strength:20,stamina:10},slot:game.ITEM_SLOT_SHOULDER,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_COMMON,cost:1},game.ITEM_MOUNTAIN_TROLLS={name:"Mountain Trolls",id:17,stats:{armor:25,agility:10,stamina:30},slot:game.ITEM_SLOT_LEGS,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_EPIC,cost:1},game.ITEM_GAUNTLETS_OF_GHASTLY_GLARE={name:"Gauntlets of Ghastly Glare",flavour:"Ghastly indeed ...",id:18,stats:{armor:10,strength:20,stamina:2,intellect:30},slot:game.ITEM_SLOT_HANDS,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_EPIC,cost:1},game.ITEM_ANKH_OF_RA={name:"Ankh of Ra",id:19,stats:{armor:1,strength:5,stamina:20,intellect:5},slot:game.ITEM_SLOT_NECK,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_RARE,cost:1},game.ITEM_SAND_SLIPPERS={name:"Sand Slippers",id:20,stats:{armor:5,strength:9,intellect:6},slot:game.ITEM_SLOT_FEET,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_RARE,cost:1},game.ITEM_BAND_IT={name:"Band It",id:21,stats:{armor:2,stamina:5,strength:1,agility:1,intellect:4,spirit:5},slot:game.ITEM_SLOT_RING,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_EPIC,cost:1},game.ITEM_TUTANKHAMUN_KOPESH={name:"Tutankhamun`s Kopesh",id:22,stats:{damageMin:30,damageMax:55,speed:2,agility:30,stamina:10,strength:10},slot:game.ITEM_SLOT_MAIN_HAND,type:game.ITEM_TYPE_WEAPON,secondary_type:game.WEAPON_TYPE_MELEE,quality:game.ITEM_QUALITY_LEGENDARY,cost:1},game.ITEM_VALORANT_SHOULDERPADS={name:"Valorant`s Shoulderpads",id:23,stats:{armor:20,agility:20,stamina:15},slot:game.ITEM_SLOT_SHOULDER,type:game.ITEM_TYPE_ARMOR,secondary_type:game.ARMOR_TYPE_PLATE,quality:game.ITEM_QUALITY_RARE,cost:1},game.HERO_CLASS_WARRIOR=1,game.HERO_CLASS_MAGE=2,game.HERO_CLASS_DRUID=3,game.HERO_CLASS_PRIEST=4,game.HERO_CLASS_ROGUE=5,game.HERO_CLASS_SHAMAN=6,game.HERO_CLASS_LIST=["","Warrior","Mage","Druid","Priest","Rogue","Shaman"],game.HEROES=[{name:"Achilles",handle:"achilles",description:"Achilles is a Greek hero of the Trojan War and the central character and greatest warrior of Homer`s Iliad. His mother is the immortal nymph Thetis, and his father, the mortal Peleus, is the king of the Myrmidons.",price:5e6,link:"https://en.wikipedia.org/wiki/Achilles",stats:{strength:10,stamina:10,agility:10,spirit:5,intellect:7},class:game.HERO_CLASS_WARRIOR,items:[game.ITEM_TROJAN_BASTARD_SWORD],backpack:[]},{name:"Hector",handle:"hector",description:"In Greek mythology and Roman Mythology, Hector is a Trojan prince and the greatest fighter for Troy in the Trojan War. As the first-born son of King Priam and Queen Hecuba, who was a descendant of Dardanus and Tros, the founder of Troy, he is a prince of the royal house and the heir apparent to his father`s throne.",price:4e6,link:"https://en.wikipedia.org/wiki/Hector",stats:{strength:8,stamina:10,agility:6,spirit:4,intellect:6},class:game.HERO_CLASS_WARRIOR,items:[game.ITEM_EXCALIBUR,game.ITEM_GOLDEN_KATANA],backpack:[]},{name:"Hannibal",handle:"hannibal",description:"Hannibal Barca is a Carthaginian general, considered one of the greatest military commanders in history.",price:3e6,link:"https://en.wikipedia.org/wiki/Hannibal",stats:{strength:7,stamina:7,agility:4,spirit:2,intellect:9},class:game.HERO_CLASS_WARRIOR,items:[],backpack:[]},{name:"Heracles",handle:"heracles",description:"Heracles is a divine hero in Greek mythology, the son of Zeus and Alcmene, foster son of Amphitryon and great-grandson and half-brother (as they are both sired by the god Zeus) of Perseus.<br /><br />He is the greatest of the Greek heroes, a paragon of masculinity, the ancestor of royal clans who claim to be Heracleidae, and a champion of the Olympian order against chthonic monsters.",price:5e6,link:"https://en.wikipedia.org/wiki/Heracles",stats:{strength:9,stamina:9,agility:6,spirit:7,intellect:9},class:game.HERO_CLASS_WARRIOR,items:[game.ITEM_SPEAR_OF_DESTINY,game.ITEM_CROWN_OF_KINGS,game.ITEM_BULWARK_OF_GODS,game.ITEM_CHESTPIECE_OF_ZEUS,game.ITEM_ARCHAIC_WAIST_BAND,game.ITEM_ALCMENE_BAND,game.ITEM_SUN_NECKLACE,game.ITEM_ETHEREAL_BOOTS,game.ITEM_SHOULDERPADS_OF_VALOR,game.ITEM_MOUNTAIN_TROLLS,game.ITEM_GAUNTLETS_OF_GHASTLY_GLARE],backpack:[]},{name:"Akhenaten",handle:"akhenaten",description:'Akhenaten, known before the fifth year of his reign as Amenhotep IV (sometimes given its Greek form, Amenophis IV, and meaning "Amun Is Satisfied"), is an Ancient Egyptian pharaoh of the 18th Dynasty who ruled for 17 years.',price:1e6,link:"https://en.wikipedia.org/wiki/Akhenaten",stats:{strength:4,stamina:4,agility:8,spirit:9,intellect:9},class:game.HERO_CLASS_PRIEST,items:[game.ITEM_ANKH_OF_RA,game.ITEM_TUTANKHAMUN_KOPESH,game.ITEM_WEAPON_BUCKLER_SMALL,game.ITEM_SAND_SLIPPERS,game.ITEM_BAND_IT,game.ITEM_VALORANT_SHOULDERPADS],backpack:[]}],game.INITIAL_SEED=[{roughness:5,settlements:{0:8,1:5,2:6,3:6,4:10},military:{army:{militia:10,axeman:2,bowman:4},navy:{corsair:2,caravel:1}},resources:{coins:55e3,fame:game.MIN_FAME_VALUE,faith:game.MIN_FAITH_VALUE,prestige:game.MIN_PRESTIGE_VALUE,espionage:game.MIN_ESPIONAGE_VALUE,research:game.MIN_RESEARCH_VALUE,bread:400,meat:100,stones:100,weapons:100,wheat:40,wood:100,woodplanks:50,tools:40},buildings:[{handle:"marketplace",level:1},{handle:"lumberjack",level:1},{handle:"stonequarry",level:1},{handle:"house1",level:1},{handle:"house2",level:1}]},{roughness:6,settlements:{0:5,1:10,2:5,3:3,4:4},military:{army:{militia:5,axeman:1,bowman:2},navy:{corsair:1,caravel:1}},resources:{coins:2e4,fame:game.MIN_FAME_VALUE,faith:game.MIN_FAITH_VALUE,prestige:game.MIN_PRESTIGE_VALUE,espionage:game.MIN_ESPIONAGE_VALUE,research:game.MIN_RESEARCH_VALUE,bread:300,meat:100,stones:100,weapons:60,wheat:40,wood:100,woodplanks:30,tools:20},buildings:[{handle:"marketplace",level:1},{handle:"lumberjack",level:1},{handle:"stonequarry",level:1},{handle:"house1",level:1},{handle:"house2",level:1}]},{roughness:8,settlements:{0:10,1:10,2:6,3:10,4:3},military:{army:{militia:3,bowman:2},navy:{corsair:1}},resources:{coins:1e4,fame:game.MIN_FAME_VALUE,faith:game.MIN_FAITH_VALUE,prestige:game.MIN_PRESTIGE_VALUE,espionage:game.MIN_ESPIONAGE_VALUE,research:game.MIN_RESEARCH_VALUE,bread:300,meat:100,stones:70,wheat:40,wood:70,woodplanks:20,tools:10},buildings:[{handle:"marketplace",level:1},{handle:"lumberjack",level:1},{handle:"stonequarry",level:1},{handle:"house1",level:1},{handle:"house2",level:1}]},{roughness:1,settlements:{0:10,1:20,2:20,3:20,4:1},military:{army:{},navy:{}},resources:{coins:5e3,fame:game.MIN_FAME_VALUE,faith:game.MIN_FAITH_VALUE,prestige:game.MIN_PRESTIGE_VALUE,espionage:game.MIN_ESPIONAGE_VALUE,research:game.MIN_RESEARCH_VALUE,bread:100,meat:50,stones:50,wheat:40,wood:50},buildings:[{handle:"marketplace",level:1},{handle:"lumberjack",level:1},{handle:"stonequarry",level:1},{handle:"house1",level:1},{handle:"house2",level:1}]}];
/**
 * Main Game AI (Artificial Intelligence) object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ai
 * @returns {ai}
 */
class ai{constructor(e){return this._core=e.core,this.type=e.type,this}process(){return!0}core(){return this._core}}
/**
 * Main Game Chat object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class chat
 * @returns {chat}
 */class chat{constructor(e){return this._core=e.core,this}send(e){}get(){}core(){return this._core}}
/**
 * Main Game API object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class api
 * @returns {api}
 */class api{constructor(e){return this._core=e.core,this}login(e){return this.request({url:"login",data:e})}logout(){return this.request({url:"logout"})}api_version(){return this.request({url:"version"})}city_info(){return this.request({url:"city"})}heartbeat(){return this.request({url:"heartbeat"})}register(e){return this.request({url:"register",data:e})}do_export(e){return this.request({url:"export",data:e})}do_import(e){return this.request({url:"import",data:e})}_request(e){return $.ajax({type:void 0!==e.requestType?e.requestType:"POST",dataType:void 0!==e.dataType?e.dataType:"jsonp",xhrFields:{withCredentials:void 0===e.auth||!0===e.auth},crossDomain:!0,data:e.data,url:game.API_URL+e.url,async:void 0===e.async||!0===e.async,success:e.success instanceof Function?e.success:function(){},error:e.error instanceof Function?e.error:function(){}}),this}core(){return this._core}}
/**
 * Game jailer (enforcing security) object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class jailer
 * @returns {jailer}
 */class jailer{constructor(e){return this._core=e.core,this}check(){return!0}core(){return this._core}}
/**
 * World object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class world
 * @returns {world}
 */class world{constructor(e){return this._core=e.core,this.seeds={},this.colors={background:"#64B4E1",ocean:"#64B5E1",grass:"#E6F59A",subtropical_desert:"#F2CD63",temperate_desert:"#F2CD63",taiga:"#E1C85A",shrubland:"#E1C859",beach:"#FFF899",scorched:"#E5F59A",bare:"#D1BE79",tundra:"#E5F59A",snow:"#DCDCE6",temperate_deciduous_forest:"#78AA46",temperate_rain_forest:"#78AA46",tropical_rain_forest:"#549D65",tropical_seasonal_forest:"#549D65",hills:"#E1C859",mountains:"#B37D1A",mountains_ice:"#DCDCE6"},this.seeds.moisture=void 0!==e.moisture&&null!==e.moisture?e.moisture:this.seed(),this.seeds.elevation=void 0!==e.elevation&&null!==e.elevation?e.elevation:this.seed(),this.data=void 0!==e.data?e.data:[],0===this.data.length&&(this._create_array(),this._generate()),this}seed(){return 2147483645*Math.random()+1}get_hex_terrain(e){let t=this.data[e.y][e.x].e,a=this.data[e.y][e.x].m;return t<=.1?"ocean":t>.1&&t<=.15?"beach":t>.15&&t<=.35?a<=.3?"subtropical_desert":a>.3&&a<=.45?"grass":a>.45&&a<=.66?"tropical_seasonal_forest":"tropical_rain_forest":t>.35&&t<=.75?a<=.2?"temperate_desert":a>.2&&a<=.5?"grass":a>.5&&a<=.83?"temperate_deciduous_forest":"temperate_rain_forest":t>.75&&t<=.8?a<=.33?"temperate_desert":a>.33&&a<=.66?"shrubland":"taiga":t>.8&&t<=.85?"hills":a>=.8?"mountains_ice":"mountains"}get_climate_from_terrain(e){return"tropical_rain_forest"===e||"tropical_seasonal_forest"===e?{id:game.CLIMATE_TROPICAL,name:game.CLIMATES[game.CLIMATE_TROPICAL]}:"subtropical_desert"===e||"temperate_desert"===e?{id:game.CLIMATE_ARID,name:game.CLIMATES[game.CLIMATE_ARID]}:"mountains_ice"===e||"snow"===e?{id:game.CLIMATE_POLAR,name:game.CLIMATES[game.CLIMATE_POLAR]}:("grass"===e||"temperate_deciduous_forest"===e||"temperate_rain_forest"===e||"hills"===e||"mountains"===e||"taiga"===e||"shrubland"===e||"beach"===e||"scorched"===e||"tundra"===e||"bare"===e)&&{id:game.CLIMATE_TEMPERATE,name:game.CLIMATES[game.CLIMATE_TEMPERATE]}}get_terrain_from_climate(e){return e===game.CLIMATE_TROPICAL?["tropical_rain_forest","tropical_seasonal_forest"]:e===game.CLIMATE_ARID?["subtropical_desert","temperate_desert"]:e===game.CLIMATE_POLAR?["mountains_ice","snow"]:e===game.CLIMATE_TEMPERATE&&["grass","temperate_deciduous_forest","temperate_rain_forest","hills","mountains","taiga","shrubland","beach","scorched","tundra","bare"]}get_random_location(e){const t={x:game.get_random(0,game.WORLD_SIZE_WIDTH-1),y:game.get_random(0,game.WORLD_SIZE_HEIGHT-1)};return this.hex_is_water(t)||this.hex_is_locked(t)?this.get_random_location(e):t}properties(){return this._properties}core(){return this._core}hex_is_water(e){return"ocean"===this.get_hex_terrain(e)}lock_hex(e,t){this.set_hex(e,"l",!0),this.set_hex(e,"lid",t)}unlock_hex(e){this.set_hex(e,"l",!1),this.set_hex(e,"lid",null)}hex_is_locked(e){return this.get_hex(e.x,e.y).l}hex_locked_by(e){return this.get_hex(e.x,e.y).lid}get_hex_moisture(e){return this.get_hex(e.x,e.y).m}get_hex_elevation(e){return this.get_hex(e.x,e.y).e}get_hex(e,t){return this.data[t][e]}set_hex(e,t,a){return this.data[e.y][e.x][t]=a}add_settlement(e){const t=e.location();return e.is_ruins()?(this.set_hex(t,"p",e.id()),!1===e.is_claimed()?this.lock_hex(t,e.id()):this.lock_hex(t,e.is_claimed())):(this.set_hex(t,"s",e.id()),this.set_hex(t,"n",e.name()),this.lock_hex(t,e.id()),this.calc_neighbours(e)),this}remove_city(e){const t=e.location(),a=e.id();this.data[t.y][t.x].s=null,this.data[t.y][t.x].n=null;for(let e=0;e<game.WORLD_SIZE_WIDTH;e++)for(let t=0;t<game.WORLD_SIZE_HEIGHT;t++)this.data[t][e].lid===a&&(this.data[t][e].lid=null,this.data[t][e].l=!1);return this}_create_array(){this.data=new Array(game.WORLD_SIZE_WIDTH);for(let e=0;e<game.WORLD_SIZE_WIDTH;e+=1)this.data[e]=new Array(game.WORLD_SIZE_HEIGHT);for(let e=0;e<game.WORLD_SIZE_WIDTH;e+=1)for(let t=0;t<game.WORLD_SIZE_HEIGHT;t+=1)this.data[e][t]={e:0,m:0,p:null,s:null,n:null,l:!1,lid:null};return this}_generate(){function e(e){var t=new PM_PRNG;return t.seed=void 0===e?1:e,t}let t=e(this.seeds.elevation),a=e(this.seeds.moisture),s=new SimplexNoise(t.nextDouble.bind(t)),i=new SimplexNoise(a.nextDouble.bind(a));function r(e,t){return s.noise2D(e,t)/2+.5}function n(e,t){return i.noise2D(e,t)/2+.5}for(let e=0;e<game.WORLD_SIZE_HEIGHT;e++)for(let t=0;t<game.WORLD_SIZE_WIDTH;t++){let a=e/game.WORLD_SIZE_HEIGHT-.5,s=t/game.WORLD_SIZE_WIDTH-.5,i=1*r(1*a,1*s)+.77*r(2*a,2*s)+0*r(4*a,4*s)+0*r(8*a,8*s)+0*r(16*a,16*s)+0*r(32*a,32*s);i/=1.77,i=Math.pow(i,game.WORLD_EROSION),this.data[t][e].e=i;let o=1*n(1*a,1*s)+.75*n(2*a,2*s)+.33*n(4*a,4*s)+.33*n(8*a,8*s)+.33*n(16*a,16*s)+.5*n(32*a,32*s);o/=3.24,this.data[t][e].m=o}return this}get_neighbours(e){const t=[],a=e.location(),s=this.get_neighbouring_hexes(a.y,a.x);if(e.is_city())for(let e=0;e<s.length;e++)t.push(s[e]);else if(e.is_metropolis())for(let e=0;e<s.length;e++){t.push(s[e]);const a=this.get_neighbouring_hexes(s[e].y,s[e].x);for(let e=0;e<a.length;e++)t.push(a[e])}return t}calc_neighbours(e){let t;const a=this.get_neighbours(e);for(let s=0;s<a.length;s++)a[s].x>=0&&a[s].x<game.WORLD_SIZE_WIDTH&&a[s].y>=0&&a[s].y<game.WORLD_SIZE_HEIGHT&&(t=this.get_hex_terrain(a[s]),this.lock_hex(a[s],e.id()),"ocean"===t&&e.waterside(!0));return this}get_neighbouring_hexes(e,t){return t%2==0?[{x:t+1,y:e},{x:t+1,y:e-1},{x:t,y:e-1},{x:t-1,y:e},{x:t-1,y:e-1},{x:t,y:e+1}]:[{x:t+1,y:e},{x:t+1,y:e+1},{x:t,y:e-1},{x:t-1,y:e},{x:t-1,y:e+1},{x:t,y:e+1}]}get_distance(e,t){return 100*Math.floor(Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)))}get_distance_in_days(e,t){return Math.floor(100*Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))/15)}draw(){let e=this.core().get_settlements(),t=Math.sqrt(3)/2*game.WORLD_HEX_SIZE,a=(1.5*game.WORLD_SIZE_WIDTH+.5)*game.WORLD_HEX_SIZE,s=(2*game.WORLD_SIZE_HEIGHT+1)*t;$(".worldmap").empty().append('<canvas class="canvas-map"></canvas>');let i,r,n=$(".canvas-map").get(0),o=!1,l=Math.sqrt(3)*game.WORLD_HEX_SIZE,d=2*game.WORLD_HEX_SIZE,c=1.5*game.WORLD_HEX_SIZE;n.width=a,n.height=s;let m=n.getContext("2d");m.fillStyle=this.colors.background,m.fillRect(0,0,a,s);for(let t=0;t<game.WORLD_SIZE_WIDTH;++t){for(let a=0;a<game.WORLD_SIZE_HEIGHT;++a){o?(i=t*c,r=a*l+.5*l):(i=t*c,r=a*l);let s=this.get_hex_terrain({x:t,y:a}),h=this.colors[s],u=.6;if(!0===this.data[a][t].l){let s=this.data[a][t].lid,i=this.data[a][t].p;if(null!==s&&null===i)void 0!==e[s]&&(h=e[s].color());else if(null!==s&&null!==i){let t=this.core().get_settlement(i);t&&!1!==t.is_claimed()&&(h=e[s].color())}u=.2}m.beginPath(),m.moveTo(i+d-c,r),m.lineTo(i+c,r),m.lineTo(i+d,r+l/2),m.lineTo(i+c,r+l),m.lineTo(i+d-c,r+l),m.lineTo(i,r+l/2),m.closePath(),!0===game.WORLD_GRID?m.strokeStyle="#666":m.strokeStyle=h,m.lineWidth=1,m.stroke(),m.fillStyle=h,m.fill(),!0===game.WORLD_BEAUTIFY&&this._apply_terrain(i,r,n,s,u)}o=!o}return this}_apply_terrain(e,t,a,s,i){let r=a.getContext("2d"),n=new Image,o=36*game.WORLD_HEX_SIZE/24;return n.onload=function(){r.globalAlpha=i,r.drawImage(n,e+6,t+2,o,o),r.globalAlpha=1},n.src=game.ASSETS_URL+"images/world/terrain/"+s+".png",this}}
/**
 * Main Game settlement object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class settlement
 * @returns {settlement}
 */class settlement{constructor(e){if(this._core=e.core,this._properties={},this._status={},this._buildings=[],this._army={},this._navy={},this._mercenary=[],this.resources={},this._ruins={},this._heroes=[],this._properties.id=e.properties.id,this._properties.name=void 0!==e.properties.name?e.properties.name:game.get_random_unique(game.SETTLEMENT_NAMES),this._properties.player=void 0!==e.properties.player&&e.properties.player,this._properties.level=void 0!==e.properties.level?e.properties.level:1,this._properties.religion=void 0!==e.properties.religion?e.properties.religion:game.RELIGION_NONE,this._properties.nationality=void 0!==e.properties.nationality?e.properties.nationality:this.core().get_random_nationality(),this._properties.type=void 0!==e.properties.type?e.properties.type:game.CITY,this._properties.ruler=void 0!==e.properties.ruler?e.properties.ruler:{title:this._properties.type===game.CAMP?"Warlord":"Mayor",avatar:game.get_random(1,game.AVATARS),personality:this._properties.type===game.CAMP?game.PERSONALITY_WARLORD:this.core().get_random_personality(),name:game.get_random_unique(game.NAMES)},void 0!==e.ruins&&(this._ruins.sid=void 0!==e.ruins.sid?e.ruins.sid:null,this._ruins.scouted=void 0!==e.ruins.scouted&&e.ruins.scouted,this._ruins.resources=void 0!==e.ruins.resources?e.ruins.resources:{}),this._properties.storage=0,this._properties.icon=void 0!==e.properties.icon?e.properties.icon:1,this._properties.waterside=void 0!==e.properties.waterside&&e.properties.waterside,this._army=this.load_army(e.army),this._mercenary=void 0!==e.mercenary?e.mercenary:[],this._status=void 0!==e.status?e.status:{},this._heroes=void 0!==e.heroes?e.heroes:[],this.resources=void 0!==e.resources?e.resources:{},this._fill_resources(),this._location=e.location,this._properties.color=void 0!==e.properties.color?e.properties.color:this.core().ui().get_random_color(),this.core().world().add_settlement(this),!0===this.waterside()&&(this._navy=this.load_navy(e.navy)),this.trades=void 0!==e.trades?e.trades:{imports:{},exports:{}},this.is_player()||(this.resources.fame=this.core().level_to_fame(this.level()),this.ai=new ai({core:this,type:this._properties.ruler.personality})),this.is_player())this._properties.climate=e.properties.climate;else{const e=this.core().world().get_hex_terrain({x:this._location.x,y:this._location.y}),t=this.core().world().get_climate_from_terrain(e);this._properties.climate=game["CLIMATE_"+t.name.toUpperCase()],this.is_urban()&&this.setup_initial_buildings(this.core().get_buildings_for_settlement(this),!0)}return this._properties.population=void 0!==e.properties.population?e.properties.population:this.level()*game.POPULATION_PER_LEVEL,this}ruins(){return this._ruins}is_claimed(){return null!==this._ruins.sid&&this._ruins.sid}is_scouted(){return this._ruins.scouted}scout(){return this._ruins.scouted=!0,this}claim(e){return null===this._ruins.sid&&(this._ruins.sid=e.id(),this.core().world().lock_hex(this.location(),e.id()),!0)}unclaim(e){return e.id()===this._ruins.sid&&(this._ruins.sid=null,this.core().world().unlock_hex(this.location()),!0)}export(){const e={properties:this.properties(),trades:this.get_trades(),resources:this.get_resources(),army:this.army(),navy:this.navy(),buildings:this.export_buildings(),mercenary:this.mercenary(),heroes:this.heroes(),location:this.location(),ruins:this.ruins()};return this.is_player()&&(e.status=this.status()),e}properties(){return this._properties}waterside(e){return void 0!==e&&(this._properties.waterside=e),this._properties.waterside}name(e){return void 0!==e&&(this._properties.name=e),this._properties.name}core(){return this._core}level_up(){const e=this.level();return this.fame(this.core().level_to_fame(e)),this._properties.level++,this._properties.population=this.level()*game.POPULATION_PER_LEVEL,this.core().ui().log("The city of "+this.name()+" is now level "+this.level()+"."),this}rename(e){return this.name(e)}get_rank(){const e=Math.round(this.level()/2);return{fame:this.fame(),prestige:this.prestige(),espionage:this.espionage(),score:Math.floor((this.fame()/e+this.prestige()/e+this.espionage()/e)/e)}}ruler(e){return void 0!==e&&(this._properties.ruler=e),this._properties.ruler}level(e){return void 0!==e&&(this._properties.level=e),this._properties.level}personality(e){return void 0!==e&&(this._properties.ruler.personality=e),{id:this._properties.ruler.personality,name:game.PERSONALITIES[this._properties.ruler.personality].capitalize()}}climate(e){return void 0!==e&&(this._properties.climate=e),{id:this._properties.climate,name:game.CLIMATES[this._properties.climate].capitalize()}}nationality(e){return void 0!==e&&(this._properties.nationality=e),{id:this._properties.nationality,name:game.NATIONS[this._properties.nationality].capitalize()}}icon(e){return void 0!==e&&(this._properties.icon=e),this._properties.icon}id(e){return void 0!==e&&(this._properties.id=id),this._properties.id}is_player(){return this._properties.player}get_type(){return this._properties.type}population(e){return void 0!==e&&(this._properties.population=e),this._properties.population}is_city(){return this._properties.type===game.CITY}is_metropolis(){return this._properties.type===game.METROPOLIS}is_camp(){return this._properties.type===game.CAMP}is_village(){return this._properties.type===game.VILLAGE}is_ruins(){return this._properties.type===game.RUINS}refresh_heroes(){this.is_building_built("tavern")}has_same_nationality(e){if("object"==typeof e&&this.nationality().id===e.nationality().id)return!0;if("number"==typeof e||"string"==typeof e){const t=this.core().get_settlement(e);if(void 0!==t&&this.nationality().id===t.nationality().id)return!0}return!1}heroes(e){return void 0!==e&&(this._heroes=e),this._heroes}location(e){return void 0!==e&&(this._location=e),this._location}to_city(){this._properties.type=game.CITY}to_village(){this._properties.type=game.VILLAGE}to_camp(){this._properties.type=game.CAMP}to_metropolis(){this._properties.type=game.METROPOLIS}to_ruins(){this._properties.type=game.RUINS}has_soldiers(e){const t=this.army();for(let a in t)if(t[a]-e[a]<0)return!1;return!0}adjust_campaign_cost(e,t,a){let s=e;for(let a in s)"coins"===a?s[a]=Math.ceil(e[a]*t):"provisions"===a&&(s[a]=Math.ceil(e[a]*t/4));if(void 0!==a){let e=$.extend({},a);for(let t in s)e[t]?e[t]+=s[t]:e[t]=s[t];return e}return s}split_army(e){let t=this.army();if(this.has_soldiers(e)){for(let a in t)t[a]-e[a]>=0?t[a]=t[a]-e[a]:t[a]=0;return!0}return!1}color(){return this._properties.color}has_ships(e){let t=this.navy();for(let a in t)if(t[a]-e[a]<0)return!1;return!0}split_navy(e){let t=this.navy();if(this.has_ships(e)){for(let a in t)t[a]-e[a]>=0?t[a]=t[a]-e[a]:t[a]=0;return!0}return!1}num_ships(e){let t=0;void 0===e&&(e=this._navy);for(let a in e)void 0!==e[a]&&(t+=e[a]);return t}num_soldiers(e){let t=0;void 0===e&&(e=this._army);for(let a in e)void 0!==e[a]&&(t+=e[a]);return t}merge_army(e){const t=this.army();let a=$.extend({},t);for(let t in e)a[t]?a[t]+=e[t]:a[t]=e[t];this._army=a}merge_navy(e){const t=this.navy();let a=$.extend({},t);for(let t in e)a[t]?a[t]+=e[t]:a[t]=e[t];this._navy=a}load_army(e){let t={};for(let a in game.SOLDIERS)void 0!==e&&void 0!==e[a]?t[a]=e[a]:t[a]=0;return t}load_navy(e){let t={};for(let a in game.SHIPS)void 0!==e&&void 0!==e[a]?t[a]=e[a]:t[a]=0;return t}mercenary(e){return void 0!==e&&(this._mercenary=e),this._mercenary}can_build_ships(){return this.is_building_built("shipyard")}can_recruit_soldiers(){return this.is_building_built("barracks")}recruit_mercenary_army(e){for(let t=0;t<game.MERCENARIES.length;t++)if(e===game.MERCENARIES[t].handle){const a=game.MERCENARIES[t].cost;if(!1===this.dec_coins(a))return!1;const s={id:t,handle:e,army:{}};for(let e in game.SOLDIERS)void 0!==game.MERCENARIES[t].army[e]?s.army[e]=game.MERCENARIES[t].army[e]:s.army[e]=0;return this._mercenary.push(s),this.is_player()&&this.core().ui().notify("The mercenaries of the "+game.MERCENARIES[t].name+" are now available for skirmish missions for the duration of one year.","Mercenaries recruited."),this.core().ui().log("game","The city of "+this.name()+" hired the mercenaries of "+game.MERCENARIES[t].name+"."),this.core().save_and_refresh(),!0}return!1}recruit_ship(e){return void 0!==this._navy[e]&&null!==this._navy[e]?this._navy[e]=this._navy[e]+1:this._navy[e]=1,this.is_player()&&this.core().save_and_refresh(),!0}recruit_soldier(e){return void 0!==this._army[e]&&null!==this._army[e]?this._army[e]=this._army[e]+1:this._army[e]=1,this.is_player()&&this.core().save_and_refresh(),!0}disband_ship(e){return void 0!==this._navy[e]&&(this._navy[e]-1>=0?this._navy[e]=this._navy[e]-1:this._navy[e]=0,!0)}disband_soldier(e){return void 0!==this._army[e]&&(this._army[e]-1>=0?this._army[e]=this._army[e]-1:this._army[e]=0,!0)}set_navy(e){return this._navy=e,this}set_army(e){return this._army=e,this}release_mercenaries(){return this._mercenary=[],this}army(){return this._army}navy(){return this._navy}is_mercenary_recruited(e){for(let t=0;t<this._mercenary.length;t++)if(void 0!==this._mercenary[t]&&this._mercenary[t].handle===e)return!0;return!1}release_mercenary(e){if(void 0!==this._mercenary[e]){const t=game.MERCENARIES[e];return this._mercenary.splice(e,1),this.is_player()&&this.core().ui().notify(t.name+" has been released from its duties."),!0}return!1}export_buildings(){const e=[];for(let t=0;t<this._buildings.length;t++)void 0!==this._buildings[t]&&e.push({handle:this._buildings[t].handle,level:this._buildings[t].level,stopped:this._buildings[t].is_stopped()});return e}get_building(e){const t=this.get_buildings();if("string"==typeof e)for(let a=0;a<t.length;a++)if(void 0!==t[a]&&t[a].type===e)return t[a];return!1}_build(e,t){t=void 0!==t&&!0===t;const a=void 0!==e.handle?e.handle:e,s=void 0!==e.level?e.level:1,i=void 0!==e.stopped&&e.stopped,r=this.get_building_data(a);if(r){s>1&&(r.level=s);let e=new building({settlement:this,type:a,data:r,hidden:t,stopped:i});return this._buildings.push(e),!0}return!1}setup_initial_buildings(e,t){if("object"==typeof e){for(let a=0;a<e.length;a++)this._build(e[a],t);return!0}return this._build(e,t),!0}get_building_data(e){const t=game.BUILDINGS.findIndexByHandle(e);return!1!==t&&game.BUILDINGS[t]}build(e){const t=this.get_building_data(e);if(t){if(void 0!==t.requires.settlement_level&&this._properties.level<t.requires.settlement_level)return this.is_player()&&this.core().ui().error("Your city level is too low to construct this building."),!1;if(void 0!==t.requires.climate&&-1===$.inArray(this.climate().id,t.requires.climate))return this.is_player()&&this.core().ui().error("Your city lacks the required fertility and climate to construct this building."),!1;if(void 0!==t.requires.research&&!this.core().has_research(t.requires.research))return this.is_player()&&this.core().ui().error("Your city is missing the `"+this.core().get_research_config_data(t.requires.research).name+"` research needed to construct this building."),!1;if(void 0!==t.requires.buildings){const e=t.requires.buildings;for(let t in e)if(!this.is_building_built(t,e[t])){const a=this.core().get_building_config_data(t);return a&&this.is_player()&&this.core().ui().error("You don`t have the required level "+e[t]+" "+a.name+"."),!1}}if(!this.has_resources(t.cost))return this.is_player()&&this.core().ui().error("You don`t have enough resources to construct this building."),!1;if(!this.remove_resources(t.cost))return galse;const a=new building({settlement:this,type:e,data:t});return this._buildings.push(a),this.raise_prestige(),this.is_player()&&(this.core().save_and_refresh(),this.core().ui().citymap_scrollto_building(a),this.core().ui().notify("A new "+a.name+" was just constructed in your city."),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0})),a}return!1}is_building_built(e,t){void 0===t&&(t=1);const a=this.get_buildings();for(let s=0;s<a.length;s++)if(void 0!==a[s]&&a[s].type===e&&a[s].level>=t)return!0;return!1}get_buildings(){return this._buildings}diplomacy(e,t){return"object"==typeof e&&(e=e.id()),"number"==typeof e&&(this._status[e].status=t,t===game.DIPLOMACY_WAR?(this.core().do_achievement("declarewar"),this.reset_influence(e)):t===game.DIPLOMACY_ALLIANCE?(this.core().do_achievement("gotyourback"),this.set_influence(e,game.MAX_INFLUENCE_VALUE)):t===game.DIPLOMACY_PACT?(this.core().do_achievement("pactish"),this.set_influence(e,Math.ceil(game.MAX_INFLUENCE_VALUE/2))):t===game.DIPLOMACY_CEASE_FIRE?this.set_influence(e,Math.ceil(game.MAX_INFLUENCE_VALUE/4)):t===game.DIPLOMACY_VASSAL&&(this.core().do_achievement("youaremine"),this.set_influence(e,game.MAX_INFLUENCE_VALUE)),this.core().save_and_refresh(),!0)}status(e,t){return void 0!==t&&(this._status[e]=t),void 0!==e?this._status[e]:this._status}can_recruit_heroes(){return this.is_building_built("tavern")}can_diplomacy(){return this.is_building_built("embassy")}get_influence_with_settlement(e){return"number"==typeof e?this._status[e].influence:"object"==typeof e?this._status[e.id()].influence:"string"==typeof e?this._status[this.core().get_settlement(e)].influence:void 0}lower_influence(e,t){return void 0===t&&(t=1),this.set_influence(e,this.get_influence_with_settlement(e)-t)}set_influence(e,t){return"object"==typeof e?e=e.id():"string"==typeof e&&(e=this.core().get_settlement(e)),t<game.MIN_INFLUENCE_VALUE||this._status[e].influence<game.MIN_INFLUENCE_VALUE?this._status[e].influence=game.MIN_INFLUENCE_VALUE:this._status[e].influence=t,this._status[e].influence>=game.MAX_INFLUENCE_VALUE&&(this._status[e].influence=game.MAX_INFLUENCE_VALUE),this.get_influence_with_settlement(e)}raise_influence(e,t){return void 0===t&&(t=1),this.set_influence(e,this.get_influence_with_settlement(e)+t)}reset_influence(e){return this.set_influence(e,game.MIN_INFLUENCE_VALUE),this}get_diplomacy_status(e){return{id:this._status[e].status,name:game.DIPLOMACIES[this._status[e].status].capitalize()}}raise_espionage(e){return void 0===e&&(e=1),this.espionage(this.espionage()+e)}lower_espionage(e){return void 0===e&&(e=1),this.espionage(this.espionage()-e)}reset_espionage(){return this.espionage(game.MIN_ESPIONAGE_VALUE)}espionage(e){return void 0!==e&&(e<game.MIN_ESPIONAGE_VALUE||this.resources.espionage<game.MIN_ESPIONAGE_VALUE?this.resources.espionage=game.MIN_ESPIONAGE_VALUE:this.resources.espionage=e,this.resources.espionage>=game.MAX_ESPIONAGE_VALUE&&(this.resources.espionage=game.MAX_ESPIONAGE_VALUE)),this.resources.espionage}raise_fame(e){return void 0===e&&(e=1),this.fame(this.fame()+e)}lower_fame(e){return void 0===e&&(e=1),this.fame(this.fame()-e)}fame(e){return void 0!==e?(e<game.MIN_FAME_VALUE||this.resources.fame<game.MIN_FAME_VALUE?this.resources.fame=game.MIN_FAME_VALUE:this.resources.fame=e,e):this.resources.fame}reset_fame(){return this.fame(game.MIN_FAME_VALUE)}raise_prestige(e){return void 0===e&&(e=1),this.prestige(this.prestige()+e)}lower_prestige(e){return void 0===e&&(e=1),this.prestige(this.prestige()-e)}reset_prestige(){return this.prestige(game.MIN_PRESTIGE_VALUE)}prestige(e){return void 0!==e&&(e<game.MIN_PRESTIGE_VALUE||this.resources.prestige<game.MIN_PRESTIGE_VALUE?this.resources.prestige=game.MIN_PRESTIGE_VALUE:this.resources.prestige=e,this.resources.prestige>=game.MAX_PRESTIGE_VALUE&&(this.resources.prestige=game.MAX_PRESTIGE_VALUE)),this.resources.prestige}change_religion(e){return this.faith()!==game.MAX_FAITH_VALUE&&0!==e?(this.is_player()&&this.core().ui().error("You don`t have enough faith to switch religions."),!1):"number"==typeof e&&this.religion().id===e||"string"==typeof e&&this.religion().name===e?(this.is_player()&&this.core().ui().error("You cannot switch religion to your already existing one."),!1):this.religion(e)?(this.reset_faith(),this.refresh_heroes(),this.is_player()&&this.core().ui().notify("Your settlement`s new religion is <strong>"+this.religion().name+"</strong>","Religion Adopted",!1,game.NOTIFY_RELIGION),this.core().save_and_refresh(),!0):(this.is_player()&&this.core().ui().error("Unable to switch religion to the specified one."),!1)}religion(e){if(void 0!==e){if("number"==typeof e)return this._properties.religion=e,!0;if("string"==typeof e){const t=$.inArray(e,game.RELIGIONS);if(-1!==t)return this._properties.religion=t,!0}}return{id:this._properties.religion,name:game.RELIGIONS[this._properties.religion].capitalize()}}raise_faith(e){return void 0===e&&(e=1),this.faith(this.faith()+e)}lower_faith(e){return void 0===e&&(e=1),this.faith(this.faith()-e)}reset_faith(){return this.faith(game.MIN_FAITH_VALUE)}faith(e){return void 0!==e&&(e<game.MIN_FAITH_VALUE||this.resources.faith<game.MIN_FAITH_VALUE?this.resources.faith=game.MIN_FAITH_VALUE:this.resources.faith=e,this.resources.faith>=game.MAX_FAITH_VALUE&&(this.resources.faith=game.MAX_FAITH_VALUE)),this.resources.faith}can_research(){return this.is_building_built("academy")}raise_research(e){return void 0===e&&(e=1),this.research(this.research()+e)}lower_research(e){return void 0===e&&(e=1),this.research(this.research()-e)}reset_research(){return this.research(game.MIN_RESEARCH_VALUE)}research(e){return void 0!==e&&(e<game.MIN_RESEARCH_VALUE||this.resources.research<game.MIN_RESEARCH_VALUE?this.resources.research=game.MIN_RESEARCH_VALUE:this.resources.research=e,this.resources.research>=game.MAX_RESEARCH_VALUE&&(this.resources.research=game.MAX_RESEARCH_VALUE)),this.resources.research}merge_resources(e){if(void 0!==e)for(let t in e)game.is_virtual_resource(t)||this.add_to_storage(t,e[t]);return this}get_spoils(){const e=this.get_resources();let t=Object.keys(e);const a={};let s,i,r=0;for(;r<3;)i=t[Math.floor(Math.random()*t.length)],s=e[i],game.is_virtual_resource(i)||s>0&&this.remove_resource(i,s)&&(a[i]=s,r++);return a}inc_coins(e){return this.coins(this.coins()+e)}dec_coins(e){return!!this.has_coins(e)&&(this.coins(this.coins()-e),!0)}coins(e){return void 0!==e&&(this.resources.coins=e),this.resources.coins}storage(e){void 0!==e&&(this._properties.storage=e);let t=0;for(let e in this.get_resources())game.is_virtual_resource(e)||(t+=this.get_resources()[e]);return{occupied:t,all:this._properties.storage}}_fill_resources(){for(let e in game.RESOURCES)void 0===this.resources[e]&&(this.resources[e]=0);return this}add_to_storage(e,t){let a;return!!game.resource_exists(e)&&(!(!this.is_ruins()&&!this.has_storage_space_for(e,t))&&(a=this.get_resources(),void 0!==a[e]?a[e]=a[e]+t:a[e]=t,!0))}has_coins(e){return!(this.coins()-e<0)||(this.is_player()&&this.core().ui().error(this.name()+" doesn`t have enough "+game.get_resource_name("coins")+"."),!1)}remove_resources(e){let t=!0;for(let a in e)if(t=this.remove_resource(a,e[a]),!1===t)return!1;return!0}remove_resource(e,t){const a=this.get_resources();return a[e]=a[e]-t,a[e]<0&&(a[e]=0),!0}has_storage_space_for(e,t){let a=0;if(void 0===t)for(let t in e)game.is_virtual_resource(t)||(a+=e[t]);else game.is_virtual_resource(e)||(a+=t);let s=this.storage();return!(s.occupied+a>s.all)}is_urban(){return!(!this.is_city()&&!this.is_metropolis())}has_any_resources(e){let t=!1;for(let a in e)if(t=this.has_resource(a,e[a]),!0===t)return a;return!1}has_resources(e){let t=!0;for(let a in e)if(t=this.has_resource(a,e[a]),!1===t)return!1;return t}has_resource(e,t){const a=this.get_resources();return!!game.resource_exists(e)&&!(a[e]-t<0)}get_resources(){return this.resources}set_resources(e){return this.resources=e,this}can_trade(){return this.is_building_built("tradingpost")}buy_from_settlement(e,t,a,s){if(!game.resource_exists(t))return this.is_player()&&this.core().ui().error("The resource you specified does not exist."),!1;if(this.can_trade()){let i,r;if("string"==typeof e||"number"==typeof e){if(i=this.core().get_settlement(e),!1===e)return this.is_player()&&this.core().ui().error("The settlement of <strong>"+e+"</strong> does not exist."),!1}else i=e,e=i.name();const n=this.religion().id===i.religion().id,o=i.get_trades();if(null===o)return this.is_player()&&this.core().ui().error("The settlement of <strong>"+e+"</strong> does not trade any goods."),!1;if(void 0===o.exports)return this.is_player()&&this.core().ui().error("The settlement of <strong>"+e+"</strong> does not export any goods."),!1;for(let l in o.exports)if(l===t){void 0===a&&(a=o.exports[l]),r=Math.ceil(game.RESOURCES[l].price*game.TRADES_ADDITION/100),void 0!==s&&!0===s&&(r=Math.ceil(r+Math.ceil(game.RESOURCES[l].price*game.AUCTIONEER_DISCOUNT/100)));const t=game.calc_price_plus_discount(a,l,r),d=game.calc_price(a,l),c=Math.ceil(game.RESOURCES[l].price+r);return this.has_storage_space_for(a)?!1!==this.dec_coins(t)&&(!!i.has_resource(l,a)&&(!!i.remove_resource(l,a)&&(i.inc_coins(d),this.add_to_storage(l,a),this.remove_from_exports(i,l,a),this.raise_influence(i.id(),n?2*game.IMPORT_INFLUENCE:game.IMPORT_INFLUENCE),this.raise_prestige(n?2*game.IMPORT_PRESTIGE:game.IMPORT_PRESTIGE),this.raise_fame(game.FAME_PER_TRADE),this.core().ui().refresh(),this.is_player()&&this.core().ui().notify(this.name()+" bought <strong>"+a+"</strong> "+game.get_resource_name(l)+" from "+e+" for <strong>"+c+"</strong> "+game.get_resource_name("coins")+" each, for a total of <strong>"+t+"</strong> "+game.get_resource_name("coins")+".","World Market"),{buyer:this.name(),amount:a,goods:game.get_resource_name(l),seller:e,price:Math.round(game.RESOURCES[l].price+r),totalPrice:t}))):(this.core().ui().error(this.name()+" does not have enough storage space for <strong>"+a+"</strong> "+game.get_resource_name(l)+"."),!1)}this.is_player()&&this.core().ui().error("The settlement of <strong>"+e+"</strong> does not export the requested goods.")}return!1}reset_trades(){const e=this.core().generate_random_resources(!1,this.get_type());let t=e.resources;return t.coins=this.resources.coins,t.fame=this.resources.fame,t.prestige=this.resources.prestige,t.espionage=this.resources.espionage,t.research=this.resources.research,t.faith=this.resources.faith,this.resources=t,this.is_urban()&&(this.trades=e.trades),!0}sell_to_settlement(e,t,a){if(!game.resource_exists(t))return this.is_player()&&this.core().ui().error("The resource you specified does not exist."),!1;if(this.can_trade()){let s;if("string"==typeof e||"number"==typeof e){if(s=this.core().get_settlement(e),!1===e)return this.is_player()&&this.core().ui().error(e+" does not exist."),!1}else s=e;const i=this.religion().id===s.religion().id,r=s.get_trades();if(null===r)return this.is_player()&&this.core().ui().error(e+" does not trade any goods."),!1;if(void 0===r.imports)return this.is_player()&&this.core().ui().error(e+" does not import any goods."),!1;for(let n in r.imports)if(n===t){void 0===a&&(a=r.imports[n]);const t=Math.ceil(game.RESOURCES[n].price*game.TRADES_DISCOUNT/100),o=game.calc_price_minus_discount(a,n,t),l=game.calc_price(a,n),d=Math.ceil(game.RESOURCES[n].price-t);return this.has_resource(n,a)?!!this.remove_resource(n,a)&&(this.inc_coins(o),s.dec_coins(l)?(s.add_to_storage(n,a),this.remove_from_imports(s,n,a),this.raise_influence(s.id(),i?2*game.EXPORT_INFLUENCE:game.EXPORT_INFLUENCE),this.raise_prestige(i?2*game.EXPORT_PRESTIGE:game.EXPORT_PRESTIGE),this.raise_fame(game.FAME_PER_TRADE),this.core().ui().refresh(),this.is_player()&&this.core().ui().notify(this.name()+" sold <strong>"+a+"</strong> "+game.get_resource_name(n)+" to "+e+" for <strong>"+d+"</strong> "+game.get_resource_name("coins")+" each, for a total of <strong>"+o+"</strong> "+game.get_resource_name("coins")+".","World Market"),{seller:this.name(),amount:a,goods:game.get_resource_name(n),buyer:e,price:Math.round(game.RESOURCES[n].price-t),totalPrice:o}):(this.is_player()&&this.core().ui().error(e+" does not have enough "+game.get_resource_name("coins")+"."),!1)):(this.core().ui().error(this.name()+" does not have enough "+game.get_resource_name(n)+" to sell."),!1)}this.is_player()&&this.core().ui().error(e+" does not import the specified goods.")}return!1}remove_from_exports(e,t,a){return e.trades.exports[t]=e.trades.exports[t]-a,!0}remove_from_imports(e,t,a){return e.trades.imports[t]=e.trades.imports[t]-a,!0}get_trades(){return this.trades}get_trades_exports(){return this.trades.exports}get_trades_imports(){return this.trades.imports}nice_name(){return this.is_metropolis()?"Metropolis of "+this.name():this.is_city()?"City of "+this.name():this.is_village()?"Village of "+this.name():this.is_camp()?"Raider Camp "+this.name():this.is_ruins()?"Ruins of "+this.name():""}set_trades(e){return this.trades=e,this}}
/**
 * Main Game event object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class event
 * @returns {event}
 */class event{constructor(e){return this._core=e.core,this.name=e.name,this.chance=void 0!==e.chance?e.chance:.001,this.description=e.description,this.raise=void 0!==e.raise?e.raise:null,this.lower=void 0!==e.lower?e.lower:null,this.destroy=void 0!==e.destroy?e.destroy:null,this.build=void 0!==e.build?e.build:null,this.process(),this}process(){const e=this.core(),t=game.get_random(1,e.settlements.length),a=e.get_settlement(t),s=e.get_settlement();let i="";if(!1!==a){if(i=this.description.replace(/SETTLEMENT/g,a.name()),null!==this.raise)for(let e in this.raise){"influence"===e?s.raise_influence(a.id(),this.raise[e]):s.has_storage_space_for(e,this.raise[e])&&s.add_to_storage(e,this.raise[e]);let t=new RegExp(e.toUpperCase(),"g");i=i.replace(t,this.raise[e])}if(null!==this.lower)for(let e in this.lower){"influence"===e?s.lower_influence(a.id(),this.lower[e]):s.remove_resource(e,this.lower[e]);let t=new RegExp(e.toUpperCase(),"g");i=i.replace(t,this.lower[e])}}if(null!==this.destroy){let e=s.get_buildings();const t=game.get_random(1,e.length),a=e[t];if(void 0!==a){const s=a.name;e[t].demolish();let r=new RegExp("BUILDING","g");i=i.replace(r,s)}}if(null!==this.build){let e=new RegExp("BUILDING","g");i=i.replace(e,name)}return s.is_player()&&e.ui().notify(i,"Event: "+this.name,!1,game.NOTIFY_EVENT),e.ui().log("event",this.name),this}core(){return this._core}}
/**
 * Main Game building object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class building
 * @returns {building}
 */class building{constructor(e){let t=this;return this.settlement=e.settlement,this.type=e.type,this.name=e.data.name,this.problems=!1,this.is_production=void 0!==e.data.production,this.is_municipal=void 0!==e.data.is_municipal&&!0===e.data.is_municipal,this.is_housing=void 0!==e.data.tax,this.level=void 0!==e.data.level?e.data.level:1,this.position=void 0!==e.data.position?e.data.position:{x:0,y:0},this.stopped=void 0!==e.stopped&&e.stopped,this.handle=e.data.handle,e.data.level=this.level,!0!==e.hidden&&this.settlement.is_player()&&($("section.game").append(t.core().ui().building_element(e)).on("click","#building-"+this.handle,(function(){return void 0!==t.core().ui().panel_class_names[t.handle]?t.core().ui().open_panel(t.handle,e.data):t.core().ui().open_panel("building",e.data,!0),!1})),!0===this.stopped?this.notify(game.NOTIFICATION_PAUSED):this.notify(),this.core().ui().refresh()),void 0!==e.data.storage&&this.settlement.storage(this.settlement.storage().all+e.data.storage*this.level),this}is_upgradable(){const e=this.get_building_data();return this.level<e.levels}is_downgradable(){return this.level>1}get_upgrade_costs(){if(this.is_upgradable()){const e=this.level+1,t={},a=this.get_building_data(this.type);for(let s in a.cost)t[s]=a.cost[s]*e;return t}return!1}upgrade(){const e=this.core(),t=this.settlement,a=this.level+1;let s=this.get_building_data(this.type),i=this.type;const r=this.get_upgrade_costs();return!!(s&&this.is_upgradable()&&t.is_building_built(this.type))&&(r&&this.settlement.has_resources(r)?(this.settlement.remove_resources(r),this.set_level(a),t.is_player()&&("house"===this.type.slice(0,5)&&(i=this.type.slice(0,5)),$("section.game .building[data-type="+this.type+"]").css({"background-image":"url("+game.ASSETS_URL+"images/assets/buildings/"+(void 0===s.visible_upgrades||!1===s.visible_upgrades?i:i+this.level)+".png)"})),void 0!==s.storage&&t.storage(t.storage().all+s.storage),t.is_player()&&(e.save_and_refresh(),e.ui().notify(this.name+" upgraded to level "+this.level)),!0):(t.is_player()&&e.ui().error("You don`t have enough resources to upgrade your "+this.name+"."),!1))}downgrade(){const e=this.settlement;let t=this.get_building_data(this.type),a=this.type;const s=this.level-1;return!!(t&&this.is_downgradable()&&e.is_building_built(this.type))&&(this.set_level(s),e.is_player()&&("house"===this.type.slice(0,5)&&(a=this.type.slice(0,5)),$("section.game .building[data-type="+this.type+"]").css({"background-image":"url("+game.ASSETS_URL+"images/assets/buildings/"+(void 0===t.visible_upgrades||!1===t.visible_upgrades?a+"1":a+this.level)+".png)"}),void 0!==t.storage&&e.storage(e.storage().all-t.storage),this.core().save_and_refresh(),this.core().ui().notify(this.name+" downgraded to level "+this.level)),!0)}is_housing_building(){return this.is_housing}is_municipal_building(){return this.is_municipal}is_production_building(){return this.is_production}is_stopped(){return this.stopped}start_production(){return!(!this.settlement.is_building_built(this.type)||!this.is_production_building())&&(this.settlement.is_player()&&this.core().ui().notify(this.name+"`s production started."),this.notify(),this.stopped=!1,this.core().save_and_refresh(),!0)}stop_production(){return!(!this.settlement.is_building_built(this.type)||!this.is_production_building())&&(this.settlement.is_player()&&this.core().ui().notify(this.name+"`s production stopped."),this.notify(game.NOTIFICATION_PAUSED),this.stopped=!0,this.core().save_and_refresh(),!0)}demolish(e){const t=this.settlement,a=this.get_building_data(this.type),s=t.get_buildings();if("marketplace"!==this.type){for(let e in a.cost)t.add_to_storage(e,a.cost[e]);for(let e=0;e<s.length;e++)s[e].type===this.type&&s.splice(e,1);return t.is_player()&&($("section.game > .building[data-type="+this.type+"]").remove(),!0===e&&this.core().ui().notify(this.name+" demolished successfully!")),!0}return t.is_player()&&!0===e&&this.core().ui().error("Unable to demolish the specified building `"+this.name+"`!"),!1}get_building_data(e){return void 0===e&&(e=this.type),this.core().get_building_config_data(e)}get_settlement_resources(){return this.settlement.get_resources()}has_building_requirements(){let e,t=!0;const a=this.get_building_data();if(void 0!==a.requires.buildings){const s=a.requires.buildings;for(let a in s)if(this.settlement.is_building_built(a,s[a])){if(e=this.settlement.get_building(a),!e||e.is_stopped())return!1;if(t=e.has_building_requirements()&&e.has_settlement_requirements(),!1===t)return!1}}return t}has_research_requirements(){const e=this.get_building_data();return!(void 0!==e.requires.research&&!this.core().has_research(e.requires.research))}has_settlement_requirements(){const e=this.get_building_data();return!(void 0!==e.requires.settlement_level&&e.requires.settlement_level>this.settlement.level())}has_requirements(){return this.has_building_requirements()&&this.has_settlement_requirements()&&this.has_research_requirements()}tax(e){let t=this.get_tax_amount(e);return this.settlement.inc_coins(t),this}get_tax_amount(e){return e*this.level+this.core().get_tax_modifier(this.handle)}produce(e){if(!this.settlement.has_storage_space_for(e))return!1;const t=this.settlement;let a,s;const i=this.get_building_data();let r;for(let n in e)if(s=e[n]*this.level,"faith"===n)t.raise_faith(s);else if("research"===n)t.raise_research(s);else if("espionage"===n)t.raise_espionage(s);else if("fame"===n)t.raise_fame(s);else if("prestige"===n)t.raise_prestige(s);else if(s+=this.core().get_prod_modifier(i),t.add_to_storage(n,s),void 0!==i.chance)for(let e in i.chance)a=Math.random(),a*this.level<i.chance[e]&&(r=game.get_random(1,5),t.add_to_storage(e,r));return!0}process(){const e=this.get_building_data(),t=e.materials,a=this.settlement;if(this.is_housing_building()){if(void 0!==t){if(!a.has_resources(t))return this.notify(game.NOTIFICATION_MISSING_RES),!1;a.remove_resources(t),this.tax(e.tax),this.log_to_console()}}else if(this.is_production_building()){if(this.is_stopped())return this.notify(game.NOTIFICATION_PAUSED),!1;{let s=e.production;if(!this.has_requirements())return this.notify(game.NOTIFICATION_MISSING_REQ),!1;if(void 0!==t)if(Array.isArray(t)){let e=!0,i={};for(let s=0;s<t.length;s++){let r=a.has_any_resources(t[s]);!1!==r?i[r]=t[s][r]:e=!1}if(!0!==e)return this.notify(game.NOTIFICATION_MISSING_RES),this.problems=!0,!1;if(!a.has_storage_space_for(s))return this.core().ui().log("game","There is no storage space in "+a.name()+" to accomodate the new goods.",!0),this.problems=!0,!1;a.remove_resources(i),this.produce(s)&&this.log_to_console()}else{if(!a.has_resources(t))return this.notify(game.NOTIFICATION_MISSING_RES),!1;if(!a.has_storage_space_for(s))return this.core().ui().log("game","There is no storage space in "+a.name()+" to accomodate the new goods.",!0),this.problems=!0,!1;a.remove_resources(t),this.produce(s)&&this.log_to_console()}else{if(!a.has_storage_space_for(s))return this.core().ui().log("game","There is no storage space in "+a.name()+" to accomodate the new goods.",!0),this.problems=!0,!1;this.produce(s)&&this.log_to_console()}}}return!0}is_marketplace(){return"marketplace"===this.type}core(){return this.settlement.core()}has_problems(){return this.problems}set_level(e){return this.level=e,this}get_level(){return this.level}log_to_console(){this.notify();const e=this.get_building_data();let t="",a="";if(void 0!==e.production){for(let a in e.production)t+=e.production[a]*this.level+this.core().get_prod_modifier(e)+" "+a+", ";t=t.substring(0,t.length-2)}if(void 0!==e.materials)if(Array.isArray(e.materials)){const t={};for(let a=0;a<e.materials.length;a++){const s=this.settlement.has_any_resources(e.materials[a]);!1!==s&&(t[s]=e.materials[a][s])}for(let e in t)a+=t[e]+" "+e+", ";a=a.substring(0,a.length-2)}else{for(let t in e.materials)a+=e.materials[t]+" "+t+", ";a=a.substring(0,a.length-2)}return void 0!==e.tax?this.core().ui().log("game",this.name+" used "+a+" and got taxed for "+this.get_tax_amount(e.tax)+" coins."):void 0!==e.production&&void 0===e.materials?this.core().ui().log("game",this.name+" produced "+t+"."):this.core().ui().log("game",this.name+" used "+a+" and produced "+t+"."),this}notify(e){if(void 0!==e){if(this.problems=!0,this.settlement.is_player()){let t=$("section.game > #building-"+this.handle);switch(e){case game.NOTIFICATION_MISSING_REQ:this.core().ui().log("game",this.name+" doesn`t have one of the buildings required to be operational.",!0),t.empty().append('<span class="notification requirements"></span>');break;case game.NOTIFICATION_PAUSED:this.core().ui().log("game",this.name+"`s production is stopped.",!0),t.empty().append('<span class="notification paused"></span>');break;case game.NOTIFICATION_SETTLEMENT_LOW_LEVEL:this.core().ui().log("game","Your settlement level is too low for "+this.name+" to be active.",!0),t.empty().append('<span class="notification lowlevel"></span>');break;case game.NOTIFICATION_MISSING_RES:default:this.core().ui().log("game",this.name+" is missing materials for production.",!0),t.empty().append('<span class="notification error"></span>')}}}else this.problems=!1,this.settlement.is_player()&&$("section.game > #building-"+this.handle).empty();return this}}
/**
 * Battleground object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class battleground
 * @returns {battleground}
 */class battleground{constructor(e){return this._core=e.core,this._properties={},this._elements={},this._grid=[],this.done=!1,this._stats={attacking:{},defending:{}},this._current_turn=1,this._properties.width=e.width,this._properties.height=e.height,this._elements.container=e.elements.container,this._elements.console=e.elements.console,this._elements.attack=e.elements.attack,this._elements.defense=e.elements.defense,this._attack=e.attack,this._defense=e.defense,e.on_win instanceof Function&&(this.on_win=e.on_win),e.on_lose instanceof Function&&(this.on_lose=e.on_lose),e.on_select instanceof Function&&(this.on_select=e.on_select),e.on_move instanceof Function&&(this.on_move=e.on_move),e.on_attack instanceof Function&&(this.on_attack=e.on_attack),e.on_end_turn instanceof Function&&(this.on_end_turn=e.on_end_turn),this._attack.city===this.core().get_settlement().id()?(this._player=1,this._computer=2):(this._player=2,this._computer=1),this._setup(),this.show_stats(),this}attack(e){let t,a=this._from.x,s=this._from.y,i=this._grid[s][a],r=this._grid[e.y][e.x],n=game.SOLDIERS[i.item].ranged,o=this.core().get_settlement(i.city),l=this.core().get_settlement(r.city),d=0;if(o&&i.moved)return this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> already used up its turn."),!1;if(null!==i&&null!==r&&o&&l)if(t=r.side===game.BATTLEGROUND_DEFENSE?"_defense":"_attack",void 0!==n){if(Math.abs(e.y-s)+Math.abs(e.x-a)>n)return this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> is not close enough for a ranged attack."),!1;let c=Math.ceil(i.attack/2),m=r.defense;m-c<0?(this[t].army[r.item]=0,this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> attacked "+l.name()+"`s <strong>"+game.SOLDIERS[r.item].name+"</strong> for "+c+" damage from range and killed its opponent."),this._cell_empty(e)):(d=Math.ceil((m-c)/game.SOLDIERS[r.item].defense),r.total=d,this[t].army[r.item]=d,this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> attacked "+l.name()+"`s <strong>"+game.SOLDIERS[r.item].name+"</strong> for "+c+" damage from range.")),this._cell_under_attack(e),i.moved=!0,this.redraw()}else{let n=game.SOLDIERS[this._grid[s][a].item].moves;if(Math.abs(e.y-s)+Math.abs(e.x-a)>n)return this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> doesn`t have a ranged attack."),!1;let c=Math.ceil(i.attack/2),m=r.defense;m-c<0?(this[t].army[r.item]=0,this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> attacked "+l.name()+"`s <strong>"+game.SOLDIERS[r.item].name+"</strong> for "+c+" damage in melee and killed its opponent."),this._cell_empty(e)):(d=Math.ceil((m-c)/game.SOLDIERS[r.item].defense),r.total=d,this[t].army[r.item]=d,this.log(o.name()+"`s <strong>"+game.SOLDIERS[i.item].name+"</strong> attacked "+l.name()+"`s <strong>"+game.SOLDIERS[r.item].name+"</strong> for "+c+" damage in melee.")),this._cell_under_attack(e),i.moved=!0,this.redraw()}return this._from=null,!0}end_turn(){this._from=null,this._do_computer();for(let e=0;e<this._grid.length;e++)for(let t=0;t<this._grid[e].length;t++)null!==this._grid[e][t]&&(this._grid[e][t].moved=!1);return this._current_turn++,this.on_end_turn.call(self,this.num_turns()),this.redraw(),this._done||this.log("Turn <strong>"+this._current_turn+"</strong> started now."),this}_check_status(){let e;return this._done||((this._stats.attacking.attack<=0||this._stats.attacking.defense<=0||this._stats.defending.attack<=0||this._stats.defending.defense<=0)&&(this._done=!0,this._reset()),this._stats.attacking.attack<=0||this._stats.attacking.defense<=0?(this._defense.city===this.core().get_settlement().id()?(this._on_win.call(this,this._defense,this._attack),this.on_win.call(this,this._defense,this._attack)):(this._on_lose.call(this,this._defense,this._attack),this.on_lose.call(this,this._defense,this._attack)),e=this.core().get_settlement(this._defense.city)):(this._stats.defending.attack<=0||this._stats.defending.defense<=0)&&(this._attack.city===this.core().get_settlement().id()?(this._on_win.call(this,this._attack,this._defense),this.on_win.call(this,this._attack,this._defense)):(this._on_lose.call(this,this._attack,this._defense),this.on_lose.call(this,this._attack,this._defense)),e=this.core().get_settlement(this._attack.city)),this._done&&(this.log(e.name()+" won this battle!"),this.show_stats())),!1}show_stats(){return $(this._elements.attack).empty().append(this.core().get_settlement(this._attack.city).name()+" "+this._stats.attacking.attack+" / "+this._stats.attacking.defense),$(this._elements.defense).empty().append(this.core().get_settlement(this._defense.city).name()+" "+this._stats.defending.attack+" / "+this._stats.defending.defense),{attack:this._attack,defense:this._defense}}log(e){return $(this._elements.console).prepend("<p>"+e+"</p>"),this}_reset(){let e="even",t="";for(let a=0;a<=this._properties.height-1;a++){this._grid[a]=[],t+='<ol class="'+e+'">';for(let e=0;e<=this._properties.width-1;e++)this._grid[a][e]=null,t+='<li data-pos="'+e+"-"+a+'" data-x="'+e+'" data-y="'+a+'" class="cell empty"></li>';t+="</ol>",e="even"===e?"odd":"even"}return $(this._elements.container).empty().append(t),this}grid(){return this._grid}num_turns(){return this._current_turn}core(){return this._core}properties(){return this._properties}_move_to_enemy(e){return!1}_do_computer(){for(let e=0;e<this._grid.length;e++)for(let t=0;t<this._grid[e].length;t++)if(null!==this._grid[e][t]&&this._grid[e][t].side===this._computer){let a=this._grid[e][t];this._from={x:t,y:e},this._cell_select(this._from),game.SOLDIERS[a.item].ranged?this._check_for_ranged_target(this._player):this._check_for_melee_target(this._player),this._move_to_enemy(this._from),this._from=null}return!0}_check_for_melee_target(e){if(null!==this._from){let t=this._grid[this._from.y][this._from.x],a=game.SOLDIERS[t.item].moves;for(let s=0;s<this._grid.length;s++)for(let i=0;i<this._grid[s].length;i++)if(null!==t&&!t.moved&&a&&Math.abs(s-this._from.y)+Math.abs(i-this._from.x)<=a&&null!==this._grid[s][i]&&this._grid[s][i].side===e)return this.attack({x:i,y:s}),!0}return!1}_check_for_ranged_target(e){if(null!==this._from)for(let t=0;t<this._grid.length;t++)for(let a=0;a<this._grid[t].length;a++)if(null!==this._grid[t][a]&&this._grid[t][a].side===e)return this.attack({x:a,y:t}),!0;return!1}_on_win(e,t){let a=this.core().get_settlement(e.city),s=this.core().get_settlement(t.city);if(this._attack.city===e.city){s.army=s.load_army(t.army),s.navy=s.load_navy(t.navy);let i=s.get_spoils();this.core().queue_add(s,a,game.ACTION_CAMPAIGN,game.CAMPAIGN_ARMY_RETURN,{army:e.army,navy:e.navy,resources:i})}else if(this._defense.city===e.city){a.army=a.load_army(e.army),a.navy=a.load_navy(e.navy);let i=s.num_soldiers(t.army),r=s.num_ships(t.navy);(i>0||r>0)&&this.core().queue_add(a,s,game.ACTION_CAMPAIGN,game.CAMPAIGN_ARMY_RETURN,{army:t.army,navy:t.navy,resources:{}})}return this}_on_lose(e,t){let a=this.core().get_settlement(e.city),s=this.core().get_settlement(t.city);if(this._attack.city===t.city){a.army=a.load_army(e.army),a.navy=a.load_navy(e.navy);let i=a.num_soldiers(t.army),r=a.num_ships(t.navy);(i>0||r>0)&&this.core().queue_add(a,s,game.ACTION_CAMPAIGN,game.CAMPAIGN_ARMY_RETURN,{army:t.army,navy:t.navy,resources:{}})}else if(this._defense.city===t.city){s.army=s.load_army(t.army),s.navy=s.load_navy(t.navy);let i=s.get_spoils();this.core().queue_add(s,a,game.ACTION_CAMPAIGN,game.CAMPAIGN_ARMY_RETURN,{army:e.army,navy:e.navy,resources:i})}return this}distance(e,t){let a=e.x-t.x,s=e.y-t.y;return(Math.abs(a)+Math.abs(s)+Math.abs(a-s))/2}move(e){let t=this._from.x,a=this._from.y;if(null!==this._from&&null!==e){let s=this._grid[a][t],i=this._grid[e.y][e.x],r=this.core().get_settlement(s.city);if(null!==s&&s.moved)return this.log(r.name()+"`s <strong>"+game.SOLDIERS[s.item].name+"</strong> already used up its turn."),!1;if(null!==s&&null===i&&r){let i=game.SOLDIERS[this._grid[a][t].item].moves;return Math.abs(e.y-a)+Math.abs(e.x-t)<=i?(this._grid[e.y][e.x]=this._grid[a][t],this._cell_empty(this._from),this._from=null,this._grid[e.y][e.x].moved=!0,this.log(r.name()+"`s <strong>"+game.SOLDIERS[s.item].name+"</strong> moved to "+(e.x+1)+"x"+(e.y+1)+"."),this.redraw(),!0):(this.log(r.name()+"`s <strong>"+game.SOLDIERS[s.item].name+"</strong> is unable to move to the specified location."),!1)}}}highlight_cells(e){this._cells_empty();let t=e.x,a=e.y,s=this._grid[a][t];if(null!==s){let e=game.SOLDIERS[s.item].moves;for(let i=0;i<this._grid.length;i++)for(let r=0;r<this._grid[i].length;r++)!s.moved&&e&&Math.abs(i-a)+Math.abs(r-t)<=e&&null===this._grid[i][r]&&$(this._elements.container+" .cell[data-pos="+r+"-"+i+"]").addClass("canmove");let i=game.SOLDIERS[s.item].ranged;for(let e=0;e<this._grid.length;e++)for(let r=0;r<this._grid[e].length;r++)!s.moved&&Math.abs(e-a)+Math.abs(r-t)<=i&&null===this._grid[e][r]&&$(this._elements.container+" .cell[data-pos="+r+"-"+e+"]").addClass("canattack")}return this}_cell_under_attack(e){return $(this._elements.container+" .cell[data-pos="+e.x+"-"+e.y+"]").addClass("scale").delay(1e3).queue((function(){$(this).removeClass("scale").dequeue()})),this}_cells_empty(){for(let e=0;e<this._grid.length;e++)for(let t=0;t<this._grid[e].length;t++)null===this._grid[e][t]&&this._cell_empty({x:t,y:e});return this}_cell_empty(e){return this._grid[e.y][e.x]=null,$(this._elements.container+" .cell[data-pos="+e.x+"-"+e.y+"]").removeData("side").removeData("amount").removeData("soldier").addClass("empty").removeClass("canmove canattack selected").empty(),this}_cell_select(e){return $(this._elements.container+" .cell").removeClass("selected canmove canattack"),$(this._elements.container+" .cell[data-pos="+e.x+"-"+e.y+"]").addClass("selected"),this._from=e,this.highlight_cells(e),this}_cell_add(e,t,a){return this._grid[t][e]=a,$(this._elements.container+" .cell[data-pos="+e+"-"+t+"]").removeData("side").removeData("amount").removeData("soldier").attr("data-side",a.side).attr("data-amount",a.total).attr("data-soldier",a.item).removeClass("empty canmove canattack selected").empty().append('<span class="moves'+(!1===a.moved?" has":"")+'"></span><img class="tips" title="'+game.SOLDIERS[a.item].name+'" src="'+game.ASSETS_URL+"images/assets/army/"+a.item+'.png" /><span class="amount">'+a.total+"</span>"),this}redraw(){let e=0,t=0,a=0,s=0;for(let i=0;i<this._grid.length;i++)for(let r=0;r<this._grid[i].length;r++){let n=this._grid[i][r];null!==n&&n.total>0?(n.attack=n.total*game.SOLDIERS[n.item].attack,n.defense=n.total*game.SOLDIERS[n.item].defense,n.side===game.BATTLEGROUND_ATTACK?(e+=n.attack,t+=n.defense):(a+=n.attack,s+=n.defense),this._cell_add(r,i,n)):this._cell_empty({x:r,y:i})}return this._stats.attacking.attack=e,this._stats.attacking.defense=t,this._stats.defending.attack=a,this._stats.defending.defense=s,this.show_stats(),this._check_status(),$(".tipsy").remove(),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),!0}_setup(){let e=this;this._reset();let t,a=0,s=3;for(let e in this._attack.army)this._attack.army[e]>0&&(!0===game.SOLDIERS[e].siege?(t=0,a=s,s++):t=2,this.add(a,t,1,e,this._attack),a++);s=3,a=0;for(let e in this._defense.army)this._defense.army[e]>0&&(!0===game.SOLDIERS[e].siege?(t=this._properties.width-1,a=s,s++):t=this._properties.width-3,this.add(a,t,2,e,this._defense),a++);return $(this._elements.container).on("mouseover",".cell",(function(){if(null===e._from){let t={x:parseInt($(this).data("x"),10),y:parseInt($(this).data("y"),10)};e.highlight_cells(t)}return!1})).on("click",".cell",(function(){if($(this).hasClass("empty")){if(null!==e._from){let t={x:parseInt($(this).data("x"),10),y:parseInt($(this).data("y"),10)};e.move(t),e.on_move.call(e,e._from,t)}}else if(parseInt($(this).data("side"),10)===e._player)if($(this).hasClass("selected"))e._from=null,$(e._elements.container+" .cell").removeClass("selected canmove canattack");else{let t={x:parseInt($(this).data("x"),10),y:parseInt($(this).data("y"),10)};e._cell_select(t),e.on_select.call(e,t)}else if(parseInt($(this).data("side"),10)===e._computer&&null!==e._from){let t={x:parseInt($(this).data("x"),10),y:parseInt($(this).data("y"),10)};e.attack(t),e.on_attack.call(e,e._from,t)}return!1})),this}add(e,t,a,s,i){return this._cell_add(t,e,{item:s,city:i.city,total:i.army[s],attack:game.SOLDIERS[s].attack*i.army[s],defense:game.SOLDIERS[s].defense*i.army[s],side:a,moved:!1}),this}}
/**
 * Hero object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class hero
 * @returns {hero}
 */class hero{constructor(e){return this._core=e.core,this.name=e.name,this.description=e.description,this}core(){return this._core}}
/**
 * Quest object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class quest
 * @returns {quest}
 */class quest{constructor(e){return this._core=e.core,this.name=e.name,this.description=e.description,this}core(){return this._core}}
/**
 * Main Game window object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_window
 * @returns {ui_window}
 */class ui_window{destructor(){return this.core().ui().log("ui","Destroying window with id `"+this.id+"`"),$(this.handle).remove(),$(".tipsy").remove(),this.on_hide.call(this),!1}destroy(){return this.destructor()}constructor(e){return this._core=e.core,this.id=e.id,this.handle="#window-"+this.id,this.params_data=e.data,this.template=void 0!==e.template?e.template:"",e.on_create instanceof Function?this.on_create=e.on_create:this.on_create=function(){},e.on_show instanceof Function?this.on_show=e.on_show:this.on_show=function(){},e.on_hide instanceof Function?this.on_hide=e.on_hide:this.on_hide=function(){},this.core().ui().window_exists(this.handle)&&this.destroy(),this.core().ui().log("ui","Creating window with id `"+this.id+"`"),this.on_create.call(this,e),$("body").append(this.template.replace(/{ID}/g,this.id)),this.on_show.call(this),$(".tipsy").remove(),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),this}core(){return this._core}}
/**
 * Main modal object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_modal
 * @returns {ui_modal}
 */class ui_modal{constructor(e){this._core=e.core,this.template='<div class="modal-overlay"><div class="modal"><header></header><section></section><footer></footer></div></div>';let t=this;return $("body").append(this.template),$(window).bind("resize",(function(){t._resize()})),this}alert(e){let t=this,a=!1;return this.core().settlements.length>0&&(a=this.core().get_settlement()),!this._is_open()&&(this.core().ui().show_loader(),$(".modal").css({width:"400px"}),this._resize(),$(".modal header").html(e.title),$(".modal footer").html('<a data-id="yes" href="#" class="btn float-right">Yes</a><a data-id="no" href="#" class="btn">No</a>'),$(".modal section").html((a?'<img class="avatar right small" src="'+game.ASSETS_URL+"images/assets/avatars/avatar"+this.core().get_settlement().ruler().avatar+'.png" />':"")+"<p>"+e.text+"</p>"),$(".modal footer").on("click","a",(function(){return t._action($(this).data("id")),!1})),$(".modal-overlay, .modal").show(),"function"==typeof e.on_click&&(this.on_click=e.on_click),this)}_is_open(){return"block"===$(".modal").css("display")}_clear(){return $(".modal-overlay").remove(),this.core().ui().hide_loader(),!0}_action(e){this._clear(),this.on_click(e),$(window).unbind("resize")}_resize(){let e=$(".modal");if(e){let t=parseInt(e.css("width").replace("px",""),10);e.css({top:$(window).height()/2-100+"px",left:($(window).width()-t)/2+"px"})}return this}on_click(){}core(){return this._core}destructor(){return $(".modal-overlay").remove(),$(window).unbind("resize"),!1}}
/**
 * Main Game panel object.
 * 
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel
 * @returns {ui_panel}
 */class ui_panel{destructor(){this.core().ui().log("ui","Destroying panel with id `"+this.id+"`"),$(this.handle).remove();let e=this.core().ui().get_panels();for(let t=0;t<e.length;t++)e[t].id===this.id&&e.splice(t,1);return $(".ui > .viewport").width($(window).width()-$(".ui > aside").width()),$(".tipsy").remove(),this.on_hide.call(this),!1}destroy(){return this.destructor()}constructor(e){let t=this;this._core=e.core,this.id=e.id,this.handle="#panel-"+this.id,this.params_data=e.data,this.template=void 0!==e.template?e.template:"",e.on_create instanceof Function?this.on_create=e.on_create:this.on_create=function(){},e.on_show instanceof Function?this.on_show=e.on_show:this.on_show=function(){},e.on_hide instanceof Function?this.on_hide=e.on_hide:this.on_hide=function(){},e.on_refresh instanceof Function?this.on_refresh=e.on_refresh:this.on_refresh=function(){},this.core().ui().panel_exists(this.handle)&&this.destroy(),this.core().ui().log("ui","Creating panel with id `"+this.id+"`"),this.on_create.call(this,e);let a=this.template.replace(/{ID}/g,e.id);if(void 0!==this.params_data&&void 0!==this.params_data.name&&"function"!=typeof this.params_data.name?(a=a.replace(/{BUILDING}/g,this.params_data.handle),!0===this.params_data.sidebar?($(".ui > aside").empty().append(a),$(".ui > .viewport").width($(window).width()-$(".ui > aside").width())):$(".ui").append(a),$(this.handle+" header").append(this.params_data.name)):$(".ui").append(a),this.on_show.call(this,e),this.on_refresh.call(this,e),void 0!==e.data){let a=this.core().get_settlement().get_building(e.data.handle);!1!==a&&(a.is_upgradable()||$(this.handle+" footer .upgrade").hide(),a.is_downgradable()||$(this.handle+" footer .downgrade").hide(),a.is_marketplace()&&$(this.handle+" footer .demolish").hide(),a.is_production_building()?a.is_stopped()?$(this.handle+" .start").removeClass("pause").attr("title","Start production"):$(this.handle+" .pause").removeClass("start").attr("title","Stop production"):$(this.handle+" .start, "+this.handle+" .pause").hide(),$(this.handle).on("click",".upgrade",(function(){return t.core().ui().open_modal((function(e){"yes"===e&&a.upgrade()&&(a.is_upgradable()?$(t.handle+" footer .downgrade").show():$(t.handle+" footer .upgrade").hide())}),"Are you sure you want to upgrade this building?"),!1})).on("click",".downgrade",(function(){return t.core().ui().open_modal((function(e){"yes"===e&&a.downgrade()&&(a.is_downgradable()?$(t.handle+" footer .upgrade").show():$(t.handle+" footer .downgrade").hide())}),"Are you sure you want to downgrade this building?"),!1})).on("click",".demolish",(function(){return t.core().ui().open_modal((function(e){"yes"===e&&a.demolish(!0)&&(t.destroy(),t.core().save_and_refresh())}),"Are you sure you want to demolish this building?"),!1})).on("click",".pause",(function(){return a.stop_production()&&($(this).removeClass("pause").addClass("start"),$(this).attr("title","Start production")),!1})).on("click",".start",(function(){return a.start_production()&&($(this).removeClass("start").addClass("pause"),$(this).attr("title","Stop production")),!1})))}return $(this.handle).on("click","header",(function(){$(".ui .panel").css({"z-index":99996}),$(t.handle).css({"z-index":99997})})).on("click",".close",(function(){return t.destroy(),!1})),(void 0===this.params_data||void 0!==this.params_data&&!0!==this.params_data.sidebar)&&$(this.handle).draggable({handle:"header",containment:"window",start(){$(this).css({height:"auto"})},stop(){$(this).css({height:"auto"})}}),$(this.handle+" .tabs").tabs(),$(this.handle).css({left:$(window).width()/2-$(this.handle).width()/2,top:$(window).height()/2-$(this.handle).height()/2}),$(".tipsy").remove(),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),this}core(){return this._core}}
/**
 * Main Game UI object.
 * 
 * @param {Object} core
 * @license GPL-3.0-or-later
 * @class ui
 * @returns {ui}
 */class ui{constructor(e){return this._core=e,this.panels=[],this.panel_class_names={academy:ui_panel_academy,barracks:ui_panel_barracks,church:ui_panel_church,embassy:ui_panel_embassy,shipyard:ui_panel_shipyard,tavern:ui_panel_tavern,army:ui_panel_army,building:ui_panel_building,buildings:ui_panel_buildings,campaign:ui_panel_campaign,council:ui_panel_council,debug:ui_panel_debug,help:ui_panel_help,new_army:ui_panel_new_army,new_caravan:ui_panel_new_caravan,new_scout:ui_panel_new_scout,new_spy:ui_panel_new_spy,place:ui_panel_place,ranks:ui_panel_ranks,settlement:ui_panel_settlement,storage:ui_panel_storage,trades:ui_panel_trades,world:ui_panel_world},this.window_class_names={options:ui_window_options,battle:ui_window_battle,signin:ui_window_signin,signup:ui_window_signup,error:ui_window_error},this}show_loader(){$(".loading").show().tipsy({gravity:"e"})}hide_loader(){$(".loading").hide()}build_main(){let e,t,a=!1;$("body").empty().append('<section class="ui"><header><div class="resource-panel"></div><div class="top-panel"></div></header><div class="character-info"><span class="avatar-banner"><span class="cityavatar"></span></span><span class="cityname"></span><small>Level <span class="citylevel"></span></small></div><aside></aside><div class="viewport"><section class="game"></section></div><footer><a href="#" data-action="panel" data-panel="buildings" class="tips" title="Buildings"></a><a href="#" data-action="panel" data-panel="storage" class="tips" title="Storage Space"></a><a href="#" data-action="panel" data-panel="trades" class="tips" title="Trades"></a><a href="#" data-action="panel" data-panel="council" class="tips" title="City Council"></a><a href="#" data-action="panel" data-panel="ranks" class="tips" title="Ranks"></a><a href="#" data-action="panel" data-panel="world" class="tips" title="World Map"></a><a href="#" data-action="panel" data-panel="debug" class="tips" title="Debug"></a><a href="#" data-action="panel" data-panel="help" class="tips" title="Help"></a></footer></section><audio id="music" loop><source src="music/track1.mp3" type="audio/mpeg"></audio><div title="Game is doing stuff in the background." class="loading"></div>');let s="",i="";for(let e in game.RESOURCES)!0===game.RESOURCES[e].toolbar&&(game.is_virtual_resource(e)?i+='<div class="resource '+e+'"><span class="amount">0</span><img title="'+game.RESOURCES[e].name+'" class="tips small" src="'+game.ASSETS_URL+"images/assets/resources/"+e+'.png" /></div>':s+='<div class="resource '+e+'"><span class="amount">0</span><img title="'+game.RESOURCES[e].name+'" class="tips small" src="'+game.ASSETS_URL+"images/assets/resources/"+e+'.png" /></div>');$(".resource-panel").append(s),$(".top-panel").append(i);return $(".game").on({mousemove(s){a&&function(a){$(".viewport").scrollTop($(".viewport").scrollTop()+(e-a.pageY)),$(".viewport").scrollLeft($(".viewport").scrollLeft()+(t-a.pageX)),e=a.pageY,t=a.pageX}(s)},mousedown(s){a=!0,e=s.pageY,t=s.pageX,$("html").css("cursor","grab")},mouseup(){a=!1,$("html").css("cursor","auto")}}),this}item_tooltip(e){let t='<h4 style="color: '+game.ITEM_QUALITY_COLORS[e.quality]+'">'+e.name+"</h4>";return e.flavour&&(t+='<span class="flavour">"'+e.flavour+'"</span> <br />'),t+="Slot: "+game.ITEM_SLOTS_LIST[e.slot]+" <br />",e.type===game.ITEM_TYPE_WEAPON?t+='Damage: <span class="red">'+e.stats.damageMin+"-"+e.stats.damageMax+"</span><br />Speed: "+e.stats.speed+"<br />":t+="Armor: "+e.stats.armor+"<br />",e.stats.strength&&(t+='Strength: <span class="green">+'+e.stats.strength+"</span><br />"),e.stats.stamina&&(t+='Stamina: <span class="green">+'+e.stats.stamina+"</span><br />"),e.stats.agility&&(t+='Agility: <span class="green">+'+e.stats.agility+"</span><br />"),e.stats.intellect&&(t+='Intellect: <span class="green">+'+e.stats.intellect+"</span><br />"),e.stats.spirit&&(t+='Spirit: <span class="green">+'+e.stats.spirit+"</span><br />"),t+='Type: <span style="color: '+game.ITEM_QUALITY_COLORS[e.quality]+'">'+game.ITEM_QUALITY_LIST[e.quality]+"</span>",t}static window_about_section(){return'<a href="#" class="do-about button button-blue">About</a><div class="about-game"><a class="github" target="_blank" href="https://github.com/sizeofcat/civitas"></a><p>Civitas is written by <a target="_blank" href="https://sizeof.cat">sizeof(cat)</a>.</p><p>Big thanks to:</p><ul><li><a target="_blank" href="https://soundcloud.com/shantifax">Shantifax</a> for the music (Glandula Pinealis).</li><li><a target="_blank" href="http://bluebyte.com">Blue Byte</a> for Anno 1404.</li></ul></div>'}static generic_panel_template(e){return void 0===e&&(e=""),'<div id="panel-{ID}" class="panel"><header>'+e+'<a class="tips close" title="Close"></a></header><section></section></div>'}static campaign_panel_template(e){return void 0===e&&(e=""),'<div id="panel-{ID}" class="panel"><header>'+e+'<a class="tips close" title="Close"></a></header><section></section><div class="toolbar"><a class="btn blue dispatch" href="#">Dispatch</a></div></div>'}static building_panel_template(e){return void 0===e&&(e=""),'<div id="panel-{ID}" class="panel"><header>'+e+'<a class="tips close" title="Close"></a></header><section></section><footer><a class="tips red-link demolish" title="Demolish this building" href="#"><span></span></a><a class="tips blue-link pause start" href="#"><span></span></a><a class="tips green-link upgrade" title="Upgrade building" href="#"><span></span></a><a class="tips red-link downgrade" title="Downgrade building" href="#"><span></span></a></footer></div>'}building_panel(e,t){void 0===e.levels&&(e.levels=1);let a=e.handle;"house"===e.handle.slice(0,5)&&(a=e.handle.slice(0,5));let s=void 0===e.visible_upgrades||!1===e.visible_upgrades?a:a+e.level;return'<div class="column preview-image"><img class="image" src="'+game.ASSETS_URL+"images/assets/buildings/"+s+'.png" /></div><div class="column"><p>'+e.description+"</p><dl>"+this.level_panel(e.level,t,e.levels)+this.cost_panel(e.cost,t,e.levels)+this.materials_panel(e.materials)+this.production_panel(e.production,t)+this.requires_panel(e.requires)+this.chance_panel(e.chance,t)+this.tax_panel(e.tax,t)+this.storage_panel(e.storage,t)+"</dl></div>"}normal_panel(e,t){return"<fieldset><legend>"+e+"</legend>"+t+"</fieldset>"}level_panel(e,t,a){return'<dt>Level</dt><dd><span title="Current building level" class="tips">'+t+'</span> / <span title="Maximum building level achievable through upgrades" class="tips">'+a+"</span></dd>"}cost_panel(e,t,a){let s="";if(void 0!==e){s+="<dt>Cost</dt>";for(let i in e)s+="<dd>"+game.nice_numbers(e[i])+this.resource_small_img(i)+(void 0!==a&&t<a?" / "+game.nice_numbers(e[i]*(t+1))+this.resource_small_img(i):"")+"</dd>"}return s}progress(e,t,a){void 0===t&&(t="small");let s="";return e<10?s=" ubad":e>=10&&e<30?s=" vbad":e>=30&&e<40?s=" bad":e>=40&&e<60?s=" good":e>=60&&e<90?s=" vgood":e>=90&&(s=" ugood"),'<div class="progress '+t+'"><div class="bar'+s+'" style="width:'+e+'%"><p>'+(void 0!==a?a:e)+"</p></div></div>"}navy_img(e){return'<img class="tips small" title="'+game.SHIPS[e].name+'" src="'+game.ASSETS_URL+"images/assets/navy/"+e.toLowerCase().replace(/ /g,"_")+'.png" />'}army_img(e){return'<img class="tips small" title="'+game.SOLDIERS[e].name+'" src="'+game.ASSETS_URL+"images/assets/army/"+e.toLowerCase().replace(/ /g,"_")+'.png" />'}heroes_list(e){return"<p>There are no heroes in this settlement.</p>"}army_list(e,t){let a="<dl"+(void 0!==t&&!0===t?' class="nomg"':"")+">",s=0;for(let t in e)e[t]>0&&(a+="<dt>"+e[t]+"</dt><dd>"+this.army_img(t)+"</dd>",s+=e[t]);return a+="<dt>"+s+"</dt><dd>Total</dd></dl>",s>0?a:"<p>There are no soldiers in this army.</p>"}navy_horizontal_list(e){let t="<p>This settlement has the following navy:</p>",a=0,s=0,i=0;for(let r in e)e[r]>0&&(t+='<span class="tips storage-item small" title="'+game.SHIPS[r].name+'"><img class="small" src="'+game.ASSETS_URL+"images/assets/navy/"+r.toLowerCase().replace(/ /g,"_")+'.png" /><span class="amount">'+e[r]+"</span></span>",a+=e[r],s+=game.SHIPS[r].attack*e[r],i+=game.SHIPS[r].defense*e[r]);return t+="<p>Total ships: "+a+'</p><p>Total attack: <span class="red">'+s+'</span></p><p>Total defense: <span class="blue">'+i+"</span></p>",a>0?t:"<p>There are no ships in this navy.</p>"}army_horizontal_list(e){let t="<p>This settlement has the following army:</p>",a=0,s=0,i=0;for(let r in e)e[r]>0&&(t+='<span class="tips storage-item small" title="'+game.SOLDIERS[r].name+'"><img class="small" src="'+game.ASSETS_URL+"images/assets/army/"+r.toLowerCase().replace(/ /g,"_")+'.png" /><span class="amount">'+e[r]+"</span></span>",i+=e[r],a+=game.SOLDIERS[r].attack*e[r],s+=game.SOLDIERS[r].defense*e[r]);return t+="<p>Total soldiers: "+i+'</p><p>Total attack: <span class="red">'+a+'</span></p><p>Total defense: <span class="blue">'+s+"</span></p>",i>0?t:"<p>There are no soldiers in this army.</p>"}window_exists(e){return 0!==$(e).length}panel_exists(e){return 0!==$(e).length}panel_btn(e,t,a,s,i){return'<a title="'+t+'" data-handle="'+a+'" class="tips '+s+(!0===i?" disabled":"")+'" href="#">'+e+"</a></td>"}trades_list(e,t){t=void 0===t||"imports"===t?"imports":"exports";let a="";if(null!==e){let s=e[t];for(let e in s)s[e]>0&&(a+=this.resource_storage_small_el(e,s[e]))}return a}navy_list(e,t){let a="<dl"+(void 0!==t&&!0===t?' class="nomg"':"")+">",s=0;for(let t in e)e[t]>0&&(a+="<dt>"+e[t]+"</dt><dd>"+this.navy_img(t)+"</dd>",s+=e[t]);return a+="<dt>"+s+"</dt><dd>Total</dd></dl>",s>0?a:"<p>There are no ships in this navy.</p>"}building_element(e){let t=e.type;"house"===e.type.slice(0,5)&&(t=e.type.slice(0,5));let a=void 0===e.data.visible_upgrades||!1===e.data.visible_upgrades?t:t+e.data.level;return'<div data-type="'+e.type+'" data-level="'+e.data.level+'" style="background-image:url('+game.ASSETS_URL+"images/assets/buildings/"+a+".png);left:"+e.data.position.x+"px;top:"+e.data.position.y+"px\" title='"+e.data.name+"' id=\"building-"+e.data.handle+'"class="tips building'+(!0===e.data.large?" large":"")+'"></div>'}resource_storage_small_el(e,t){return'<span class="tips storage-item small" title="'+game.get_resource_name(e)+'"><img class="small" src="'+game.ASSETS_URL+"images/assets/resources/"+e+'.png" /><span class="amount">'+t+"</span></span>"}resource_storage_el(e,t){return'<div class="storage-item" data-resource="'+e+'"><span class="title">'+game.get_resource_name(e)+'</span><img src="'+game.ASSETS_URL+"images/assets/resources/"+e+'.png" /><span class="amount">'+t+"</span></div>"}tabs(e){let t='<div class="tabs"><ul>';for(let a=0;a<e.length;a++)t+='<li><a href="#tab-'+e[a].toLowerCase().replace(/ /g,"-")+'">'+e[a].capitalize()+"</a></li>";t+="</ul>";for(let a=0;a<e.length;a++)t+='<div id="tab-'+e[a].toLowerCase().replace(/ /g,"-")+'"></div>';return t+="</div>",t}materials_panel(e){let t="";if(void 0!==e)if(t+="<dt>Uses</dt>",Array.isArray(e))for(let a=0;a<e.length;a++)for(let s in e[a])t+="<dd>"+e[a][s]+this.resource_small_img(s)+"</dd>";else for(let a in e)t+="<dd>"+e[a]+this.resource_small_img(a)+"</dd>";return t}chance_panel(e,t){let a="";if(void 0!==e){a+="<dt>Extra materials</dt>";for(let s in e)a+="<dd>"+100*(t*e[s]).toFixed(4)+"%"+this.resource_small_img(s)+"</dd>"}return a}production_panel(e,t){let a="";if(void 0!==e){a+="<dt>Produces</dt>";for(let s in e)a+="<dd>"+t*e[s]+this.resource_small_img(s)+"</dd>"}return a}requires_panel(e){let t="";if(void 0!==e.buildings||void 0!==e.settlement_level){if(t+="<dt>Requires</dt>",t+="<dd>",void 0!==e.buildings)for(let a in e.buildings){t+=this.core().get_building_config_data(a).name+" level "+e.buildings[a]+"<br />"}if(void 0!==e.research){t+="Research: "+game.TECHNOLOGIES[game.TECHNOLOGIES.findIndexByHandle(e.research)].name+"<br />"}void 0!==e.settlement_level&&(t+="Setlement: level "+e.settlement_level),t+="</dd>"}return t}tax_panel(e,t){let a="";return void 0!==e&&(a+="<dt>Tax</dt>",a+="<dd>"+t*e+this.resource_small_img("coins")+"</dd>"),a}storage_panel(e,t){let a="";return void 0!==e&&(a+="<dt>Storage</dt><dd>"+t*e+'<img alt="Storage space" class="tips small" title="Storage Space" src="'+game.ASSETS_URL+'images/assets/resources/storage.png" /></dd>'),a}resource_small_img(e){return'<img alt="'+game.get_resource_name(e)+'" class="tips small" title="'+game.get_resource_name(e)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+e+'.png" />'}core(){return this._core}notify(e,t,a,s){return this._notify({title:void 0!==t?t:"City Council",content:e,timeout:void 0!==a?a:15e3,mode:void 0!==s?s:game.NOTIFY_NORMAL}),this.log("game",e),this}_notify(e){let t,a,s,i,r,n,o,l,d="normal";if(l=(e=$.extend({title:null,content:null,timeout:15e3,img:null,mode:game.NOTIFY_NORMAL},e)).mode===game.NOTIFY_ACHIEVEMENT?"achievements-notifications":"notifications",t=$("."+l),t.length||(t=$("<div>",{class:l}).appendTo(document.body)),$(".achievements-notifications").css({left:$(window).width()/2-t.width()/2}),a=$("<div>"),a.addClass("notty"),s=$("<div>",{click(){$(this).parent().delay(300).queue((function(){$(this).clearQueue(),$(this).remove()}))},touchstart(){$(this).parent().delay(300).queue((function(){$(this).clearQueue(),$(this).remove()}))}}),s.addClass("hide"),e.mode===game.NOTIFY_ERROR?d="error":e.mode===game.NOTIFY_RESEARCH?d="research":e.mode===game.NOTIFY_EVENT?d="event":e.mode===game.NOTIFY_ACHIEVEMENT?d="achievement":e.mode===game.NOTIFY_RELIGION?d="religion":e.mode===game.NOTIFY_WAR&&(d="war"),a.addClass(d),e.img=game.ASSETS_URL+"images/assets/ui/icon_"+d+".png",i=$("<div>",{style:"background: url('"+e.img+"')"}),i.addClass("img"),n=$("<div class='left'>"),r=$("<div class='right'>"),o=$("<div>",{html:"<h2>"+e.title+"</h2>"+e.content}),o.addClass("inner"),o.appendTo(r),i.appendTo(n),n.appendTo(a),r.appendTo(a),s.appendTo(a),e.mode!==game.NOTIFY_ACHIEVEMENT){let e=Number(new Date),t=$("<div>",{html:game.time_since(e)+" ago"});t.addClass("time-ago").attr("title",e),t.appendTo(r),setInterval((function(){$(".time-ago").each((function(){let e=$(this).attr("title");e&&$(this).html(game.time_since(e)+" ago")}))}),4e3)}return a.hover((function(){s.show()}),(function(){s.hide()})),a.prependTo(t),a.show(),e.timeout&&setTimeout((function(){a.delay(300).queue((function(){$(this).clearQueue(),$(this).remove()}))}),e.timeout),this}error(e,t,a){return this._notify({title:void 0!==t?t:"City Council",mode:game.NOTIFY_ERROR,content:e}),void 0!==a&&!1!==a||this.log("game",e,!0),this}resize(){const e=parseInt($(window).width(),10),t=parseInt($(window).height(),10),a=parseInt($(".ui > header").height(),10),s=parseInt($(".ui > aside").width(),10),i=parseInt($(".ui > footer").width(),10);return $(".ui > footer").css({left:e/2-i/2}),$(".ui > aside").css({height:t-a}),$(".ui > .viewport").width(e-s),$(".ui > .viewport").height(t-a),this}log(e,t,a){return $("#panel-debug .console p").length>game.MAX_CONSOLE_LINES&&$("#panel-debug .console").empty(),$("#panel-debug .console").prepend('<p><span class="date">'+game.get_now()+'</span><span class="namespace game-'+e+'">'+e.toUpperCase()+"</span>"+(!0===a?'<span class="error">ERROR</span>':"")+"<span"+(!0===a?' class="error-message"':' class="log-message"')+">"+t+"</span></p>"),this}open_panel(e,t,a){let s={};s.core=this.core(),void 0!==t&&(s.data=t),void 0!==a&&(s.data.sidebar=a);const i=new this.panel_class_names[e](s);return this.panels.push(i),i}open_window(e,t){let a={};return a.core=this.core(),void 0!==t&&(a.data=t),new this.window_class_names[e](a)}open_modal(e,t,a){return new ui_modal({core:this.core()}).alert({title:void 0!==a?a:"City Council",text:t,on_click:e}),this}refresh_ui(){const e=this.core().get_settlement();return void 0!==e&&($(".citylevel").html(e.level()),e.fame()>=this.core().level_to_fame(e.level())&&this.core().level_up()),this}check_storage(){const e=this.core().get_settlement().storage();return e.occupied>=e.all?this.error("You ran out of storage space and all goods produced will be lost. Upgrade your warehouse or marketplace.","No storage space"):e.all-e.occupied<100&&this.error("You will soon run out of storage space and all goods produced will be lost. Upgrade your warehouse or marketplace.","Storage nearly full"),e}refresh(){return this.refresh_panels(),this.refresh_toolbar(),this.refresh_ui(),$(".tipsy").remove(),$(".tips").tipsy({gravity:$.fn.tipsy.autoNS,html:!0}),this}get_panels(){return this.panels}refresh_toolbar(){const e=this.core().get_settlement();let t;if(void 0!==e){const a=e.get_resources();for(let e in game.RESOURCES)!0===game.RESOURCES[e].toolbar&&(t=game.is_virtual_resource(e)?".top-panel":".resource-panel",void 0!==a[e]&&(0===a[e]?$(t+" .resource."+e).hide():$(t+" .resource."+e).show(),$(t+" .resource."+e+" span").html(a[e])))}return this}get_panel(e){const t=this.get_panels();for(let a=0;a<t.length;a++)if(void 0!==t[a]&&t[a].id===e)return t[a];return!1}close_panel(e){const t=this.get_panels();for(let a=0;a<t.length;a++)if(void 0!==t[a]&&t[a].id===e)return t.splice(a,1),!0;return!1}refresh_panels(){const e=this.get_panels();for(let t=0;t<e.length;t++)void 0!==e[t]&&e[t].on_refresh();return this}get_cell_middle(e,t){let a=Math.sqrt(3)/2*game.WORLD_HEX_SIZE;return{x:Math.round(game.WORLD_HEX_SIZE),y:Math.round(a)}}worldmap_scrollto(e){const t=this.get_cell_middle_coords(e.y,e.x);return $(".worldmap").scrollTop(t.y-350),$(".worldmap").scrollLeft(t.x-582),this}citymap_scrollto_building(e){const t=e.position,a=parseInt($(".ui > .viewport").width(),10),s=parseInt($(".ui > .viewport").height(),10);return $(".viewport").scrollTop(t.y-(s-260)/2),$(".viewport").scrollLeft(t.x-(a-260)/2),this}get_cell_middle_coords(e,t){const a=Math.sqrt(3)/2*game.WORLD_HEX_SIZE;return{x:Math.round(1.5*t*game.WORLD_HEX_SIZE),y:Math.round(a*(2*e+t%2))}}get_random_color(){return"hsl("+(250*Math.random()+1)*(360/(255*Math.random()))%360+", 50%, 50%)"}}
/**
 * Place panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_place
 * @extends ui_panel
 * @returns {ui_panel_place}
 */class ui_panel_place extends ui_panel{constructor(e){e.template='<div id="panel-{ID}" class="panel"><header>Ruins<a class="tips close" title="Close"></a></header><section></section><footer><a class="tips green-link scout" title="Send a scout to this place." href="#"><span></span></a><a class="tips green-link claim" title="Claim this place for your settlement." href="#"><span></span></a><a class="tips red-link unclaim" title="Remove your settlement`s claim of this place." href="#"><span></span></a><a class="tips blue-link caravan" title="Send a caravan to this place." href="#"><span></span></a></footer></div>',e.params_data=null,e.id="place",e.on_show=function(e){let t=this,a=this.core(),s=a.get_settlement(),i=s.location(),r=e.data;this.params_data=e;let n=["Info"];r.is_scouted()&&n.push("Resources","Construction"),$(this.handle+" section").append(a.ui().tabs(n));let o=r.is_claimed(),l=a.get_settlement(o);$(this.handle+" #tab-info").empty().append('<img class="avatar right" src="'+game.ASSETS_URL+'images/assets/avatars/avatar999.png" /><dl>'+(r.is_scouted()||!1!==o&&l.id()===s.id()?"<dt>Name</dt><dd>"+r.name()+"</dd><dt>Claimed by</dt><dd>"+(!1!==o?'<span data-id="'+l.id()+'" title="View info about this settlement" class="tips view">'+l.name()+"</span>":"nobody")+"</dd>":"")+"<dt>Scouted</dt><dd>"+(r.is_scouted()?"yes":"no")+"</dd><dt>Time to build</dt><dd>"+game.RUINS_TIME_TO_BUILD+" days</dd><dt>Distance</dt><dd>"+a.world().get_distance(i,r.location())+" miles ("+a.world().get_distance_in_days(i,r.location())+" days)</dd></dl>"),r.is_scouted()?($(this.handle+" #tab-resources").empty().append('<p>Stage 2: Gather the resources below and use caravans to send them to this place.</p><p><strong>Note!</strong> If the place is not claimed by anybody, do not send resources or they will be lost.</p><div class="required"><p>This place has no required resources.</p></div>'),$(this.handle+" #tab-construction").empty().append('<p>Stage 3: Once the required resources have been stored you can start building the world wonder on this place. It will take a dozen of years to build it (around 20) and other settlements might attack so make sure you have an army to guard it.</p><div class="toolbar"></div>'),!1!==o&&o===s.id()?($(this.handle+" footer .unclaim").css("display","inline-block"),$(this.handle+" footer .caravan").css("display","inline-block")):!1===o&&$(this.handle+" footer .claim").css("display","inline-block")):$(this.handle+" footer .scout").css("display","inline-block"),$(this.handle).on("click",".claim",(function(){return s.can_diplomacy()&&s.can_research()?!1!==r.is_claimed()?(a.ui().error("This place has been claimed by another settlement."),!1):(a.ui().open_modal((function(e){if("yes"===e){if(!r.claim(s))return a.ui().error("There was an error claiming this world place, check the data you entered and try again."),!1;a.ui().notify("A place in the world has been claimed by your settlement."),a.save_and_refresh(),t.destroy()}}),"Are you sure you want to claim this world place?"),!1):(a.ui().error("You will need to construct an Embassy and Academy before being able to claim world places."),!1)})).on("click",".unclaim",(function(){return s.can_diplomacy()&&s.can_research()?!1===r.is_claimed()?(a.ui().error("This place is not claimed by your settlement."),!1):(a.ui().open_modal((function(e){if("yes"===e){if(!r.unclaim(s))return a.ui().error("There was an error unclaiming this world place, check the data you entered and try again."),!1;a.ui().notify("A place in the world has been unclaimed by your settlement."),a.save_and_refresh(),t.destroy()}}),"Are you sure you want to unclaim this world place?"),!1):(a.ui().error("You will need to construct an Embassy and Academy before being able to unclaim world places."),!1)})).on("click",".caravan",(function(){return s.can_trade()?(a.ui().open_panel("new_caravan",r),!1):(a.ui().error("You will need to construct a Trading Post before being able to send caravans to other places."),!1)})).on("click",".construct",(function(){return!1})).on("click",".view",(function(){let e=parseInt($(this).data("id"),10),t=a.get_settlement(e);return t&&(t.id()===s.id()?a.ui().open_panel("council"):a.ui().open_panel("settlement",t)),!1})).on("click",".scout",(function(){return s.can_diplomacy()?(a.ui().open_panel("new_scout",r),!1):(a.ui().error("You will need to construct an Embassy before being able to send scouts to other places."),!1)}))},e.on_refresh=function(){let e=this.core(),t=this.params_data.data,a=0,s=0,i=0,r=t.get_resources();if(t.is_scouted()){let n="",o=t.ruins().resources;for(let t in o)game.is_virtual_resource(t)||o[t]>0&&(a=void 0!==r[t]?r[t]:0,s=o[t]-a,s>0&&(n+=e.ui().resource_storage_small_el(t,s),i+=s));""!==n&&$(this.handle+" #tab-resources .required").empty().append(n),i<=0&&$(this.handle+" #tab-construction .toolbar").empty().append('<a class="btn blue construct">Start Construction</a>')}},super(e)}}
/**
 * Settlement panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_settlement
 * @extends ui_panel
 * @returns {ui_panel_settlement}
 */class ui_panel_settlement extends ui_panel{constructor(e){e.template='<div id="panel-{ID}" class="panel"><header><a class="tips close" title="Close"></a></header><section></section><footer><a class="tips red-link attack" title="Attack this settlement." href="#"><span></span></a><a class="tips blue-link caravan" title="Send a caravan to this settlement." href="#"><span></span></a><a class="tips red-link spy" title="Send a spy to this settlement." href="#"><span></span></a><a class="tips green-link alliance" title="Propose an alliance to this settlement." href="#"><span></span></a><a class="tips green-link pact" title="Propose a pact to this settlement." href="#"><span></span></a><a class="tips blue-link ceasefire" title="Propose a cease fire to this settlement." href="#"><span></span></a><a class="tips green-link join" title="Ask this settlement to join your city." href="#"><span></span></a><a class="tips red-link war" title="Declare war to this settlement." href="#"><span></span></a></footer></div>',e.params_data=null,e.id="settlement",e.on_show=function(e){let t=this.core(),a=t.get_settlement(),s=e.data;this.params_data=e,$(this.handle+" header").append(s.name());let i=[];s.is_urban()?(i.push("Info"),a.can_diplomacy()&&(i.push("Army"),!0===s.waterside()&&i.push("Navy")),i.push("Heroes","Resources","Imports","Exports")):(i.push("Info"),(a.can_diplomacy()||s.is_camp())&&(i.push("Army"),!0===s.waterside()&&i.push("Navy")),i.push("Resources")),$(this.handle+" section").append(t.ui().tabs(i)),$(this.handle).on("click",".alliance",(function(){return a.can_diplomacy()?(t.ui().open_modal((function(e){if("yes"===e){if(!t.queue_add(a,s,game.ACTION_DIPLOMACY,game.DIPLOMACY_PROPOSE_ALLIANCE,{}))return t.ui().error("There was an error proposing an alliance to this settlement, check the data you entered and try again."),!1;t.do_achievement("pacifist")}}),"Are you sure you want to propose an alliance to this settlement?"),!1):(t.ui().error("You will need to construct an Embassy before being able to propose an alliance to other settlements."),!1)})).on("click",".join",(function(){return a.can_diplomacy()?(t.ui().open_modal((function(e){if("yes"===e){if(!t.queue_add(a,s,game.ACTION_DIPLOMACY,game.DIPLOMACY_PROPOSE_JOIN,{}))return t.ui().error("There was an error proposing this settlement to join your city, check the data you entered and try again."),!1;t.do_achievement("rulethemall")}}),"Are you sure you want to propose this this settlement to join you?"),!1):(t.ui().error("You will need to construct an Embassy before being able to ask other settlements to join your city."),!1)})).on("click",".pact",(function(){return a.can_diplomacy()?(t.ui().open_modal((function(e){if("yes"===e){if(!t.queue_add(a,s,game.ACTION_DIPLOMACY,game.DIPLOMACY_PROPOSE_PACT,{}))return t.ui().error("There was an error proposing a pact to this settlement, check the data you entered and try again."),!1;t.do_achievement("friendly")}}),"Are you sure you want to propose a pact to this settlement?"),!1):(t.ui().error("You will need to construct an Embassy before being able to propose a pact to other settlements."),!1)})).on("click",".ceasefire",(function(){return a.can_diplomacy()?(t.ui().open_modal((function(e){if("yes"===e&&!t.queue_add(a,s,game.ACTION_DIPLOMACY,game.DIPLOMACY_PROPOSE_CEASE_FIRE,{}))return t.ui().error("There was an error proposing a cease fire to this settlement, check the data you entered and try again."),!1}),"Are you sure you want to propose a cease fire to this settlement?"),!1):(t.ui().error("You will need to construct an Embassy before being able to propose a cease fire to other settlements."),!1)})).on("click",".war",(function(){return a.can_diplomacy()?(t.ui().open_modal((function(e){"yes"===e&&a.diplomacy(s.id(),game.DIPLOMACY_WAR)}),"Are you sure you want to declare war to this settlement?<br /><br />You will lose all influence over "+s.name()+" and the settlement might retaliate back!"),!1):(t.ui().error("You will need to construct an Embassy before being able to declare war to other settlements."),!1)})).on("click",".caravan",(function(){return a.can_trade()?(t.ui().open_panel("new_caravan",s),!1):(t.ui().error("You will need to construct a Trading Post before being able to trade resources with other settlements."),!1)})).on("click",".spy",(function(){return a.can_diplomacy()?(t.ui().open_panel("new_spy",s),!1):(t.ui().error("You will need to construct an Embassy before being able to send spies to other settlements."),!1)})).on("click",".attack",(function(){return a.can_recruit_soldiers()?(t.ui().open_panel("new_army",s),!1):(t.ui().error("You will need to construct a Military Camp before being able to attack other settlements."),!1)}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=this.params_data.data,s=a.get_trades(),i=t.get_diplomacy_status(a.id()),r="",n=t.location();a.is_city()?r="City":a.is_metropolis()?r="Metropolis":a.is_village()?r="Village":a.is_camp()?r="Raider Camp":a.is_ruins()&&(r="Ruins"),$(this.handle+" #tab-info").empty().append('<img class="avatar right" src="'+game.ASSETS_URL+"images/assets/avatars/avatar"+a.ruler().avatar+'.png" /><dl><dt>'+a.ruler().title+"</dt><dd>"+a.ruler().name+"</dd><dt>Settlement Type</dt><dd>"+r+"</dd><dt>Climate</dt><dd>"+a.climate().name+"</dd>"+(t.can_diplomacy()?"<dt>Personality</dt><dd>"+a.personality().name+"</dd>":"")+"<dt>Nationality</dt><dd>"+a.nationality().name+"</dd>"+(t.can_diplomacy()&&a.is_urban()?"<dt>Level</dt><dd>"+a.level()+"</dd><dt>Prestige</dt><dd>"+e.ui().progress(100*a.prestige()/game.MAX_PRESTIGE_VALUE,"small",a.prestige())+"</dd>":"")+"<dt>Population</dt><dd>"+game.nice_numbers(a.population())+"</dd>"+(t.can_diplomacy()?"<dt>Coins</dt><dd>"+game.nice_numbers(a.coins())+"</dd><dt>Religion</dt><dd>"+a.religion().name+"</dd><dt>Influence</dt><dd>"+e.ui().progress(t.get_influence_with_settlement(a.id()),"small")+"</dd><dt>Diplomatic Status</dt><dd>"+t.get_diplomacy_status(a.id()).name+"</dd>":"")+"<dt>Distance</dt><dd>"+e.world().get_distance(n,a.location())+" miles ("+e.world().get_distance_in_days(n,a.location())+" days)</dd></dl>"),(t.can_diplomacy()||a.is_camp())&&($(this.handle+" #tab-army").empty().append(e.ui().army_horizontal_list(a.army())),!0===a.waterside()&&$(this.handle+" #tab-navy").empty().append(e.ui().navy_horizontal_list(a.navy()))),a.is_urban()&&($(this.handle+" #tab-heroes").empty().append("<p>Below are the heroes of this settlement.</p>"+e.ui().heroes_list(a.heroes())),$(this.handle+" #tab-imports").empty().append("<p>Below are the goods this settlement will be buying this year.</p>"+e.ui().trades_list(s,"imports")),$(this.handle+" #tab-exports").empty().append("<p>Below are the goods this settlement will be selling this year.</p>"+e.ui().trades_list(s,"exports")));let o="",l="<p>This settlement has the the following resources:</p>";for(let t in a.get_resources())game.is_virtual_resource(t)||a.resources[t]>0&&(o+=e.ui().resource_storage_small_el(t,a.resources[t]));""!==o?l+=o:l="<p>This settlement has no resources.</p>",$(this.handle+" #tab-resources").empty().append(l),i.id===game.DIPLOMACY_VASSAL?$(this.handle+" footer .attack").css("display","none"):$(this.handle+" footer .attack").css("display","inline-block"),t.can_diplomacy()&&(a.is_camp()?$(this.handle+" footer .caravan, "+this.handle+" footer .spy").hide():$(this.handle+" footer .caravan, "+this.handle+" footer .spy").css("display","inline-block"),i.id===game.DIPLOMACY_PACT&&a.is_urban()?$(this.handle+" footer .alliance").css("display","inline-block"):a.is_camp()||$(this.handle+" footer .alliance").css("display","none"),i.id!==game.DIPLOMACY_TRUCE&&i.id!==game.DIPLOMACY_CEASE_FIRE||a.is_camp()?$(this.handle+" footer .pact").css("display","none"):$(this.handle+" footer .pact").css("display","inline-block"),i.id!==game.DIPLOMACY_WAR||a.is_camp()?$(this.handle+" footer .ceasefire").css("display","none"):$(this.handle+" footer .ceasefire").css("display","inline-block"),i.id===game.DIPLOMACY_WAR||i.id===game.DIPLOMACY_VASSAL||a.is_camp()?$(this.handle+" footer .war").css("display","none"):$(this.handle+" footer .war").css("display","inline-block"),i.id===game.DIPLOMACY_PACT&&a.is_village()&&!a.is_camp()?$(this.handle+" footer .join").css("display","inline-block"):$(this.handle+" footer .join").css("display","none"))},super(e)}}
/**
 * Help panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_help
 * @extends ui_panel
 * @returns {ui_panel_help}
 */class ui_panel_help extends ui_panel{constructor(e){e.id="help",e.template=ui.generic_panel_template("Help"),e.on_show=function(e){let t=this.core();$(this.handle+" section").append(t.ui().tabs(["About","Buildings","Settlements","Religion","Research"])),$(this.handle+" #tab-buildings").empty().append('<fieldset><legend>Table of Contents</legend><ul><li><a href="#">Intro</a></li><li><a href="#">Build</a></li><li><a href="#">Upgrade</a></li><li><a href="#">Demolish</a></li><li><a href="#">Production</a></li><li><a href="#">Housing</a></li><li><a href="#">Municipal</a></li><li><a href="#">Storage</a></li><li><a href="#">Coins</a></li></ul></fieldset><h3>Intro</h3><p>In Civitas, buildings are the backbone of your city, providing you with goods for export.</p><h3>Build</h3><p>Each building has some special requirements to build, whether a required city level or another existing building.</p><h3>Upgrade</h3><p>Upgrading one of your buildings has several benefits, besides the obvious estetic one.</p><img title="Level 1 house" class="help tips" src="'+game.ASSETS_URL+'images/assets/buildings/house1.png" /> <img title="Level 3 house" class="help tips" src="'+game.ASSETS_URL+'images/assets/buildings/house3.png" /> <img title="Maximum level house" class="help tips" src="'+game.ASSETS_URL+'images/assets/buildings/house5.png" /><p>Upgrading a building costs the initial building price multiplied by the level. So, if a building initially costs 100 '+t.ui().resource_small_img("coins")+" and 20 "+t.ui().resource_small_img("wood")+" to construct, upgrading it to level 2 will cost 200 "+t.ui().resource_small_img("coins")+" and 40 "+t.ui().resource_small_img("wood")+', so on.</p><p>When a building is upgraded, it produces the inital amount of goods multiplied by the level of the building. Keep in mind that the materials it uses for production are the same as for a building of level 1, so upgrading a building is an easy way of getting double (or triple) the production goods for the same materials as the previous level used.</p><h3>Demolish</h3><p>Demolishing a building has no actual benefits except it no longer used the production materials (a better way to adjust that will be to stop the production of the specific building, this way you can restart it when you want). Demolishing a building refunds 100% of the inial cost of the build, except eventual upgrades.</p><h3>Production</h3><p></p><h3>Housing</h3><p></p><h3>Municipal</h3><p></p><h3>Storage</h3><p>The goods you`re producing need a storage place inside your city, the initial Marketplace provides some storage space (100k <img class="small" src="'+game.ASSETS_URL+'images/assets/resources/storage.png" /> ), and it can be increased even further with upgrading, but you will need to build Warehouses to store all the goods. If you have no free storage space, the produced goods will be lost.</p><h3>Coins</h3><p>Your city can only gain coins through trades and taxes.</p>'),$(this.handle+" #tab-religion").empty().append("<h2>Religion</h2>"),$(this.handle+" #tab-settlements").empty().append('<fieldset><legend>Table of Contents</legend><ul><li><a href="#">Intro</a></li><li><a href="#">Cities and villages</a></li><li><a href="#">Diplomacy</a></li><li><a href="#">Fame and levels</a></li><li><a href="#">Influence</a></li><li><a href="#">Espionage</a></li><li><a href="#">Prestige</a></li><li><a href="#">Pacts and alliances</a></li><li><a href="#">Wars</a></li><li><a href="#">Caravans</a></li></ul></fieldset><h3>Intro</h3><p></p><h3>Cities and villages</h3><p></p><h3>Diplomacy</h3><p></p><h3>Fame and levels</h3><p>Each time you reach a specific fame level, your city gets a new level, thus you never lose your initial fame. There are several ways of getting extra fame (besides your initial Marketplace), there are several municipal buildings that add a small amount of fame to your city each day (this amount can be increased by upgrading the buildings).</p><p>There is no fixed way in which you can lose fame, except the random events that occur from time to time, or if another city manages to incite your population to revolt.</p><h3>Influence</h3><p>All settlements in the game world have an influence rating with each of the other settlements. The influence drops over time (yearly) and needs to be kept above a certain level, else the other cities might attack your city.</p><p>Maximum influence a settlement can have is <strong>'+game.MAX_INFLUENCE_VALUE+"</strong>.</p><h3>Espionage</h3><p>After building your city Embassy, you can start assigning spies to other settlements using your accumulated espionage points. Depending on the amount of espionage you use for a spy mission, that mission has a rate of success. The most points you can assign are <strong>"+game.MAX_ESPIONAGE_VALUE+"</strong> "+t.ui().resource_small_img("espionage")+" (maximum espionage points a city can get) and this gives you approximately a <strong>"+game.MAX_ESPIONAGE_VALUE/game.MAX_ESPIONAGE_SUCESS_RATE+"%</strong> success rate.</p><h3>Prestige</h3><p>Prestige is a very important feature of your city because it influences the way other settlements see you and they will act upon that information. Low prestige might be good for your city if you plan to lay low and prepare (the other settlements won`t bother to go to war with a city with low prestige unless you manage somehow to piss them off) but usually, your city prestige should raise with the city level.</p><p>Prestige is gained through trading with other settlements, sending caravans with resources to help them when in need, etc. Random events can also affect your city prestige. The maximum prestige a settlement can get is <strong>"+game.MAX_PRESTIGE_VALUE+"</strong> "+t.ui().resource_small_img("prestige")+".</p><h3>Pacts and alliances</h3><p></p><h3>Wars</h3><p></p><h3>Caravans</h3><p></p>"),$(this.handle+" #tab-about").empty().append('<h2>About Civitas</h2><p>Civitas is an empire-building game written in Javascript with the help of the <a target="_blank" href="https://jquery.com">jQuery</a> library. All the development is done over <a target="_blank" href="https://github.com/sizeofcat/civitas">GitHub</a> and everybody can contribute.</p><p>Civitas is written by <a target="_blank" href="https://sizeof.cat">sizeof(cat)</a>, is free and distributed under the <a target="_blank" href="https://raw.githubusercontent.com/sizeofcat/civitas/master/LICENSE">GPLv3 license</a>.</p><p>Big thanks to:</p><ul><li><a target="_blank" href="https://soundcloud.com/shantifax">Shantifax</a> for the music (Glandula Pinealis).</li><li><a target="_blank" href="http://bluebyte.com">Blue Byte</a> for Anno 1404.</li></ul>'),$(this.handle+" #tab-research").empty().append("<h2>Research</h2>"),$(this.handle+" #tab-diplomacy").empty().append("<h2>Diplomacy</h2>")},super(e)}}
/**
 * Debug panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_debug
 * @extends ui_panel
 * @returns {ui_panel_debug}
 */class ui_panel_debug extends ui_panel{constructor(e){e.id="debug",e.template=ui.generic_panel_template("Debugging"),e.on_show=function(e){let t=this.core(),a=t.get_settlement(),s=this.handle;$(this.handle+" section").append(t.ui().tabs(["Data","Console","Cheats"])),$(this.handle+" #tab-console").empty().append('<div class="console"></div>'),$(this.handle+" #tab-cheats").empty().append('<div class="toolbar"><a href="#" class="btn gray one">+1M coins</a><a href="#" class="btn two">+1000 cons. mats</a><a href="#" class="btn thirty">+1000 food / wine</a><a href="#" class="btn fifteen">+1000 prov./spyg.</a><br /><br /><a href="#" class="btn green five">level up</a><a href="#" class="btn fourteen">+900 faith/research/espionage</a><a href="#" class="btn six">+1000 fame</a><br /><br /><a href="#" class="btn eleven">random soldiers</a><a href="#" class="btn twelve">random ships</a><a href="#" class="btn fourty">defend city</a><a href="#" class="btn blue fifty">battle-ready</a><br /><br /><a href="#" class="btn ninety">add city</a><a href="#" class="btn seven">refresh trades</a></div>'),$(this.handle+" #tab-data").empty().append('<textarea class="storage-data"></textarea><div class="toolbar"><a href="#" class="btn iblock refresh">Refresh</a> <a href="#" class="btn iblock load">Load</a> <a href="#" class="btn iblock save">Save</a> </div>'),$(this.handle).on("click",".fourty",(function(){let e=game.get_random(1,t.get_num_settlements()-1),s=t.get_settlement(e);return t.queue_add(s,a,game.ACTION_CAMPAIGN,game.CAMPAIGN_ARMY,{army:{militia:40,axeman:30,knight:10,bowman:20,cannon:200,catapult:300,crossbowman:10,pikeman:30}}),!1})).on("click",".fifty",(function(){for(let e=0;e<9;e++)t.level_up();a.add_to_storage("wood",1e3),a.add_to_storage("stones",1e3),a.add_to_storage("woodplanks",1e3),a.add_to_storage("provisions",1e3),a.add_to_storage("ropes",50),a.add_to_storage("barrels",50),a.add_to_storage("tools",100),a.inc_coins(2e6);let e=a.army();for(let t in e)e[t]=game.get_random(1,100);return a.build("provisions"),a.build("barracks"),a.build("shipyard"),t.save_and_refresh(),!1})).on("click",".eleven",(function(){let e=a.army();for(let t in e)e[t]=game.get_random(1,100);return t.save_and_refresh(),!1})).on("click",".twelve",(function(){let e=a.navy();for(let t in e)e[t]=game.get_random(1,10);return t.save_and_refresh(),!1})).on("click",".fourteen",(function(){return a.raise_faith(900),a.raise_espionage(900),a.raise_research(900),a.raise_prestige(900),t.save_and_refresh(),!1})).on("click",".one",(function(){return a.inc_coins(1e6),t.save_and_refresh(),!1})).on("click",".fifteen",(function(){return a.add_to_storage("provisions",1e3),a.add_to_storage("donkeys",1e3),a.add_to_storage("ropes",1e3),a.add_to_storage("spyglasses",1e3),t.save_and_refresh(),!1})).on("click",".two",(function(){return a.add_to_storage("wood",1e3),a.add_to_storage("stones",1e3),a.add_to_storage("woodplanks",1e3),a.add_to_storage("clay",1e3),a.add_to_storage("bricks",1e3),a.add_to_storage("tools",500),t.save_and_refresh(),!1})).on("click",".thirty",(function(){return a.add_to_storage("bread",1e3),a.add_to_storage("meat",1e3),a.add_to_storage("wine",1e3),t.save_and_refresh(),!1})).on("click",".five",(function(){return t.level_up(),t.save_and_refresh(),!1})).on("click",".six",(function(){return a.raise_fame(1e3),t.save_and_refresh(),!1})).on("click",".seven",(function(){return t.refresh_trades(),t.save_and_refresh(),!1})).on("click",".refresh",(function(){return $(s+" .storage-data").val(t.get_storage_data("live",!0)),!1})).on("click",".ninety",(function(){return t.add_random_settlement(),!1})).on("click",".load",(function(){let e=$(s+" .storage-data").val();return""!==e?t.ui().open_modal((function(a){"yes"===a&&(t.set_storage_data("live",e,!0),document.location.reload())}),"Are you sure you want to load a new game? You will lose all progress on the current game!","Civitas"):t.ui().error("Invalid save game."),!1})).on("click",".save",(function(){let e=$(s+" .storage-data").val();""===e&&(e=t.get_storage_data("live",!0));let a=document.createElement("a");return a.style.display="none",document.body.appendChild(a),a.href=window.URL.createObjectURL(new Blob([e],{type:"text/plain"})),a.setAttribute("download","civitas_savegame.json"),a.click(),window.URL.revokeObjectURL(a.href),document.body.removeChild(a),!1}))},super(e)}}
/**
 * Building panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_building
 * @extends ui_panel
 * @returns {ui_panel_building}
 */class ui_panel_building extends ui_panel{constructor(e){e.id="building",e.template=ui.building_panel_template(),e.on_refresh=function(){let e=this.core(),t=e.get_settlement().get_building(this.params_data.handle);t?$(this.handle+" section").empty().append(e.ui().building_panel(this.params_data,t.level)):this.destroy()},super(e)}}
/**
 * Campaign panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_campaign
 * @extends ui_panel
 * @returns {ui_panel_campaign}
 */class ui_panel_campaign extends ui_panel{constructor(e){e.params_data=null,e.id="campaign",e.template=ui.generic_panel_template("Campaign"),e.on_show=function(e){let t=this.core(),a=t.get_settlement(),s=e.data,i="",r=["Info"];this.params_data=e,s.type===game.CAMPAIGN_ARMY||s.type===game.CAMPAIGN_ARMY_RETURN?i="army":s.type===game.CAMPAIGN_CARAVAN?i="caravan":s.type===game.CAMPAIGN_SPY&&(i="spy"),$(this.handle+" header").append(" - "+i.capitalize()+" mission"),s.type===game.CAMPAIGN_ARMY?(a.num_soldiers(s.data.army)>0&&r.push("Soldiers"),a.num_ships(s.data.navy)>0&&r.push("Ships")):s.type===game.CAMPAIGN_CARAVAN?r.push("Resources"):s.type===game.CAMPAIGN_SPY?r.push("Spy"):s.type===game.CAMPAIGN_ARMY_RETURN&&(a.num_soldiers(s.data.army)>0&&r.push("Soldiers"),a.num_ships(s.data.navy)>0&&r.push("Ships"),r.push("Resources")),$(this.handle+" section").append(t.ui().tabs(r))},e.on_refresh=function(){let e,t=this.core(),a=t.get_settlement(),s=this.params_data.data,i="",r=t.get_settlement(s.source.id),n=t.get_settlement(s.destination.id),o=t.world().get_distance(s.source,s.destination),l="";if(s.type===game.CAMPAIGN_ARMY?(e="Army",l="Attacking"):s.type===game.CAMPAIGN_ARMY_RETURN?(e="Army",l="Returning"):s.type===game.CAMPAIGN_SPY?(e="Spy",l="Sneaking in"):s.type===game.CAMPAIGN_SCOUT?(e="Scout",l="Scouting"):s.type===game.CAMPAIGN_CARAVAN?(e="Caravan",l="Going to"):(e="Misc",l="Going to"),$(this.handle+" #tab-info").empty().append('<img class="avatar right" src="'+game.ASSETS_URL+"images/assets/avatars/avatar"+(s.type===game.CAMPAIGN_ARMY_RETURN?n.ruler().avatar:r.ruler().avatar)+'.png" /><dl><dt>Type</dt><dd>'+e+"</dd><dt>Sent By</dt><dd>"+(s.type===game.CAMPAIGN_ARMY_RETURN?n.name():r.name())+"</dd><dt>Destination</dt><dd>"+(s.type===game.CAMPAIGN_ARMY_RETURN?r.name():n.name())+"</dd><dt>Action</dt><dd>"+l+"</dd><dt>Distance</dt><dd>"+o+" miles ("+s.duration+" days)</dd><dt>Remaining</dt><dd>"+10*(s.duration-s.passed)+" miles ("+(s.duration-s.passed)+" days)</dd></dl>"),s.type===game.CAMPAIGN_ARMY)a.num_soldiers(s.data.army)>0&&$(this.handle+" #tab-soldiers").empty().append(t.ui().army_list(s.data.army)),a.num_ships(s.data.navy)>0&&$(this.handle+" #tab-ships").empty().append(t.ui().navy_list(s.data.navy));else if(s.type===game.CAMPAIGN_CARAVAN){if(void 0===s.data.resources||$.isEmptyObject(s.data.resources))i="<p>This is an empty caravan with no resources.</p>";else{i="<p>This caravan has the the following resources:</p><dl>";for(let e in s.data.resources)s.data.resources[e]>0&&(i+="<dt>"+s.data.resources[e]+"</dt><dd>"+t.ui().resource_small_img(e)+"</dd>");i+="</dl>"}$(this.handle+" #tab-resources").empty().append(i)}else if(s.type===game.CAMPAIGN_SPY)i="<dl><dt>Mission</dt><dd>"+game.SPY_MISSIONS[s.data.mission].capitalize()+"</dd>"+(s.data.mission===game.SPY_MISSION_RELIGION?"<dt>Religion</dt><dd>"+game.RELIGIONS[s.data.religion].capitalize()+"</dd>":"")+"<dt>Espionage</dt><dd>"+s.data.espionage+" "+t.ui().resource_small_img("espionage")+"</dd><dt>Success chance</dt><dd>"+Math.ceil(s.data.espionage/100)+"%</dd></dl>",$(this.handle+" #tab-spy").empty().append(i);else if(s.type===game.CAMPAIGN_ARMY_RETURN){if(a.num_soldiers(s.data.army)>0&&$(this.handle+" #tab-soldiers").empty().append(t.ui().army_list(s.data.army)),a.num_ships(s.data.navy)>0&&$(this.handle+" #tab-ships").empty().append(t.ui().navy_list(s.data.navy)),void 0===s.data.resources||$.isEmptyObject(s.data.resources))i="<p>This army is returning with no spoils of war.</p>";else{i="<p>This army is bringing back to its home city the following spoils of war:</p><dl>";for(let e in s.data.resources)s.data.resources[e]>0&&(i+="<dt>"+s.data.resources[e]+"</dt><dd>"+t.ui().resource_small_img(e)+"</dd>");i+="</dl>"}$(this.handle+" #tab-resources").empty().append(i)}},super(e)}}
/**
 * Storage panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_storage
 * @extends ui_panel
 * @returns {ui_panel_storage}
 */class ui_panel_storage extends ui_panel{constructor(e){e.id="storage",e.template=ui.generic_panel_template("City Storage"),e.on_show=function(e){let t=this.core(),a=t.get_settlement(),s=a.storage(),i=a.get_resources();$(this.handle+" section").append(t.ui().tabs(game.RESOURCE_CATEGORIES)),$(this.handle+" section").append('<p>Total storage space: <span class="total-storage">'+s.all+'</span>, used: <span class="used-storage">'+s.occupied+"</span></p>");for(let e=0;e<game.RESOURCE_CATEGORIES.length;e++)$(this.handle+" #tab-"+game.RESOURCE_CATEGORIES[e]).append('<div class="storage-board"></div>');for(let e in i)game.is_virtual_resource(e)||$(this.handle+" #tab-"+game.RESOURCES[e].category+" .storage-board").append(t.ui().resource_storage_el(e,i[e]))},e.on_refresh=function(){let e=this.core().get_settlement(),t=e.get_resources(),a=e.storage();for(let e in t)game.is_virtual_resource(e)||$(this.handle+" #tab-"+game.RESOURCES[e].category+' .storage-board > .storage-item[data-resource="'+e+'"] > .amount').empty().html(t[e]);$(this.handle+" .total-storage").empty().append(a.all),$(this.handle+" .used-storage").empty().append(a.occupied)},super(e)}}
/**
 * World panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_world
 * @extends ui_panel
 * @returns {ui_panel_world}
 */class ui_panel_world extends ui_panel{constructor(e){e.id="world",e.template=ui.generic_panel_template("World Map"),e.on_show=function(e){let t=this.core(),a=t.get_settlement();$(this.handle+" section").append('<div class="worldmap"></div>'),t.world().draw();let s,i,r=!1;$(".worldmap").on({mousemove(e){r&&function(e){$(".worldmap").scrollTop($(".worldmap").scrollTop()+(s-e.pageY)),$(".worldmap").scrollLeft($(".worldmap").scrollLeft()+(i-e.pageX)),s=e.pageY,i=e.pageX}(e)},mousedown(e){r=!0,s=e.pageY,i=e.pageX,$("html").css("cursor","grab")},mouseup(){r=!1,$("html").css("cursor","auto")}}),$(this.handle).on("click",".settlement",(function(){let e=$(this).data("name");return e===a.name()?t.ui().open_panel("council"):t.ui().open_panel("settlement",t.get_settlement(e)),!1})).on("click",".ruins",(function(){let e=parseInt($(this).data("id"),10);return t.ui().open_panel("place",t.get_settlement(e)),!1})).on("click",".troop",(function(){let e=parseInt($(this).data("id"),10);return t._queue[e].mode!==game.ACTION_CAMPAIGN&&t._queue[e].mode!==game.ACTION_DIPLOMACY||t.ui().open_panel("campaign",t._queue[e]),!1})).on("click",".canvas-map",(function(){return!1})),t.ui().worldmap_scrollto(a.location())},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=e.get_settlements(),s=(e.world(),e.queue());$(".troop, .settlement, .ruins").remove();for(let s=0;s<a.length;s++){let i="village",r="settlement",n=a[s].name(),o=a[s].location(),l=e.ui().get_cell_middle_coords(o.y,o.x),d=a[s].nice_name();void 0!==t&&n===t.name()?i="settlement":a[s].is_metropolis()?i="metropolis"+a[s].icon():a[s].is_city()?i="city"+a[s].icon():a[s].is_village()?i="village"+a[s].icon():a[s].is_camp()?i="camp":a[s].is_ruins()&&(i="ruins",r="ruins",a[s].is_scouted()||(d="Some distant ruins")),(!a[s].is_ruins()||e.has_research("archeology")&&a[s].is_ruins())&&$(".worldmap").append('<img data-x="'+o.x+'" data-y="'+o.y+'" title="'+d+'" style="left:'+(l.x+3)+"px;top:"+l.y+'px" data-id="'+a[s].id()+'" data-name="'+n+'" src="'+game.ASSETS_URL+"images/assets/ui/world/"+i+'.png" class="tips '+r+'" />')}for(let t=0;t<s.length;t++){let a=s[t];if(a.mode!==game.ACTION_RESEARCH){let s=a.source,i=a.destination;console.log(i);let r=e.world().get_distance_in_days(s,i);a.mode===game.ACTION_DIPLOMACY&&(r/=2);let n="",o="troop",l=e.get_settlement(s.id),d=e.get_settlement(i.id),c=s.x+Math.floor((i.x-s.x)/r*a.passed),m=s.y-Math.floor((s.y-i.y)/r*a.passed);a.mode===game.ACTION_CAMPAIGN?a.type===game.CAMPAIGN_CARAVAN?(o="troop_caravan",n="Caravan from "+l.name()+" sent to "+d.name()+"."):a.type===game.CAMPAIGN_SCOUT?(o="troop_scout",n="Scout from "+l.name()+" going to a specific place."):a.type===game.CAMPAIGN_SPY?(o="troop_spy",n="Spy from "+l.name()+" sneaking into "+d.name()+"."):a.type===game.CAMPAIGN_ARMY_RETURN?(o="troop_return",n=d.name()+" army returning from "+l.name()+"."):(o="troop_attack",n=l.name()+" army marching to "+d.name()+"."):a.mode===game.ACTION_DIPLOMACY&&(o="troop_diplomatic",n="Diplomatic mission from "+l.name()+" to "+d.name()+".");let h=e.ui().get_cell_middle_coords(m,c);$(".worldmap").append('<img data-name="'+o+'" data-x="'+c+'" data-y="'+m+'" title="'+n+'" style="left:'+(h.x+3)+"px;top:"+h.y+'px" data-id="'+t+'" src="'+game.ASSETS_URL+"images/assets/ui/world/"+o+'.png" class="tips troop" />')}}},super(e)}}
/**
 * Ranks panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_ranks
 * @extends ui_panel
 * @returns {ui_panel_ranks}
 */class ui_panel_ranks extends ui_panel{constructor(e){e.id="ranks",e.template=ui.generic_panel_template("World Ranks"),e.on_show=function(e){let t=this.core();t.get_settlement();$(this.handle+" section").append('<div class="ranks-list"></div>'),$(this.handle).on("click",".view",(function(){let e=parseInt($(this).data("id"),10),a=t.get_settlement(e);return a&&(a.is_player()?t.ui().open_panel("council"):t.ui().open_panel("settlement",a)),!1}))},e.on_refresh=function(){let e=[],t=this.core().get_settlements();for(let a=0;a<t.length;a++)t[a].is_urban()&&e.push({id:t[a].id(),name:t[a].name(),data:t[a].get_rank()});e.sort((function(e,t){let a=new Date(e.data.score),s=new Date(t.data.score);return a>s?-1:a<s?1:0}));let a='<table class="normal">';a+='<thead><tr><td class="center">Rank</td><td>Settlement</td><td class="center">Score</td></tr></thead><tbody>';for(let t=0;t<e.length;t++)a+='<tr><td class="center">'+(t+1)+'</td><td><a data-id="'+e[t].id+'" title="View info about this settlement." class="tips view" href="#">'+e[t].name+'</a> </td><td class="center">'+e[t].data.score+"</td></tr>";a+='</tbody><tfoot><tr><td class="center">Rank</td><td>Settlement</td><td class="center">Score</td></tr></tfoot></table>',$(this.handle+" .ranks-list").empty().append(a)},super(e)}}
/**
 * Create a new army panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_new_army
 * @extends ui_panel
 * @returns {ui_panel_new_army}
 */class ui_panel_new_army extends ui_panel{constructor(e){e.template=ui.campaign_panel_template("New army"),e.id="new-army",e.on_show=function(e){let t=this,a=this.core(),s=a.get_settlement(),i=e.data,r=a.get_settlements(),n=s.army(),o=s.location(),l=a.world().get_distance_in_days(o,i.location());this.assigned_army={},this.assigned_navy={};for(let e in n)this.assigned_army[e]=n[e];if(s.can_build_ships()){let e=s.navy();for(let t in e)this.assigned_navy[t]=e[t]}let d='<div class="column"><fieldset><legend>Initial costs</legend><dl>';for(let e in game.ARMY_COSTS){let t=0;t="coins"===e?game.ARMY_COSTS[e]*l:"provisions"===e?Math.ceil(game.ARMY_COSTS[e]*l/4):game.ARMY_COSTS[e],d+="<dt>"+game.nice_numbers(t)+"</dt><dd>"+a.ui().resource_small_img(e)+"</dd>"}if(d+="</dl></fieldset>",void 0!==n){d+="<fieldset><legend>Soldiers</legend>";for(let e in n)d+='<div class="army-item"><a href="#" data-max="'+n[e]+'" data-soldier="'+e+'" class="army-item-inc">+</a><a href="#" data-max="'+n[e]+'" data-soldier="'+e+'" class="army-item-dec">-</a><img class="tips" title="'+game.SOLDIERS[e].name+'" src="'+game.ASSETS_URL+"images/assets/army/"+e.toLowerCase().replace(/ /g,"_")+'.png" /><span class="amount">'+n[e]+"</span></div>";d+="</fieldset>"}d+='<fieldset><legend>Destination</legend><select class="army-destination"><option value="0">-- select --</option>';for(let e=1;e<r.length;e++)(!r[e].is_ruins()||a.has_research("archeology")&&r[e].is_ruins())&&(d+="<option "+(i&&r[e].id()===i.id()?"selected ":"")+'value="'+r[e].id()+'">'+r[e].nice_name()+"</option>");if(d+='</select></fieldset></div><div class="column">',s.can_build_ships()&&"undefined"!=typeof navy){d+="<fieldset><legend>Ships</legend>";for(let e in navy)d+='<div class="navy-item"><a href="#" data-max="'+navy[e]+'" data-ship="'+e+'" class="navy-item-inc">+</a><a href="#" data-max="'+navy[e]+'" data-ship="'+e+'" class="navy-item-dec">-</a><img class="tips" title="'+e+'" src="'+game.ASSETS_URL+"images/assets/army/"+e.toLowerCase().replace(/ /g,"_")+'.png" /><span class="amount">'+navy[e]+"</span></div>";d+="</fieldset>"}if(s.can_recruit_heroes()){let e=s.heroes();if(d+='<fieldset><legend>Hero</legend><select class="army-hero">',$.isEmptyObject(e))d+='<option value="0">-- no heroes available --</option>';else{d+='<option value="0">-- select --</option>';for(let t=0;t<e.length;t++)d+='<option value="'+t+'">'+e[t]+"</option>"}d+="</select></fieldset>"}else d+="<p><strong>Note!</strong> Build a Tavern to be able to recruit powerful heroes and assign them to your armies.</p>";d+='</div><div class="clearfix"></div>',$(this.handle+" section").empty().append(d),$(this.handle).on("click",".navy-item-inc",(function(){let e=parseInt($(this).data("max"),10),a=$(this).data("ship"),s=parseInt($(this).parent().children(".amount").html(),10);return s+1<=e&&(t.assigned_navy[a]=s+1,$(this).parent().children(".amount").html(s+1)),!1})).on("click",".navy-item-dec",(function(){let e=$(this).data("ship"),a=parseInt($(this).parent().children(".amount").html(),10);return a-1>=0&&(t.assigned_navy[e]=a-1,$(this).parent().children(".amount").html(a-1)),!1})).on("click",".army-item-inc",(function(){let e=parseInt($(this).data("max"),10),a=$(this).data("soldier"),s=parseInt($(this).parent().children(".amount").html(),10);return s+1<=e&&(t.assigned_army[a]=s+1,$(this).parent().children(".amount").html(s+1)),!1})).on("click",".army-item-dec",(function(){let e=$(this).data("soldier"),a=parseInt($(this).parent().children(".amount").html(),10);return a-1>=0&&(t.assigned_army[e]=a-1,$(this).parent().children(".amount").html(a-1)),!1})).on("click",".dispatch",(function(){if(!s.can_recruit_soldiers())return a.ui().error("You will need to construct a Military Camp before being able to attack other settlements."),!1;let e=parseInt($(t.handle+" .army-destination").val(),10);return(i&&i.id()!==e||!i)&&(i=a.get_settlement(e)),0===e||!i||0===s.num_soldiers(t.assigned_army)&&0===s.num_ships(t.assigned_navy)?(a.ui().error("There was an error creating and dispatching the army, check the data you entered and try again."),!1):(a.queue_add(s,i,game.ACTION_CAMPAIGN,game.CAMPAIGN_ARMY,{army:t.assigned_army,navy:t.assigned_navy})?(a.do_achievement("sendarmy"),t.destroy()):a.ui().error("There was an error creating and dispatching the army, check the data you entered and try again."),!1)}))},super(e)}}
/**
 * Create a new spy panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_new_spy
 * @extends ui_panel
 * @returns {ui_panel_new_spy}
 */class ui_panel_new_spy extends ui_panel{constructor(e){e.template=ui.campaign_panel_template("New spy"),e.id="new-spy",e.on_show=function(e){let t=this,a=this.core(),s=a.get_settlement(),i=e.data,r=a.get_settlements(),n=s.espionage(),o=s.location(),l=a.world().get_distance_in_days(o,i.location()),d="<fieldset><legend>Initial costs</legend><dl>";for(let e in game.SPY_COSTS){let t=0;t="coins"===e?game.SPY_COSTS[e]*l:"provisions"===e?Math.ceil(game.SPY_COSTS[e]*l/4):game.SPY_COSTS[e],d+="<dt>"+game.nice_numbers(t)+"</dt><dd>"+a.ui().resource_small_img(e)+"</dd>"}d+='</dl></fieldset><fieldset><legend>Destination</legend><select class="espionage-destination"><option value="0">-- select --</option>';for(let e=1;e<r.length;e++)r[e].is_ruins()||(d+="<option "+(i&&r[e].id()===i.id()?"selected ":"")+'value="'+r[e].id()+'">'+r[e].nice_name()+"</option>");d+='</select></fieldset><fieldset class="range-combo"><legend>Espionage</legend><input type="range" value="'+n+'" min="1" max="'+n+'" class="espionage-range" /><input type="text" readonly value="'+n+'" class="espionage-value tips" title="Total espionage points assigned to this spy." /><input type="text" readonly value="'+Math.ceil(n/100)+'%" class="espionage-chance tips" title="Chance of mission success." /></fieldset><fieldset><legend>Mission</legend><select class="espionage-mission"><option value="0">-- select --</option>';for(let e=1;e<game.SPY_MISSIONS.length;e++)d+='<option value="'+e+'">'+game.SPY_MISSIONS[e].capitalize()+"</option>";d+='</select></fieldset><fieldset class="espionage-rel"><legend>Religion'+(i?" (currently "+i.religion().name+")":"")+'</legend><select class="espionage-religion">';for(let e=0;e<game.RELIGIONS.length;e++)d+='<option value="'+e+'">'+game.RELIGIONS[e].capitalize()+(e===s.religion().id?" (your religion)":"")+"</option>";d+="</select><p><strong>Note!</strong> Attempting to change a settlement`s religion uses up all your accumulated faith.</p></fieldset>",$(this.handle+" section").empty().append(d),$(this.handle).on("change",".espionage-range",(function(){let e=parseInt($(this).val(),10);$(t.handle+" .espionage-value").val(e),$(t.handle+" .espionage-chance").val(Math.ceil(e/100)+"%")})).on("change",".espionage-mission",(function(){parseInt($(this).val(),10)===game.SPY_MISSION_RELIGION?$(t.handle+" .espionage-rel").show():$(t.handle+" .espionage-rel").hide()})).on("click",".dispatch",(function(){if(!s.can_diplomacy())return a.ui().error("You will need to construct an Embassy before being able to send spies to other settlements."),!1;let e=parseInt($(t.handle+" .espionage-value").val(),10),r=parseInt($(t.handle+" .espionage-destination").val(),10),o=parseInt($(t.handle+" .espionage-mission").val(),10);if((i&&i.id()!==r||!i)&&(i=a.get_settlement(r)),0===r||e>n||!i||o<=0)return a.ui().error("There was an error creating and dispatching the spy, check the data you entered and try again."),!1;let l={espionage:e,mission:o};return o===game.SPY_MISSION_RELIGION&&(l.religion=parseInt($(t.handle+" .espionage-religion").val(),10)),a.queue_add(s,i,game.ACTION_CAMPAIGN,game.CAMPAIGN_SPY,l)?(a.do_achievement("jamesbond"),t.destroy()):a.ui().error("There was an error creating and dispatching the spy, check the data you entered and try again."),!1}))},e.on_refresh=function(){let e=this.core().get_settlement().espionage();$(this.handle+" .espionage-range").attr("max",e)},super(e)}}
/**
 * Create a new scout panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_new_scout
 * @extends ui_panel
 * @returns {ui_panel_new_scout}
 */class ui_panel_new_scout extends ui_panel{constructor(e){e.template=ui.campaign_panel_template("New scout"),e.id="new-scout",e.on_show=function(e){let t=this,a=this.core(),s=a.get_settlements(),i=a.get_settlement(),r=e.data,n=i.location(),o=a.world().get_distance_in_days(n,r.location()),l="<fieldset><legend>Initial costs</legend><dl>";for(let e in game.SCOUT_COSTS){let t=0;t="coins"===e?game.SCOUT_COSTS[e]*o:"provisions"===e?Math.ceil(game.SCOUT_COSTS[e]*o/4):game.SCOUT_COSTS[e],l+="<dt>"+game.nice_numbers(t)+"</dt><dd>"+a.ui().resource_small_img(e)+"</dd>"}l+='</dl></fieldset><fieldset><legend>Destination</legend><select class="caravan-destination"><option value="0">-- select --</option>';for(let e=1;e<s.length;e++)s[e].is_ruins()&&(!s[e].is_ruins()||a.has_research("archeology")&&s[e].is_ruins())&&(l+="<option "+(r&&s[e].id()===r.id()?"selected ":"")+'value="'+s[e].id()+'">'+s[e].nice_name()+"</option>");l+="</select></fieldset>"+$(this.handle+" section").empty().append(l),$(this.handle).on("click",".dispatch",(function(){if(!i.can_diplomacy())return a.ui().error("You will need to construct an Embassy before being able to send scouts to other settlements."),!1;return a.queue_add(i,r,game.ACTION_CAMPAIGN,game.CAMPAIGN_SCOUT,{})?t.destroy():a.ui().error("There was an error creating and dispatching the scout, check the data you entered and try again."),!1}))},e.on_refresh=function(){},super(e)}}
/**
 * Create a new caravan panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_new_caravan
 * @extends ui_panel
 * @returns {ui_panel_new_caravan}
 */class ui_panel_new_caravan extends ui_panel{constructor(e){e.template=ui.campaign_panel_template("New caravan"),e.id="new-caravan",e.on_show=function(e){this.resources={};let t=this,a=this.core(),s=a.get_settlement(),i=e.data,r=a.get_settlements(),n=s.location(),o=a.world().get_distance_in_days(n,i.location()),l="<fieldset><legend>Initial costs</legend><dl>";for(let e in game.CARAVAN_COSTS){let t=0;t="coins"===e?game.CARAVAN_COSTS[e]*o:"provisions"===e?Math.ceil(game.CARAVAN_COSTS[e]*o/4):game.CARAVAN_COSTS[e],l+="<dt>"+game.nice_numbers(t)+"</dt><dd>"+a.ui().resource_small_img(e)+"</dd>"}l+='</dl></fieldset><fieldset><legend>Destination</legend><select class="caravan-destination"><option value="0">-- select --</option>';for(let e=1;e<r.length;e++)(r[e].is_ruins()||r[e].is_urban()||r[e].is_village())&&(!r[e].is_ruins()||a.has_research("archeology")&&r[e].is_ruins())&&(l+="<option "+(i&&r[e].id()===i.id()?"selected ":"")+'value="'+r[e].id()+'">'+r[e].nice_name()+"</option>");l+='</select></fieldset><fieldset class="select-combo"><legend>Resources</legend><select class="caravan-resources-select"><option value="0">-- select --</option><option value="coins">Coins</option>';let d=s.get_resources();for(let e in d)game.is_virtual_resource(e)||(l+='<option value="'+e+'"> '+game.get_resource_name(e)+"</option>");l+='</select><input title="Add the resources to the list." type="button" class="tips caravan-resources-add" value="+" /><input title="Amount of selected resource to add to the caravan." type="number" value="1" class="tips caravan-resources-amount" min="1" max="999" /><div class="caravan-resources clearfix"></div></fieldset>',$(this.handle+" section").empty().append(l),this.generate_table_data=function(){let e='<table class="caravan-resources clearfix"><thead><tr><td>Amount</td><td>Resource</td><td></td></tr></thead><tbody>';for(let t in this.resources)e+="<tr><td>"+this.resources[t]+"</td><td>"+a.ui().resource_small_img(t)+'</td><td><a title="Remove this resource from the caravan." href="#" data-id="'+t+'" class="tips caravan-resources-delete">-</a></td></tr>';e+="</tbody></table>",$(this.handle+" .caravan-resources").empty().append(e)},$(this.handle).on("click",".caravan-resources-add",(function(){let e=parseInt($(t.handle+" .caravan-resources-amount").val(),10),i=$(t.handle+" .caravan-resources-select").val();if("0"!==i){if(void 0!==t.resources[i]&&!s.has_resource(i,t.resources[i]+e))return a.ui().error(s.name()+" doesn`t have enough "+game.get_resource_name(i)+"."),!1;if(void 0===t.resources[i]&&!s.has_resource(i,e))return a.ui().error(s.name()+" doesn`t have enough "+game.get_resource_name(i)+"."),!1;void 0!==t.resources[i]?t.resources[i]=t.resources[i]+e:t.resources[i]=e,t.generate_table_data()}return!1})).on("click",".caravan-resources-delete",(function(){let e=$(this).data("id");return delete t.resources[e],t.generate_table_data(),!1})).on("click",".dispatch",(function(){if(!s.can_trade())return a.ui().error("You will need to construct a Trading Post before being able to trade resources with other settlements."),!1;let e=parseInt($(t.handle+" .caravan-destination").val(),10);return(i&&i.id()!==e||!i)&&(i=a.get_settlement(e)),0===e||!i||$.isEmptyObject(t.resources)?(a.ui().error("There was an error creating and dispatching the caravan, check the data you entered and try again."),!1):(a.queue_add(s,i,game.ACTION_CAMPAIGN,game.CAMPAIGN_CARAVAN,{resources:t.resources})?(a.do_achievement("donkeylord"),t.destroy()):a.ui().error("There was an error creating and dispatching the caravan, check the data you entered and try again."),!1)}))},super(e)}}
/**
 * City Council panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_council
 * @extends ui_panel
 * @returns {ui_panel_council}
 */class ui_panel_council extends ui_panel{constructor(e){e.id="council",e.template=ui.generic_panel_template("City Council"),e.on_show=function(e){let t=this.core();$(this.handle+" section").append(t.ui().tabs(["Info","Tips","Production","Housing","Municipal","Mercenary","Achievements"]));let a='<div class="achievements-list">';for(let e=0;e<game.ACHIEVEMENTS.length;e++)a+='<div data-handle="'+game.ACHIEVEMENTS[e].handle+'" class="achievement"><div class="left"><div class="ach img"></div><div class="ach points">'+game.ACHIEVEMENTS[e].points+'</div></div><div class="right"><div class="inner"><h2>'+game.ACHIEVEMENTS[e].name+"</h2>"+game.ACHIEVEMENTS[e].description+'</div><div class="time-ago"></div></div></div>';a+="</div>",$(this.handle+" #tab-achievements").empty().append(a),$(this.handle).on("click",".view-merc",(function(){let e=parseInt($(this).data("id"),10),a=game.MERCENARIES[e];return t.ui().open_panel("army",a),!1})).on("click",".raid-merc",(function(){return t.ui().error("Not implemented yet."),!1})).on("click",".disband-merc",(function(){return t.ui().open_modal((function(e){if("yes"===e){let e=parseInt($(this).data("id"),10);t.get_settlement().release_mercenary(e),t.save_and_refresh()}}),"Are you sure you want to release this mercenary army? You won`t be able to use them anymore!"),!1})).on("click",".building-info",(function(){let e=$(this).data("handle"),a=t.ui().panel_class_names[e],s=t.get_building_config_data(e);return e&&s&&(void 0!==a?t.ui().open_panel(e,s):t.ui().open_panel("building",s,!0)),!1})).on("click",".pause",(function(){let e=$(this).data("handle"),a=t.get_settlement().get_building(e);return a&&a.stop_production()&&($(this).removeClass("pause").addClass("start"),$(this).attr("title","Start production")),!1})).on("click",".start",(function(){let e=$(this).data("handle"),a=t.get_settlement().get_building(e);return a&&a.start_production()&&($(this).removeClass("start").addClass("pause"),$(this).attr("title","Stop production")),!1}))},e.on_refresh=function(){let e,t,a=this.core(),s=a.get_settlement(),i=s.get_buildings(),r=a.achievements(),n=a.advice(),o=0,l=0,d="",c={fame:0,espionage:0,research:0,faith:0},m=s.mercenary(),h='<p>Mercenary armies are available to hire for a fixed price, they do not cost additional resources but they are only available for raiding and campaign missions, they do not participate in the defense of your city.</p><p>Also, keep in mind that once a mercenary army is hired, they are at your disposal until the end of the current year.</p><div class="hired-mercenaries-list">';if(m.length>0){h+='<table class="normal">';for(let t=0;t<m.length;t++)e=game.MERCENARIES[m[t].id],h+='<tr><td class="icon"><img src="'+game.ASSETS_URL+"images/assets/emblems/"+e.icon+'.png" /></td><td><p class="title">'+e.name+'</p><p class="description">'+e.description+'</p></td><td class="large"><a title="View info on this mercenary army." data-id="'+m[t].id+'" class="tips view-merc" href="#">view</a> <a title="Send this mercenary army on a raiding mission towards a specific settlement." data-id="'+t+'" class="tips raid-merc" href="#">raid</a> <a title="Disband this mercenary army? They will be available for hire later when you need them." data-id="'+t+'" class="tips disband-merc" href="#">release</a></td></tr>';h+="</table>"}else h+="<p>You have no mercenary armies hired for your city. Go to the World Market Trades and hire one.</p>";h+="</div>",$(this.handle+" #tab-mercenary").empty().append(h);for(let e=0;e<r.length;e++)void 0!==r[e]&&($(this.handle+" .achievement[data-handle="+r[e].handle+"]").addClass("has"),$(this.handle+" .achievement[data-handle="+r[e].handle+"] .time-ago").html(game.time_since(r[e].date)+" ago"));if(h='<img class="avatar right" src="'+game.ASSETS_URL+"images/assets/avatars/avatar"+s.ruler().avatar+'.png" /><dl><dt>Current date</dt><dd class="citydate">'+a.format_date()+"</dd><dt>Ruler</dt><dd>"+s.ruler().name+"</dd><dt>Climate</dt><dd>"+s.climate().name+"</dd><dt>Season</dt><dd>"+a.season().name+"</dd><dt>Personality</dt><dd>"+s.personality().name+"</dd><dt>Nationality</dt><dd>"+s.nationality().name+"</dd><dt>Population</dt><dd>"+game.nice_numbers(s.population())+"</dd><dt>Achievement Points</dt><dd>"+a.achievement_points()+"</dd><dt>Religion</dt><dd>"+s.religion().name+"</dd><dt>Level</dt><dd>"+s.level()+"</dd><dt>Fame</dt><dd>"+a.ui().progress(100*s.fame()/a.level_to_fame(s.level()),"small",game.nice_numbers(s.fame())+" / "+game.nice_numbers(a.level_to_fame(s.level())))+"</dd><dt>Prestige</dt><dd>"+a.ui().progress(100*s.prestige()/game.MAX_PRESTIGE_VALUE,"small",s.prestige()+" / "+game.MAX_PRESTIGE_VALUE)+"</dd><dt>Espionage</dt><dd>"+a.ui().progress(100*s.espionage()/game.MAX_ESPIONAGE_VALUE,"small",s.espionage()+" / "+game.MAX_ESPIONAGE_VALUE)+"</dd><dt>Faith</dt><dd>"+a.ui().progress(100*s.faith()/game.MAX_FAITH_VALUE,"small",s.faith()+" / "+game.MAX_FAITH_VALUE)+"</dd><dt>Research</dt><dd>"+a.ui().progress(100*s.research()/game.MAX_RESEARCH_VALUE,"small",s.research()+" / "+game.MAX_RESEARCH_VALUE)+"</dd></dl>",$(this.handle+" #tab-info").empty().append(h),h="",n.length>0){h+='<ul class="advices">';for(let e=0;e<n.length;e++)h+="<li>"+n[e]+"</li>";h+="</ul>"}$(this.handle+" #tab-tips").empty().append(h),h='<table class="normal"><thead><tr><td></td><td class="tips center" title="Current level / Maximum level">Level</td><td>Raises</td><td>Research</td><td>Uses</td></tr></thead>';for(let e=0;e<i.length;e++)if(i[e].is_municipal_building()){if(t=i[e].get_building_data(),h+="<tr"+(!1===i[e].has_problems()?"":' class="notify"')+'><td><a href="#" class="building-info" data-handle="'+i[e].handle+'">'+i[e].name+'</a></td><td class="center">'+i[e].level+" / "+(void 0!==t.levels?t.levels:1)+"</td><td>",t.production)for(let s in t.production)c[s]+=!1===i[e].has_problems()?i[e].level*t.production[s]+a.get_prod_modifier(t):0,h+=" +"+i[e].level*t.production[s]+" "+a.ui().resource_small_img(s);if(h+="</td><td>",t.production)for(let e in t.production)a.get_prod_modifier(t)>0&&(h+=" +"+a.get_prod_modifier(t)+" "+a.ui().resource_small_img(e));if(h+="</td><td>",t.materials)if(Array.isArray(t.materials))for(let s=0;s<t.materials.length;s++)for(let r in t.materials[s])o+=!1===i[e].has_problems()?t.materials[s][r]:0,h+=" -"+t.materials[s][r]+" "+a.ui().resource_small_img(r);else for(let s in t.materials)o+=!1===i[e].has_problems()?t.materials[s]:0,h+=" -"+t.materials[s]+" "+a.ui().resource_small_img(s);h+="</td></tr>"}for(let e in c)c[e]>0&&(d+=" +"+c[e]+" "+a.ui().resource_small_img(e));h+='<tfoot><tr><td>Total</td><td></td><td colspan="2">'+d+"</td><td>"+(o>0?"-":"")+o+" "+a.ui().resource_small_img("coins")+"</td></tr></tfoot></table>",$(this.handle+" #tab-municipal").empty().append(h),h='<table class="normal"><thead><tr><td></td><td class="tips center" title="Current level / Maximum level">Level</td><td>Tax</td><td>Research</td><td>Materials</td></tr></thead>';for(let e=0;e<i.length;e++)if(i[e].is_housing_building()){if(t=i[e].get_building_data(),h+="<tr"+(!1===i[e].has_problems()?"":' class="notify"')+'><td><a href="#" class="building-info" data-handle="'+i[e].handle+'">'+i[e].name+'</a></td><td class="center">'+i[e].level+" / "+(void 0!==t.levels?t.levels:1)+"</td><td>",t.tax&&(l+=!1===i[e].has_problems()?i[e].get_tax_amount(t.tax):0,h+=" +"+i[e].level*t.tax+" "+a.ui().resource_small_img("coins")),h+="</td><td>",t.tax&&a.get_tax_modifier(t)>0&&(h+=" +"+a.get_tax_modifier(t)+" "+a.ui().resource_small_img("coins")),h+="</td><td>",void 0!==t.materials)if(Array.isArray(t.materials))for(let e=0;e<t.materials.length;e++)for(let s in t.materials[e])h+=" -"+t.materials[e][s]+" "+a.ui().resource_small_img(s);else for(let e in t.materials)h+=" -"+t.materials[e]+" "+a.ui().resource_small_img(e);h+="</td></tr>"}h+='<tfoot><tr><td>Income</td><td></td><td colspan="2">+'+l+" "+a.ui().resource_small_img("coins")+"</td><td></td></tr></tfoot></table>",$(this.handle+" #tab-housing").empty().append(h),h='<table class="normal"><thead><tr><td></td><td class="tips center" title="Current level / Maximum level">Level</td><td>Production</td><td>Research</td><td>Materials</td><td></td></tr></thead>';for(let e=0;e<i.length;e++)if(i[e].is_production_building()&&!1===i[e].is_municipal_building()){if(t=i[e].get_building_data(),h+="<tr"+(!1===i[e].has_problems()?"":' class="notify"')+'><td><a href="#" class="building-info" data-handle="'+i[e].handle+'">'+i[e].name+'</a></td><td class="center">'+i[e].level+" / "+(void 0!==t.levels?t.levels:1)+"</td><td>",t.production)for(let s in t.production)h+=" +"+i[e].level*t.production[s]+" "+a.ui().resource_small_img(s);if(h+="</td><td>",t.production)for(let e in t.production)a.get_prod_modifier(t)>0&&(h+=" +"+a.get_prod_modifier(t)+" "+a.ui().resource_small_img(e));if(h+="</td><td>",t.materials)if(Array.isArray(t.materials))for(let e=0;e<t.materials.length;e++)for(let s in t.materials[e])h+=" -"+t.materials[e][s]+" "+a.ui().resource_small_img(s);else for(let e in t.materials)h+=" -"+t.materials[e]+" "+a.ui().resource_small_img(e);h+='</td><td class="center"><a title="'+(i[e].is_stopped()?"Start production":"Stop production")+'" data-handle="'+i[e].handle+'" class="tips '+(i[e].is_stopped()?"start":"pause")+' sbtn" href="#"></a></td></tr>'}h+='<tfoot><tr><td></td><td class="center">Level</td><td>Production</td><td>Research</td><td>Materials</td><td></td></tr></tfoot></table>',$(this.handle+" #tab-production").empty().append(h)},super(e)}}
/**
 * Army panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_army
 * @extends ui_panel
 * @returns {ui_panel_army}
 */class ui_panel_army extends ui_panel{constructor(e){e.id="army",e.template=ui.generic_panel_template("Army"),e.on_show=function(e){let t=this.core(),a=t.get_settlement(),s=e.data;$(this.handle+" header").append(s.name);let i=["Info"];a.num_soldiers(s.army)>0&&i.push("Soldiers"),a.num_ships(s.navy)>0&&i.push("Ships"),$(this.handle+" section").append(t.ui().tabs(i)),$(this.handle+" #tab-info").append('<img class="avatar right" src="'+game.ASSETS_URL+"images/assets/emblems/"+(void 0!==s.icon?s.icon:"22")+'.png" /><p>'+s.description+"</p>"),a.num_soldiers(s.army)>0&&$(this.handle+" #tab-soldiers").append(t.ui().army_list(s.army)),a.num_ships(s.navy)>0&&$(this.handle+" #tab-ships").append(t.ui().navy_list(s.navy))},super(e)}}
/**
 * Buildings panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_buildings
 * @extends ui_panel
 * @returns {ui_panel_buildings}
 */class ui_panel_buildings extends ui_panel{constructor(e){e.id="buildings",e.template=ui.generic_panel_template("City Buildings"),e.on_show=function(e){let t,a,s,i=this.core(),r=i.get_settlement(),n=this.handle,o='<div class="left buildings">';o+='<div class="tabs"><ul>';for(let e in game.BUILDINGS_CATEGORIES)o+='<li><a href="#tab-'+e.toLowerCase()+'">'+e+"</a></li>";o+="</ul>";for(let e in game.BUILDINGS_CATEGORIES){o+='<div id="tab-'+e.toLowerCase()+'" class="bldg-tabs">';for(let n=0;n<game.BUILDINGS_CATEGORIES[e].length;n++)if(t=game.BUILDINGS_CATEGORIES[e][n],-1!==$.inArray(t,game.BUILDINGS_ALL)&&(a=i.get_building_config_data(t),a)){let e=r.is_building_built(a.handle);s=a.handle,void 0!==a.tax&&(s=a.handle.slice(0,5));let t=void 0===a.visible_upgrades||!1===a.visible_upgrades?s:s+"1";o+='<div data-handle="'+a.handle+'" class="building-item'+(!0===e?" disabled":"")+'"><span class="title">'+a.name+'</span><img class="building" src="'+game.ASSETS_URL+"images/assets/buildings/"+t+'.png" /></div>'}o+="</div>"}o+='</div></div><div class="buildings-info right"><div class="b-name"></div><div class="b-desc"></div><div class="column-small"><fieldset class="levels"><legend>Levels</legend><div class="b-levels"></div></fieldset><fieldset><legend>Cost</legend><div class="b-cost"></div></fieldset></div><div class="column-small"><fieldset class="materials"><legend>Materials</legend><div class="b-mats"></div></fieldset><fieldset class="production"><legend>Production</legend><div class="b-prod"></div></fieldset><fieldset class="extra"><legend>Extra materials</legend><div class="b-chance"></div></fieldset><fieldset class="storage"><legend>Storage</legend><div class="b-store"></div></fieldset><fieldset class="taxes"><legend>Taxes</legend><div class="b-tax"></div></fieldset></div><div class="column-full"><fieldset><legend>Requirements</legend><div class="b-req"></div></fieldset></div><div class="toolbar"></div></div><div class="clearfix"></div>',$(n+" section").append(o),$(n).on("click",".building-item",(function(){$(n).addClass("expanded"),$(n+" .building-item").removeClass("active"),$(this).addClass("active"),$(n+" .b-chance, "+n+" .b-tax, "+n+" .b-store, "+n+" .b-req, "+n+" .b-cost, "+n+" .b-name, "+n+" .b-name, "+n+" .b-desc, "+n+" .b-mats, "+n+" .b-prod, "+n+" .toolbar").empty();let e=$(this).data("handle"),t=i.get_building_config_data(e);if(t){$(n+" .b-desc").html(t.description),$(n+" .b-name").html(t.name);let e='<dl class="nomg">';for(let a in t.cost)e+="<dt>"+game.nice_numbers(t.cost[a])+'</dt><dd><img class="small tips" title="'+game.get_resource_name(a)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+a+'.png" /></dd>';if(e+="</dl>",$(n+" .b-cost").append(e),void 0!==t.levels?($(n+" .b-levels").empty().append('<dl class="nomg"><dt>Upgrades</dt><dd>'+t.levels+"</dd></dl>"),$("fieldset.levels").show()):$("fieldset.levels").hide(),void 0!==t.requires){if(e='<dl class="nomg">',void 0!==t.requires.buildings)for(let a in t.requires.buildings)e+="<dt>Building</dt><dd>"+i.get_building_config_data(a).name+" (level "+t.requires.buildings[a]+")</dd>";if(void 0!==t.requires.research&&(e+="<dt>Research</dt><dd>"+i.get_research_config_data(t.requires.research).name+"</dd>"),void 0!==t.requires.climate){let a=[];for(let e=0;e<t.requires.climate.length;e++)a.push(game.CLIMATES[t.requires.climate[e]].capitalize());e+="<dt>Climate</dt><dd>"+a.join(", ")+"</dd>"}e+="<dt>City level</dt><dd>"+t.requires.settlement_level+"</dd></dl>",$(n+" .b-req").append(e)}if(void 0!==t.chance){e='<dl class="nomg">';for(let a in t.chance)e+="<dt>"+100*t.chance[a]+'%</dt><dd><img class="small tips" title="'+game.get_resource_name(a)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+a+'.png" /></dd>';e+="</dl>",$(n+" .b-chance").append(e),$("fieldset.extra").show()}else $("fieldset.extra").hide();if(void 0!==t.production){e='<dl class="nomg">';for(let a in t.production)e+="<dt>"+t.production[a]+'</dt><dd><img class="small tips" title="'+game.get_resource_name(a)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+a+'.png" /></dd>';e+="</dl>",$(n+" .b-prod").append(e),$("fieldset.production").show()}else $("fieldset.production").hide();if(void 0!==t.materials){if(e='<dl class="nomg">',Array.isArray(t.materials))for(let a=0;a<t.materials.length;a++)for(let s in t.materials[a])e+="<dt>"+t.materials[a][s]+'</dt><dd><img class="small tips" title="'+game.get_resource_name(s)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+s+'.png" /></dd>';else for(let a in t.materials)e+="<dt>"+t.materials[a]+'</dt><dd><img class="small tips" title="'+game.get_resource_name(a)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+a+'.png" /></dd>';e+="</dl>",$(n+" .b-mats").append(e),$("fieldset.materials").show()}else $("fieldset.materials").hide();void 0!==t.tax?(e='<dl class="nomg"><dt>Tax</dt><dd>'+t.tax+'<img class="small tips" title="Coins" src="'+game.ASSETS_URL+'images/assets/resources/coins.png" /></dd></dl>',$(n+" .b-tax").append(e),$("fieldset.taxes").show()):$("fieldset.taxes").hide(),void 0!==t.storage?($("fieldset.taxes, fieldset.materials").hide(),e='<dl class="nomg"><dt>'+t.storage+'</dt><dd><img class="small tips" title="Storage Space" src="'+game.ASSETS_URL+'images/assets/resources/storage.png" /></dd></dl>',$(n+" .b-store").append(e),$("fieldset.storage").show()):$("fieldset.storage").hide(),!0!==r.is_building_built(t.handle)&&$(n+" .toolbar").append('<a href="#" class="btn green build" data-handle="'+t.handle+'">Build</a>'),$(n+" .right").show()}return!1})).on("click",".btn.build",(function(){let e=$(this).data("handle");return!1!==r.build(e)&&($(n+" .building-item[data-handle="+e+"]").addClass("disabled"),$(n+" .toolbar").empty()),!1}))},super(e)}}
/**
 * Trades panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_trades
 * @extends ui_panel
 * @returns {ui_panel_trades}
 */class ui_panel_trades extends ui_panel{constructor(e){e.id="trades",e.template=ui.generic_panel_template("World Market"),e.on_show=function(e){let t=this,a=this.core(),s=a.get_settlement(),i=a.auctioneer(),r=this.handle,n=["Export","Import","Mercenaries","BlackMarket","Prices"];s.can_trade()&&n.push("Auctioneer"),$(r+" section").append(a.ui().tabs(n)),$(r+" #tab-import").append('<p>Below is a list of goods that the other cities in the world are looking to sell. The goods replenish every six months, so plan accordingly. You will need to build a Trading Post before being able to sell goods.</p><div class="contents"></div>'),$(r+" #tab-export").append('<p>Below is a list of goods that the other cities in the world are looking to buy. The goods replenish every six months, so plan accordingly. You will need to build a Trading Post before being able to buy goods.</p><div class="contents"></div>'),$(r+" #tab-mercenaries").append('<p>Below is a list of mercenary armies that are looking for hire. Mercenaries are available only for raiding and conquest missions, they do not join your city so they will not participate in defense.</p><div class="contents"></div>'),$(r+" #tab-blackmarket").append("<p>The Black Market is a way to dump your excess materials when you`re in need of emptying your warehouses, but expect a steep price drop (taxes for all Black Market trades are <strong>"+game.BLACK_MARKET_DISCOUNT+'%</strong>). The goods will be taken immediately from your warehouses but you will receive the coins at the <strong>start of the next month</strong>. Also, you get <strong>no prestige</strong> from Black Market trades.</p><div class="contents"></div>'),$(r+" #tab-auctioneer").append("<p>The Auctioneer is an automated way to purchase goods from the world trade market. When the requested goods become available, the Auctioneer purchases them automatically, taking an extra <strong>"+game.AUCTIONEER_DISCOUNT+'%</strong> tax on the total amount of coins paid for the goods.</p><div class="contents"></div>'),$(r+" #tab-prices").append('<div class="contents"></div>'),$(r+" #tab-blackmarket > .contents").append('<table class="normal"><thead><tr><td>Resources: <select class="bm-materials"></select></td><td>Quantity&nbsp;&nbsp;&nbsp;&nbsp;<select class="bm-quantity"><option value="0">-- select --</option><option value="10">10</option><option value="100">100</option><option value="1000">1000</option><option value="10000">10000</option></select>&nbsp;&nbsp;&nbsp;&nbsp;or enter manually&nbsp;&nbsp;&nbsp;&nbsp;<input type="number" min="1" max="100000" placeholder="amount" class="small bm-qty-manual" /></td><td><a title="List goods on Black Market" class="tips bmarket" href="#">List</a></td></tr></thead><tbody></tbody></table>'),s.can_trade()&&$(r+" #tab-auctioneer > .contents").append('<table class="normal"><thead><tr><td>Resources: <select class="auc-materials"></select></td><td>Quantity&nbsp;&nbsp;&nbsp;&nbsp;<select class="auc-quantity"><option value="0">-- select --</option><option value="10">10</option><option value="100">100</option><option value="1000">1000</option><option value="10000">10000</option></select>&nbsp;&nbsp;&nbsp;&nbsp;or enter manually&nbsp;&nbsp;&nbsp;&nbsp;<input type="number" min="1" max="100000" placeholder="amount" class="small auc-qty-manual" /></td><td><a title="Search for the goods" class="tips auction" href="#">Search</a></td></tr></thead><tbody></tbody></table>');let o='<option value="0">-- select --</option>',l=s.get_resources();for(let e in l)game.is_virtual_resource(e)||(o+='<option value="'+e+'"> '+game.get_resource_name(e)+"</option>");$(r+" .bm-materials, "+r+" .auc-materials").empty().append(o),$(r).on("click",".settlement-info",(function(){let e=$(this).data("settlement");return a.ui().open_panel("settlement",a.get_settlement(e)),!1})).on("click",".buy:not(.disabled)",(function(){if(!s.can_trade())return a.ui().error("You will need to construct a Trading Post before being able to trade resources with other settlements."),!1;let e=$(this).data("settlement"),i=$(this).data("resource");return!1!==s.buy_from_settlement(e,i)&&t.on_refresh(),!1})).on("click",".sell:not(.disabled)",(function(){if(!s.can_trade())return a.ui().error("You will need to construct a Trading Post before being able to trade resources with other settlements."),!1;let e=$(this).data("settlement"),i=$(this).data("resource");return!1!==s.sell_to_settlement(e,i)&&t.on_refresh(),!1})).on("click",".auction",(function(){if(!s.can_trade())return a.ui().error("You will need to construct a Trading Post before being able to assign an Auctioneer to buy items."),!1;let e=$(".auc-materials").val(),i=$(".auc-quantity").val(),r=$(".auc-qty-manual").val(),n=""===r?parseInt(i,10):parseInt(r,10);return"0"!==e&&n>0&&n<=1e4?a.auctioneer_add(e,n)&&(t.on_refresh(),$(".auc-qty-manual").val("")):a.ui().error("Select a resource and the amount you want the Auctioneer to search for."),!1})).on("click",".bmarket",(function(){let e=$(".bm-materials").val(),s=$(".bm-quantity").val(),i=$(".bm-qty-manual").val(),r=""===i?parseInt(s,10):parseInt(i,10);return"0"!==e&&r>0?a.black_market_add(e,r)&&(t.on_refresh(),$(".bm-qty-manual").val("")):a.ui().error("Select a resource and the amount of it you want to place on the Black Market."),!1})).on("click",".auc-resources-delete",(function(){let e=$(this).data("id");return delete i[e],t.generate_table_data(),!1})).on("click",".recruit:not(.disabled)",(function(){let e=$(this).data("handle");return!1!==s.recruit_mercenary_army(e)&&t.on_refresh(),!1})).on("click",".view-army:not(.disabled)",(function(){let e=parseInt($(this).data("id"),10),t=game.MERCENARIES[e];return a.ui().open_panel("army",t),!1}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=e.get_settlement(),s=e.get_settlements(),i="",r=e.black_market();for(let t in r)i+="<tr><td>Amount: "+r[t].amount+" "+e.ui().resource_small_img(t)+"</td><td>Total price: "+r[t].price+" "+e.ui().resource_small_img("coins")+"</td><td>&nbsp;</td></tr>";$("#tab-blackmarket > .contents > table > tbody").empty().append(i),a.can_trade()&&(this.generate_table_data=function(){let t="",a=e.auctioneer();for(let s in a)t+="<tr><td>Amount: "+a[s].amount+" "+e.ui().resource_small_img(s)+"</td><td>Total price: "+a[s].price+" "+e.ui().resource_small_img("coins")+'</td><td><a title="Remove this resource from the Auctioneer." href="#" data-id="'+s+'" class="tips auc-resources-delete">-</a></td></tr>';$("#tab-auctioneer > .contents > table > tbody").empty().append(t)},this.generate_table_data()),i='<table class="normal"><thead><tr><td>City</td><td class="center">Goods</td><td class="center">Amount</td><td class="center">Price</td><td class="center">Discount</td><td class="center">City Price</td><td class="center">Total price</td><td></td></tr></thead>';for(let a=1;a<s.length;a++){s[a];if(t.status()[s[a].id()].influence<20)break;let r=s[a].get_trades();if(null!==r){let t=r.imports;for(let r in t){let n=Math.ceil(game.RESOURCES[r].price*game.TRADES_DISCOUNT/100),o=Math.ceil(game.RESOURCES[r].price-n);i+='<tr><td><a href="#" class="settlement-info tips" data-settlement="'+s[a].name()+'" title="View info about this settlement.">'+s[a].name()+'</a></td><td class="center">'+e.ui().resource_small_img(r)+'</td><td class="center">'+t[r]+'</td><td class="center">'+game.RESOURCES[r].price+e.ui().resource_small_img("coins")+'</td><td class="center">'+n+e.ui().resource_small_img("coins")+'</td><td class="center">'+o+e.ui().resource_small_img("coins")+'</td><td class="center">'+Math.ceil(o*t[r])+e.ui().resource_small_img("coins")+'</td><td class="center"><a title="Sell those goods" data-resource="'+r+'" data-settlement="'+s[a].name()+'" class="tips sell'+(0===t[r]?" disabled":"")+'" href="#">sell</a></td></tr>'}}}i+='<tfoot><tr><td>City</td><td class="center">Goods</td><td class="center">Amount</td><td class="center">Price</td><td class="center">Discount</td><td class="center">City Price</td><td class="center">Total price</td><td></td></tr></tfoot></table>',$("#tab-export > .contents").empty().append(i),i='<table class="mercenaries">';for(let t=0;t<game.MERCENARIES.length;t++)i+='<tr><td class="icon"><img src="'+game.ASSETS_URL+"images/assets/emblems/"+game.MERCENARIES[t].icon+'.png" /></td><td><p class="title">'+game.MERCENARIES[t].name+'</p><p class="description">'+game.MERCENARIES[t].description+"</p></td><td>"+game.nice_numbers(game.MERCENARIES[t].cost)+e.ui().resource_small_img("coins")+'</td><td class="medium"><a title="View info on this mercenary army" data-id="'+t+'" class="tips view-army" href="#">view</a> '+e.ui().panel_btn("recruit","Recruit this mercenary army",game.MERCENARIES[t].handle,"recruit",e.get_settlement().is_mercenary_recruited(game.MERCENARIES[t].handle))+"</td></tr>";i+="</table>",$("#tab-mercenaries > .contents").empty().append(i),i='<table class="normal"><thead><tr><td>City</td><td class="center">Goods</td><td class="center">Amount</td><td class="center">Price</td><td class="center">Tax</td><td class="center">City Price</td><td class="center">Total price</td><td></td></tr></thead>';for(let a=1;a<s.length;a++){s[a];if(t.status()[s[a].id()].influence<20)break;let r=s[a].get_trades();if(null!==r){let t=r.exports;for(let r in t){let n=Math.ceil(game.RESOURCES[r].price*game.TRADES_ADDITION/100),o=Math.ceil(game.RESOURCES[r].price+n);i+='<tr><td><a href="#" class="settlement-info tips" data-settlement="'+s[a].name()+'" title="View info about this settlement.">'+s[a].name()+'</a></td><td class="center">'+e.ui().resource_small_img(r)+'</td><td class="center">'+t[r]+'</td><td class="center">'+game.RESOURCES[r].price+e.ui().resource_small_img("coins")+'</td><td class="center">'+n+e.ui().resource_small_img("coins")+'</td><td class="center">'+o+e.ui().resource_small_img("coins")+'</td><td class="center">'+Math.ceil(o*t[r])+e.ui().resource_small_img("coins")+'</td><td class="center"><a title="Buy those goods" data-resource="'+r+'" data-settlement="'+s[a].name()+'" class="tips buy'+(0===t[r]?" disabled":"")+'" href="#">buy</a></td></tr>'}}}i+='<tfoot><tr><td>City</td><td class="center">Goods</td><td class="center">Amount</td><td class="center">Price</td><td class="center">Tax</td><td class="center">City Price</td><td class="center">Total price</td><td></td></tr></tfoot></table>',$("#tab-import > .contents").empty().append(i),i='<table class="normal"><thead><tr><td>Resource</td><td class="center">Icon</td><td class="center">Base Price</td><td class="center tips" title="This is the price you get for selling one unit of the resource to another settlement, base price minus the <strong>'+game.TRADES_DISCOUNT+'%</strong> export taxes.">Sell Price</td><td class="center tips" title="This is the price you get for buying one unit of the resource from another settlement, base price plus the <strong>'+game.TRADES_ADDITION+'%</strong> import taxes.">Buy Price</td><td class="center tips" title="This is the price you get for placing one unit of the resource on the Black Market, base price minus the <strong>'+game.BLACK_MARKET_DISCOUNT+'%</strong> taxes.">Black Market</td><td class="center tips" title="This is the price you get for buying one unit of the resource via the Auctioneer, base price plus the <strong>'+game.TRADES_ADDITION+"%</strong> import taxes and plus the <strong>"+game.AUCTIONEER_DISCOUNT+'%</strong> Auctioneer taxes.">Auctioneer</td><td class="center tips" title="If the resource is listed as produced, that possibility depends on the location and climate of your settlement (ex. tropical settlements can build <strong>Sugar Farms</strong> and produce <strong>Sugar</strong>).">Type</td></tr></thead>';for(let t in game.RESOURCES)if(!game.is_virtual_resource(t)){let a=Math.ceil(game.RESOURCES[t].price*game.TRADES_ADDITION/100),s=Math.ceil(game.RESOURCES[t].price*game.TRADES_DISCOUNT/100),r=Math.ceil(game.RESOURCES[t].price*game.BLACK_MARKET_DISCOUNT/100),n=Math.ceil(game.RESOURCES[t].price*game.AUCTIONEER_DISCOUNT/100);i+="<tr><td>"+game.RESOURCES[t].name+'</td><td class="center">'+e.ui().resource_small_img(t)+'</td><td class="center">'+game.RESOURCES[t].price+e.ui().resource_small_img("coins")+'</td><td class="center">'+(game.RESOURCES[t].price-s)+e.ui().resource_small_img("coins")+'</td><td class="center">'+(game.RESOURCES[t].price+a)+e.ui().resource_small_img("coins")+'</td><td class="center">'+(game.RESOURCES[t].price-r)+e.ui().resource_small_img("coins")+'</td><td class="center">'+(game.RESOURCES[t].price+Math.ceil(a+n))+e.ui().resource_small_img("coins")+'</td><td class="center">'+(!0===game.RESOURCES[t].imported?"imported":"produced")+"</td></tr>"}i+='<tfoot><tr><td>Resource</td><td class="center">Icon</td><td class="center">Base Price</td><td class="center">Sell Price</td><td class="center">Buy Price</td><td class="center">Black Market</td><td class="center">Auctioneer</td><td class="center">Type</td></tr></tfoot></table>',$("#tab-prices > .contents").empty().append(i)},super(e)}}
/**
 * Barracks panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_barracks
 * @extends ui_panel
 * @returns {ui_panel_barracks}
 */class ui_panel_barracks extends ui_panel{constructor(e){e.id="barracks",e.template=ui.building_panel_template(),e.on_show=function(e){let t=this,a=this.core(),s=a.get_settlement();$(this.handle+" section").append(a.ui().tabs(["Info","Army"]));let i='<div class="army-list"></div><div class="army-recruiter">';for(let e in game.SOLDIERS){i+="<fieldset><legend>"+game.SOLDIERS[e].name+'</legend><div class="cost"><dl class="nomg">';for(let t in game.SOLDIERS[e].cost)i+="<dt>"+game.nice_numbers(game.SOLDIERS[e].cost[t])+"</dt><dd>"+a.ui().resource_small_img(t)+"</dd>";i+='</dl></div><div class="info"><dl class="nomg"><dt>Attack</dt><dd>'+game.SOLDIERS[e].attack+"</dd><dt>Defense</dt><dd>"+game.SOLDIERS[e].defense+'</dd></dl></div><img data-handle="'+e+'" title="Recruit '+game.SOLDIERS[e].name+'" class="tips recruit-soldier" src="'+game.ASSETS_URL+"images/assets/army/"+e.toLowerCase()+'.png" /></fieldset>'}i+="</div>",$(this.handle+" #tab-army").empty().append(i),$(this.handle).on("click",".recruit-soldier",(function(){let e=$(this).data("handle"),i=game.SOLDIERS[e].cost;return s.has_resources(i)&&s.remove_resources(i)&&s.recruit_soldier(e)?(a.ui().notify("A new "+game.SOLDIERS[e].name+" has been recruited."),t.on_refresh(),!1):(a.ui().error("You don`t have enough resources to recruit a "+game.SOLDIERS[e].name+"."),!1)}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=e.get_settlement().get_building(this.params_data.handle);a?($(this.handle+" #tab-info").empty().append(e.ui().building_panel(this.params_data,a.level)),$(this.handle+" .army-list").empty().append("<fieldset><legend>Current Army</legend>"+e.ui().army_list(t.army(),!0)+"</fieldset>")):this.destroy()},super(e)}}
/**
 * Shipyard panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_shipyard
 * @extends ui_panel
 * @returns {ui_panel_shipyard}
 */class ui_panel_shipyard extends ui_panel{constructor(e){e.id="shipyard",e.template=ui.building_panel_template(),e.on_show=function(e){let t=this.core(),a=t.get_settlement();$(this.handle+" section").append(t.ui().tabs(["Info","Navy"]));let s='<div class="navy-list"></div><div class="navy-recruiter">';for(let e in game.SHIPS){s+="<fieldset><legend>"+game.SHIPS[e].name+'</legend><div class="cost"><dl class="nomg">';for(let a in game.SHIPS[e].cost)s+="<dt>"+game.nice_numbers(game.SHIPS[e].cost[a])+"</dt><dd>"+t.ui().resource_small_img(a)+"</dd>";s+='</dl></div><div class="info"><dl class="nomg"><dt>Attack</dt><dd>'+game.SHIPS[e].attack+"</dd><dt>Defense</dt><dd>"+game.SHIPS[e].defense+'</dd></dl></div><img data-handle="'+e+'" title="Recruit '+game.SHIPS[e].name+'" class="tips recruit-ship" src="'+game.ASSETS_URL+"images/assets/navy/"+e.toLowerCase().replace(/ /g,"_")+'.png" /></fieldset>'}s+="</div>",$(this.handle+" #tab-navy").empty().append(s),$(this.handle).on("click",".recruit-ship",(function(){let e=$(this).data("handle"),s=game.SHIPS[e].cost;return a.has_resources(s)&&a.remove_resources(s)&&a.recruit_ship(e)?(t.ui().notify("A new "+game.SHIPS[e].name+" has been recruited."),self.on_refresh(),!1):(t.ui().error("You don`t have enough resources to recruit a "+game.SHIPS[e].name+"."),!1)}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=t.get_building(this.params_data.handle);a?($(this.handle+" #tab-info").empty().append(e.ui().building_panel(this.params_data,a.level)),$(this.handle+" .navy-list").empty().append("<fieldset><legend>Current Navy</legend>"+e.ui().navy_list(t.navy(),!0)+"</fieldset>")):this.destroy()},super(e)}}
/**
 * Church panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_church
 * @extends ui_panel
 * @returns {ui_panel_church}
 */class ui_panel_church extends ui_panel{constructor(e){e.id="church",e.template=ui.building_panel_template(),e.on_show=function(e){let t=this.core(),a=t.get_settlement();$(this.handle+" section").append(t.ui().tabs(["Info","Faith","Religion"])),$(this.handle).on("click",".religion",(function(){let e=parseInt($(this).data("id"),10);return t.ui().open_modal((function(t){"yes"===t&&a.change_religion(e)}),"Are you sure you want to switch religions? You will lose all your city`s faith!"),!1}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=e.get_settlement().get_building(this.params_data.handle),s="";if(a){$(this.handle+" #tab-info").empty().append(e.ui().building_panel(this.params_data,a.level)),s='<h2>Faith</h2><div class="section">'+e.ui().progress(100*t.faith()/game.MAX_FAITH_VALUE,"large",t.faith()+" / "+game.MAX_FAITH_VALUE)+"</div>",$(this.handle+" #tab-faith").empty().append(s),s="<p>Changing your settlement`s religion requires <strong>"+game.MAX_FAITH_VALUE+'</strong> faith, each religion gives you access to different heroes in your Tavern and gives you a boost to the influence with the cities sharing the same religion.</p><div class="religion-list">';for(let e=0;e<game.RELIGIONS.length;e++)s+='<div data-handle="'+game.RELIGIONS[e]+'" data-id="'+e+'" class="religion'+(t.religion().id===e?" selected":"")+'"><span>'+game.RELIGIONS[e].capitalize()+"</span></div>";s+="</div>",$(this.handle+" #tab-religion").empty().append(s)}else this.destroy()},super(e)}}
/**
 * Embassy panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_embassy
 * @extends ui_panel
 * @returns {ui_panel_embassy}
 */class ui_panel_embassy extends ui_panel{constructor(e){e.id="embassy",e.template=ui.building_panel_template(),e.on_show=function(e){let t=this.core();$(this.handle+" section").append(t.ui().tabs(["Info","Espionage","Diplomacy"])),$(this.handle+" #tab-diplomacy").empty().append('<div class="settlements-list"></div>'),$(this.handle).on("click",".view",(function(){let e=parseInt($(this).data("id"),10),a=t.get_settlement(e);return a&&t.ui().open_panel("settlement",a),!1}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement(),a=e.get_settlements(),s=t.status(),i=e.get_settlement().get_building(this.params_data.handle);if(i){$(this.handle+" #tab-info").empty().append(e.ui().building_panel(this.params_data,i.level)),$(this.handle+" #tab-espionage").empty().append('<h2>Espionage points</h2><div class="section">'+e.ui().progress(100*t.espionage()/game.MAX_ESPIONAGE_VALUE,"large",t.espionage()+" / "+game.MAX_ESPIONAGE_VALUE)+"</div>");let r='<table class="normal"><thead><tr><td>Settlement</td><td>Ruler</td><td>Influence</td><td>Religion</td><td>Status</td><td>Personality</td></tr></thead>';for(let i=1;i<a.length;i++)a[i].is_ruins()||(r+='<tr><td><a data-id="'+a[i].id()+'" title="View info about this settlement." class="tips view" href="#">'+a[i].name()+'</a> </td><td class="icon"><img class="avatar small" src="'+game.ASSETS_URL+"images/assets/avatars/avatar"+a[i].ruler().avatar+'.png" /></td><td><div data-id="'+a[i].id()+'" >'+e.ui().progress(s[a[i].id()].influence,"small")+"</div></td><td><p>"+a[i].religion().name+"</p></td><td><p>"+t.get_diplomacy_status(a[i].id()).name+"</p></td><td><p>"+a[i].personality().name+"</p></td></tr>");r+="<tfoot><tr><td>Settlement</td><td>Ruler</td><td>Influence</td><td>Religion</td><td>Status</td><td>Personality</td></tr></tfoot></table>",$(this.handle+" .settlements-list").empty().append(r)}else this.destroy()},super(e)}}
/**
 * Tavern panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_tavern
 * @extends ui_panel
 * @returns {ui_panel_tavern}
 */class ui_panel_tavern extends ui_panel{constructor(e){e.id="tavern",e.template=ui.building_panel_template(),e.on_show=function(e){let t=this,a=t.core(),s="";$(this.handle+" section").append(a.ui().tabs(["Info","Heroes","Items","Quests"]));let i=a.get_settlement().get_building(t.params_data.handle);if(i){$(t.handle+" #tab-items").empty().append("<p>Not implemented yet.</p>"),$(t.handle+" #tab-quests").empty().append("<p>Not implemented yet.</p>"),$(t.handle+" #tab-heroes").empty().append('<div class="column hero-list"></div><div class="column hero-info"></div><div class="column hero-items"></div>'),$(t.handle+" #tab-info").empty().append(a.ui().building_panel(t.params_data,i.level)),t.empty_items=function(){$(t.handle+" .hero-items").empty().append("<h3>Equipment</h3>");for(let e=1;e<game.ITEM_SLOTS_NUM;e++)$(t.handle+" .hero-items").append('<div class="slot" data-slot="'+e+'"></div>');$(t.handle+" .hero-items").append('<br class="clearfix" />').append("<h3>Bags</h3>");for(let e=0;e<game.ITEM_BACKPACK_NUM;e++)$(t.handle+" .hero-items").append('<div class="slot" data-backpack-slot="'+e+'"></div>')},t.empty_items();for(let e=0;e<game.HEROES.length;e++)s+='<p><a href="#" data-hero="'+game.HEROES[e].handle+'">'+game.HEROES[e].name+"</a></p>";$(t.handle+" .hero-list").empty().append(s),$(t.handle).on("click",".hero-list a",(function(){let e=$(this).data("hero"),s=a.get_hero_config_data(e);if(s){$(t.handle+" .hero-info").empty().append('<h3>Info <a title="Information provided by Wikipedia." href="'+s.link+'" class="tips external-link wikipedia"></a></h3>'+s.description+"<br /><br /><h3>Class</h3>"+game.HERO_CLASS_LIST[s.class]+'<br /><br /><h3>Attributes</h3>Strength: <span class="green">'+s.stats.strength+'</span><br />Stamina: <span class="green">'+s.stats.stamina+'</span><br />Agility: <span class="green">'+s.stats.agility+'</span><br />Intellect: <span class="green">'+s.stats.intellect+'</span><br />Spirit: <span class="green">'+s.stats.spirit+'</span><br />Health Points: <span class="blue">'+game.get_health_points(s)+'</span><br />Mana Points: <span class="blue">'+game.get_mana_points(s)+'</span><br />Damage: <span class="red">'+game.get_damage_points(s).min+"-"+game.get_damage_points(s).max+"</span>"),t.empty_items();for(let e=0;e<s.items.length;e++){let i=s.items[e].slot;$(t.handle+' .hero-items > div.slot[data-slot="'+i+'"]').empty().append("X").attr("title",a.ui().item_tooltip(s.items[e])).tipsy({className:"item",html:!0})}for(let e=0;e<s.backpack.length;e++)$(t.handle+' .hero-items > div.slot[data-backpack-slot="'+e+'"]').empty().append("X").attr("title",a.ui().item_tooltip(s.backpack[e])).tipsy({className:"item",html:!0})}return!1}))}else t.destroy()},e.on_refresh=function(){},super(e)}}
/**
 * Academy panel data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_panel_academy
 * @extends ui_panel
 * @returns {ui_panel_academy}
 */class ui_panel_academy extends ui_panel{constructor(e){e.id="academy",e.template=ui.building_panel_template(),e.on_show=function(e){let t="",a=this,s=this.core(),i=s.get_settlement();$(this.handle+" section").append(s.ui().tabs(["Info","Research","Technologies","Projects"])),t+='<div class="column-left"></div><div class="column-right"><h2>Technology Tree</h2><p>Select a technology from the left panel to view information about it.</p></div>',$(this.handle+" #tab-technologies").empty().append(t),t="";for(let e=0;e<game.TECHNOLOGIES.length;e++)t+='<div data-technology="'+game.TECHNOLOGIES[e].handle+'" class="technology"><img src="'+game.ASSETS_URL+"images/assets/research/"+game.TECHNOLOGIES[e].handle+'.png" /></div>';$(this.handle+" .column-left").empty().append(t),$(a.handle+" #tab-projects").empty().append("<p>Not implemented yet.</p>"),$(this.handle).on("click",".technology",(function(){$(a.handle+" .technology").removeClass("selected"),$(this).addClass("selected");let e=$(this).data("technology"),i=s.get_research_config_data(e);if(i){t="<h2>"+i.name+"</h2><p>"+i.description+"</p><dl><dt>Duration</dt><dd>"+i.duration+" days</dd><dt>Cost</dt>";for(let e in i.cost)t+="<dd>"+game.nice_numbers(i.cost[e])+' <img class="small tips" title="'+game.get_resource_name(e)+'" src="'+game.ASSETS_URL+"images/assets/resources/"+e+'.png" /></dd>';t+="<dt>Effect</dt>";for(let e in i.effect)if("buildings"===e)for(let a in i.effect[e]){let r=s.get_building_config_data(a);t+="<dd>"+r.name+" +"+i.effect[e][a]+"</dd>"}else"tax"===e?t+="<dd>+"+i.effect[e]+s.ui().resource_small_img("coins")+" each house</dd>":"distance"===e?t+="<dd>Faster world map travel</dd>":"ruins"===e&&(t+="<dd>Show ruins on world map</dd>");t+='<div class="toolbar"></div>',$(a.handle+" .column-right").empty().append(t),s.has_research(i.handle)?$(a.handle+" .toolbar").empty().append("You already researched this technology."):!1!==s.in_queue(i.handle)?$(a.handle+" .toolbar").empty().append("You are currently researching this technology."):$(a.handle+" .toolbar").empty().append('<a href="#" class="btn do-research" data-technology="'+i.handle+'">Research</a>')}return!1})).on("click",".do-research",(function(){let e=$(this).data("technology"),t=s.get_research_config_data(e);return t&&(!1===s.has_research_in_queue()?s.get_settlement().has_resources(t.cost)?s.queue_add(i,null,game.ACTION_RESEARCH,null,{handle:t.handle,name:t.name,duration:t.duration})&&(i.remove_resources(t.cost),$(a.handle+" .toolbar").empty(),s.save_and_refresh()):s.ui().error("You don`t have enough resources to research this technology."):s.ui().error("You can research only one technology at a time. Wait for the current research to finish.")),!1}))},e.on_refresh=function(){let e=this.core(),t=e.get_settlement().research(),a=e.research(),s="",i=e.get_settlement().get_building(this.params_data.handle);if(i){$(this.handle+" #tab-info").empty().append(e.ui().building_panel(this.params_data,i.level)),s='<h2>Research points</h2><div class="section">'+e.ui().progress(100*t/game.MAX_RESEARCH_VALUE,"large",t+" / "+game.MAX_RESEARCH_VALUE)+"</div>";let a=e.has_research_in_queue();!1!==a&&(s+="<h2>Currently researching `"+a.data.name+'`</h2><div class="section">'+e.ui().progress(100*a.passed/a.duration,"large",a.passed+" / "+a.duration+" days")+"</div>"),$(this.handle+" #tab-research").empty().append(s)}else this.destroy();for(let e=0;e<a.length;e++)void 0!==a[e]&&$(this.handle+" .technology[data-technology="+a[e].handle+"]").addClass("has")},super(e)}}
/**
 * Login window data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_window_signin
 * @extends ui_window
 * @returns {ui_window_signin}
 */class ui_window_signin extends ui_window{constructor(e){e.id="signin",e.template='<section id="window-{ID}" class="window"><div class="logo">Civitas</div><fieldset><div class="new-game"><p>Enter the city password to decrypt the game data.</p><dl><dt class="clearfix">Password:</dt><dd><input type="password" class="password text-input" /></dd></dl><a href="#" class="do-start highlight button">Load Game</a></div><a href="#" class="do-restart button">Restart</a>'+ui.window_about_section()+"</fieldset></section>",e.on_show=function(){let e=this,t=this.handle,a=this.core();$(t).on("click",".do-start",(function(){let s=$(t+" .password").val();return""===s?(a.ui().error("Enter your city password.","Error",!0),!1):(a.load_game_data(s)?e.destroy():($(t+" .password").val(""),a.ui().error("Error decrypting the game data with the specified password. Try again.","Error",!0)),!1)})).on("click",".do-restart",(function(){return a.ui().open_modal((function(e){"yes"===e&&(a.reset_storage_data(),document.location.reload())}),"Are you sure you want to restart the game? You will lose all progress on the current game!","Civitas"),!1})).on("click",".do-about",(function(){return $(t+" .about-game").slideToggle(),!1}))},e.on_hide=function(){this.core().ui().hide_loader()},super(e)}}
/**
 * Battle window data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_window_battle
 * @extends ui_window
 * @returns {ui_window_battle}
 */class ui_window_battle extends ui_window{constructor(e){e.id="battle",e.template='<section id="window-{ID}" class="window"><div class="container"><div title="Attack and defense rating for the attacking army." class="tips attack"></div><div title="Attack and defense rating for the defending army." class="tips defense"></div><div class="battleground"></div><div title="Current turn." class="tips turns">1</div><div class="status"></div><div class="toolbar"><a title="End current turn." class="tips button end" href="#">End turn</a> <a title="Close the window." class="tips button close" href="#">Close</a></div></div></section>',e.on_show=function(e){let t=this,a=this.core(),s=this.handle;a.pause(),this.battleground=new battleground({core:a,width:15,height:9,elements:{container:s+" .battleground",attack:s+" .attack",defense:s+" .defense",console:s+" .status"},attack:{city:this.params_data.source.source.id,army:this.params_data.source.data.army,navy:this.params_data.source.data.navy},defense:{city:this.params_data.destination.id(),army:this.params_data.destination.army,navy:this.params_data.destination.navy},on_win(e,t){a.do_achievement("conqueror"),$(s+" .end").hide(),$(s+" .close").show()},on_lose(e,t){a.do_achievement("foolish"),$(s+" .end").hide(),$(s+" .close").show()},on_end_turn(e){$(s+" .turns").html(e)}}),$(s+" .close").hide(),$(s).on("click",".close",(function(){return a.unpause(),t.destroy(),!1})).on("click",".end",(function(){return t.battleground.end_turn(),!1}))},super(e)}}
/**
 * Sign Up window data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_window_signup
 * @extends ui_window
 * @returns {ui_window_signup}
 */class ui_window_signup extends ui_window{constructor(e){e.id="signup",e.template='<section id="window-{ID}" class="window"><div class="logo">Civitas</div><fieldset><div class="new-game"><img class="avatar-select-top" src="'+game.ASSETS_URL+'images/assets/avatars/avatar1.png"><p>Choose your city details well, climate and game difficulty affects your building options and resources.</p><dl><dt class="clearfix">Your Name:</dt><dd><input type="text" maxlength="12" title="Maximum of 12 characters." class="tips name text-input" /></dd>'+(!0===game.ENCRYPTION?'<dt class="clearfix">Password:</dt><dd><input type="password" class="password text-input" /></dd><dt class="clearfix">Confirm Password:</dt><dd><input type="password" class="password2 text-input" /></dd>':"")+'<div class="hr"></div><dt class="clearfix">City Name:</dt><dd><input type="text" maxlength="12" title="Maximum of 12 characters." class="tips cityname text-input" /></dd><dt class="clearfix">Nationality:</dt><dd><select class="nation text-input"></select></dd><dt class="clearfix">Climate:</dt><dd><select class="climate text-input"></select></dd><dt class="clearfix">Difficulty:</dt><dd><select class="difficulty text-input"><option value="1">Easy</option><option value="2">Medium</option><option value="3">Hard</option><option value="4">Hardcore</option></select></dd><div class="avatar-select"></div></dl><a href="#" class="do-start highlight button">Start Playing</a>'+ui.window_about_section()+"</div></fieldset></section>",e.on_show=function(){let e=this,t=1,a="",s="",i=this.core(),r=this.handle;for(let e=1;e<game.CLIMATES.length;e++)$(r+" .climate").append('<option value="'+game["CLIMATE_"+game.CLIMATES[e].toUpperCase()]+'">'+game.CLIMATES[e].capitalize()+"</option>");for(let e=1;e<game.NATIONS.length;e++)$(r+" .nation").append('<option value="'+game["NATION_"+game.NATIONS[e].toUpperCase()]+'">'+game.NATIONS[e].capitalize()+"</option>");for(let e=1;e<=game.AVATARS;e++)$(r+" .avatar-select").append('<img class="avatar'+(e===t?" selected":"")+'" data-avatar="'+e+'" src="'+game.ASSETS_URL+"images/assets/avatars/avatar"+e+'.png" />');$(r).on("click",".do-start",(function(){!0===game.ENCRYPTION&&(a=$(r+" .password").val(),s=$(r+" .password2").val());let n=$(r+" .name").val(),o=$(r+" .cityname").val(),l=parseInt($(r+" .nation").val(),10),d=parseInt($(r+" .climate").val(),10),c=parseInt($(r+" .difficulty").val(),10);if(n.length>12&&(n=n.substring(0,12)),o.length>12&&(o=o.substring(0,12)),""===n)return i.ui().error("Enter your ruler name, for example <strong>Ramses</strong>.","Error",!0),!1;if(""===o)return i.ui().error("Enter your city name, for example <strong>Alexandria</strong>.","Error",!0),!1;if(!0===game.ENCRYPTION){if(""===a)return i.ui().error("Enter a strong password for your city.","Error",!0),!1;if(a!==s)return i.ui().error("Your passwords do not match.","Error",!0),!1}return i.new_game(n,o,l,d,t,c,a),e.destroy(),!1})).on("click",".avatar",(function(){$(r+" img.avatar").removeClass("selected"),$(this).addClass("selected");let e=parseInt($(this).data("avatar"),10);return e>=1&&e<=game.AVATARS&&(t=e,$(".avatar-select-top").attr("src",game.ASSETS_URL+"images/assets/avatars/avatar"+t+".png")),!1})).on("click",".avatar-select-top",(function(){return $(".avatar-select").fadeToggle("fast"),!1})).on("click",".do-about",(function(){return $(r+" .about-game").slideToggle(),!1}))},e.on_hide=function(){this.core().ui().hide_loader()},super(e)}}
/**
 * Options window data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_window_error
 * @extends ui_window
 * @returns {ui_window_error}
 */class ui_window_error extends ui_window{constructor(e){e.id="error",e.template='<section id="window-{ID}" class="window"><div class="logo">Civitas</div><fieldset><div class="error">An error has occured in Civitas and the game is unable to resume.<br /><br /><span class="error-message"></span><br /><span class="error-code"></span><br /><br /><a href="#" class="do-restart button">Restart</a></div></fieldset></section>',e.on_show=function(){let e=this.core(),t=this.handle;$(t+" .error-message").html("Message: "+this.params_data.error),$(t+" .error-code").html("Code: "+this.params_data.code),$(t).on("click",".do-restart",(function(){return e.ui().open_modal((function(t){"yes"===t&&(e.reset_storage_data(),document.location.reload())}),"Are you sure you want to restart the game? You will lose all progress on the current game!","Civitas"),!1}))},e.on_hide=function(){this.core().ui().hide_loader()},super(e)}}
/**
 * Options window data.
 *
 * @param {Object} params
 * @license GPL-3.0-or-later
 * @class ui_window_options
 * @extends ui_window
 * @returns {ui_window_options}
 */class ui_window_options extends ui_window{constructor(e){e.id="options",e.template='<section id="window-{ID}" class="window"><div class="logo">Civitas</div><fieldset><div class="options"><a href="#" class="do-pause button">Pause</a><a href="#" class="do-restart button">Restart</a><a href="#" class="do-options button">Options</a><div class="options-game"></div>'+ui.window_about_section()+'<a href="#" class="do-resume button">Resume Playing</a></div></fieldset></section>',e.on_show=function(){let e=this,t=this.handle,a=this.core();$(t+" .options-game").append(a.ui().tabs(["Sounds","UI","Gameplay"])),$(t+" #tab-sounds").append('<div><a href="#" class="music-control ui-control '+(!0===a.get_settings("music")?"on":"off")+'">music</a><input class="music-volume" type="range" min="0" max="1" step="0.1" '+(!0!==a.get_settings("music")?"disabled":"")+" /></div>"),$(t+" #tab-ui").append('<div><a href="#" class="worldmap-grid-control ui-control '+(!0===a.get_settings("worldmap_grid")?"on":"off")+'">worldmap grid</a> <a href="#" class="worldmap-beautify-control ui-control '+(!0===a.get_settings("worldmap_beautify")?"on":"off")+'">worldmap beautify</a></div>'),$(t+" .tabs").tabs(),$(t).on("click",".do-resume",(function(){return a.ui().hide_loader(),a.unpause(),e.destroy(),!1})).on("click",".do-pause",(function(){return!0===a.is_paused()?($(this).removeClass("button-green").html("Pause"),a.ui().show_loader(),a.unpause()):($(this).addClass("button-green").html("Resume"),a.ui().hide_loader(),a.pause()),!1})).on("click",".do-options",(function(){return $(t+" .options-game").slideToggle(),!1})).on("click",".do-about",(function(){return $(t+" .about-game").slideToggle(),!1})).on("click",".do-restart",(function(){return a.ui().open_modal((function(e){"yes"===e&&(a.reset_storage_data(),document.location.reload())}),"Are you sure you want to restart the game? You will lose all progress on the current game!","Civitas"),!1})).on("click",".music-control",(function(){return $(this).hasClass("on")?($(this).removeClass("on").addClass("off"),$(".music-volume").attr("disabled",!0),a.set_settings("music",!1)):($(this).removeClass("off").addClass("on"),$(".music-volume").attr("disabled",!1),a.set_settings("music",!0)),a.save(),!1})).on("click",".worldmap-grid-control",(function(){return $(this).hasClass("on")?($(this).removeClass("on").addClass("off"),a.set_settings("worldmap_grid",!1)):($(this).removeClass("off").addClass("on"),a.set_settings("worldmap_grid",!0)),a.save(),!1})).on("click",".worldmap-beautify-control",(function(){return $(this).hasClass("on")?($(this).removeClass("on").addClass("off"),a.set_settings("worldmap_beautify",!1)):($(this).removeClass("off").addClass("on"),a.set_settings("worldmap_beautify",!0)),a.save(),!1})).on("change",".music-volume",(function(){let e=parseInt($(this).val(),10);return a.music.volume=e,a.save(),!1}))},e.on_hide=function(){this.core().ui().hide_loader()},super(e)}}